<!DOCTYPE html>
<html>
  <head>
    <title>Hello World</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="revised" content="2019-09-18T23:56:21 AEST">
<title>Cron Job Note - 2 :: Hello World</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/theme-flex/style.css" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">
<link href="/css/github.css" rel="stylesheet">
<script src="/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "\/";
</script>
<meta name="description" content="Common Cron Job examples - Refresh Cassandra database">



    
  </head>
  <body data-url="/coding/shell/cron-note-2/">
    
      <header>
  <div class="logo">
    
	
  
    <a class="baselink" href="/">Hello World</a>
  


  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
  <nav class="shortcuts">
    <div>
      <div class="searchbox">
        <input data-search-input id="search-by" type="text" placeholder="Search...">
      </div>
      <script type="text/javascript" src="/js/lunr.min.js"></script>
      <script type="text/javascript" src="/js/auto-complete.js"></script>
      <link href="/css/auto-complete.css" rel="stylesheet">
      <script type="text/javascript">
        
            var baseurl = "\/";
        
      </script>
      <script type="text/javascript" src="/js/search.js"></script>
    </div>
  </nav>
</header>
<article>
  <aside>
    <ul class="menu">
          <li data-nav-id="/" class="dd-item">
          <a href="/">
            <i class="fa fa-fw fa-home"></i>
          </a>
          </li>
    <li data-nav-id="/blogs/" class="dd-item haschildren
        ">
      <div>
      <a href="/blogs/">Blogs</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/blogs/vue-ng-react/" class="dd-item">
        <div>
          <a href="/blogs/vue-ng-react/">
            Angular vs React vs Vue
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/azure-notes/" class="dd-item">
        <div>
          <a href="/blogs/azure-notes/">
            Azure Practices
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/build-mobile-app/" class="dd-item">
        <div>
          <a href="/blogs/build-mobile-app/">
            Build mobile app with web tech
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/create-a-blog-on-github/" class="dd-item">
        <div>
          <a href="/blogs/create-a-blog-on-github/">
            Create a blog site on GitHub Pages
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/git-notes/" class="dd-item">
        <div>
          <a href="/blogs/git-notes/">
            Git Practices
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/javascript-oop/" class="dd-item">
        <div>
          <a href="/blogs/javascript-oop/">
            JavaScript and OOP
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/k8s-notes/" class="dd-item">
        <div>
          <a href="/blogs/k8s-notes/">
            Kubernetes Practices
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/coding/">Coding</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/coding/c/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/c/">C / C&#43;&#43;</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/c/lcthw-lectures.1/" class="dd-item">
        <div>
          <a href="/coding/c/lcthw-lectures.1/">
            C Lecture - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c/lcthw-lectures.2/" class="dd-item">
        <div>
          <a href="/coding/c/lcthw-lectures.2/">
            C Lecture - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c/lcthw-lectures.3/" class="dd-item">
        <div>
          <a href="/coding/c/lcthw-lectures.3/">
            C Lecture - 3
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c/lcthw-lectures.4/" class="dd-item">
        <div>
          <a href="/coding/c/lcthw-lectures.4/">
            C Lecture - 4
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/c-sharp/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/c-sharp/">C#</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/c-sharp/csharp-note-1/" class="dd-item">
        <div>
          <a href="/coding/c-sharp/csharp-note-1/">
            C# Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c-sharp/csharp-note-2/" class="dd-item">
        <div>
          <a href="/coding/c-sharp/csharp-note-2/">
            C# Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c-sharp/csharp-note-3/" class="dd-item">
        <div>
          <a href="/coding/c-sharp/csharp-note-3/">
            C# Note - 3
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/golang/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/golang/">Golang</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/golang/go-note-1/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-1/">
            Golang Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-2/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-2/">
            Golang Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-3/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-3/">
            Golang Note - 3
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/java/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/java/">Java</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/java/java-note-1/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-1/">
            Java Note - 1: Enum
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/java/java-note-2/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-2/">
            Java Note - 2: Concurrency
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/java/java-note-3/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-3/">
            Java Note - 3: Path and Files
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/java/java-note-4/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-4/">
            Java Note - 4: Date Time 
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/java/java-note-5/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-5/">
            Java Note - 5: Lambda 
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/javascript/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/javascript/">JavaScript</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/javascript/js-note-1/" class="dd-item">
        <div>
          <a href="/coding/javascript/js-note-1/">
            JS &amp; ES Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/javascript/js-note-2/" class="dd-item">
        <div>
          <a href="/coding/javascript/js-note-2/">
            JS &amp; ES Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/javascript/js-note-3/" class="dd-item">
        <div>
          <a href="/coding/javascript/js-note-3/">
            JS &amp; ES Note - 3
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/python/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/python/">Python</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/python/python-note-1/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-1/">
            Python Note 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-2/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-2/">
            Python Note 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-3/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-3/">
            Python Note 3
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-4/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-4/">
            Python Note 4
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-5/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-5/">
            Python Note 5
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-6/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-6/">
            Python Note 6
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-7/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-7/">
            Python Note 7
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-8/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-8/">
            Python Note 8
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-9/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-9/">
            Python Note 9
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/rustlang/" class="dd-item
        ">
      <div>
      <a href="/coding/rustlang/">RustLang</a>
      </div>
    </li>
    <li data-nav-id="/coding/shell/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/coding/shell/">Shell</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/shell/cron-note-1/" class="dd-item">
        <div>
          <a href="/coding/shell/cron-note-1/">
            Cron Job Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/shell/cron-note-2/" class="dd-item active">
        <div>
          <a href="/coding/shell/cron-note-2/">
            Cron Job Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/shell/ps-note-1/" class="dd-item">
        <div>
          <a href="/coding/shell/ps-note-1/">
            Powershell Note - 1
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/sql/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/sql/">SQL</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/sql/mysql-note-1/" class="dd-item">
        <div>
          <a href="/coding/sql/mysql-note-1/">
            MySql Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/sql/mysql-note-2/" class="dd-item">
        <div>
          <a href="/coding/sql/mysql-note-2/">
            MySql Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/sql/mysql-note-3/" class="dd-item">
        <div>
          <a href="/coding/sql/mysql-note-3/">
            MySql Note - 3
          </a>
        </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/frameworks/" class="dd-item haschildren
        ">
      <div>
      <a href="/frameworks/">Frameworks</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/frameworks/cntk-notes-1/" class="dd-item">
        <div>
          <a href="/frameworks/cntk-notes-1/">
            CNTK Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/frameworks/php-web/" class="dd-item">
        <div>
          <a href="/frameworks/php-web/">
            PHP Web Framework
          </a>
        </div>
    </li>
      <li data-nav-id="/frameworks/python-django/" class="dd-item">
        <div>
          <a href="/frameworks/python-django/">
            Python Web Framework
          </a>
        </div>
    </li>
      <li data-nav-id="/frameworks/tensorflow-notes-1/" class="dd-item">
        <div>
          <a href="/frameworks/tensorflow-notes-1/">
            Tensorflow Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/frameworks/tensorflow-notes-2/" class="dd-item">
        <div>
          <a href="/frameworks/tensorflow-notes-2/">
            Tensorflow Note - 2
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/hacks/" class="dd-item haschildren
        ">
      <div>
      <a href="/hacks/">Hacks</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/hacks/cass-note/" class="dd-item">
        <div>
          <a href="/hacks/cass-note/">
            Cassandra Practices
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/kube-cluster/" class="dd-item">
        <div>
          <a href="/hacks/kube-cluster/">
            Create Kubernetes Cluster
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/php-debug/" class="dd-item">
        <div>
          <a href="/hacks/php-debug/">
            Debug PHP with Free IDE
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/qemu-notes/" class="dd-item">
        <div>
          <a href="/hacks/qemu-notes/">
            Qemu &amp; Virtual Machine
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/windows-command-1/" class="dd-item">
        <div>
          <a href="/hacks/windows-command-1/">
            Windows cmd &amp; hotkey - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/windows-command-2/" class="dd-item">
        <div>
          <a href="/hacks/windows-command-2/">
            Windows cmd &amp; hotkey - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/windows-command-3/" class="dd-item">
        <div>
          <a href="/hacks/windows-command-3/">
            Windows cmd &amp; hotkey - 3
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/os/" class="dd-item haschildren
        ">
      <div>
      <a href="/os/">OS</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/os/centos-fedora-desktop/" class="dd-item">
        <div>
          <a href="/os/centos-fedora-desktop/">
            CentOS 6/7 Multi-Boot Setup
          </a>
        </div>
    </li>
      <li data-nav-id="/os/centos-server-7/" class="dd-item">
        <div>
          <a href="/os/centos-server-7/">
            CentOS 7 Server note
          </a>
        </div>
    </li>
      <li data-nav-id="/os/dual-boot-win10-ubuntu18/" class="dd-item">
        <div>
          <a href="/os/dual-boot-win10-ubuntu18/">
            Dual Boot Windows 10 &amp; Ubuntu 18
          </a>
        </div>
    </li>
      <li data-nav-id="/os/grub-trouble-shooting/" class="dd-item">
        <div>
          <a href="/os/grub-trouble-shooting/">
            Grub Trouble Shooting
          </a>
        </div>
    </li>
      <li data-nav-id="/os/lubuntu16-desktop/" class="dd-item">
        <div>
          <a href="/os/lubuntu16-desktop/">
            Lubuntu 16 desktop
          </a>
        </div>
    </li>
      <li data-nav-id="/os/raspberrypi-notes/" class="dd-item">
        <div>
          <a href="/os/raspberrypi-notes/">
            Raspberry Pi setup
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-desktop-14/" class="dd-item">
        <div>
          <a href="/os/ubuntu-desktop-14/">
            Ubuntu 14 -- desktop setup &amp; dual boot 
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-desktop-14-extra-tools/" class="dd-item">
        <div>
          <a href="/os/ubuntu-desktop-14-extra-tools/">
            Ubuntu 14 -- desktop, extra tools
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-server-14/" class="dd-item">
        <div>
          <a href="/os/ubuntu-server-14/">
            Ubuntu 14 -- server setup
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-server-16/" class="dd-item">
        <div>
          <a href="/os/ubuntu-server-16/">
            Ubuntu 16 server note
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-desktop-18/" class="dd-item">
        <div>
          <a href="/os/ubuntu-desktop-18/">
            Ubuntu Desktop 18 LTS note
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/projects/" class="dd-item haschildren
        ">
      <div>
      <a href="/projects/">Projects</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/projects/angular4-crm/" class="dd-item">
        <div>
          <a href="/projects/angular4-crm/">
            Angular 4 CRM Project
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/angularjs-webpack-es6-starter/" class="dd-item">
        <div>
          <a href="/projects/angularjs-webpack-es6-starter/">
            Angularjs Webpack ES6 Starter
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/python-flat-api/" class="dd-item">
        <div>
          <a href="/projects/python-flat-api/">
            FlatApi - Restful API for python dev
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/laravel-mvc-starter/" class="dd-item">
        <div>
          <a href="/projects/laravel-mvc-starter/">
            Laravel MVC Starter
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/react-crm/" class="dd-item">
        <div>
          <a href="/projects/react-crm/">
            React Redux CRM Project
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/vue2-admin/" class="dd-item">
        <div>
          <a href="/projects/vue2-admin/">
            Vue 2 Admin Project
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/vue2-crm/" class="dd-item">
        <div>
          <a href="/projects/vue2-crm/">
            Vue 2 CRM Project
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/zf2-mvc-starter/" class="dd-item">
        <div>
          <a href="/projects/zf2-mvc-starter/">
            Zend Framework 2 MVC Starter
          </a>
        </div>
    </li>
        </ul>
    </li>




    </ul>
    <section>
    </section>
  </aside>
  <section class="page">
    
    <div class="nav-select">
      <center>Navigation : 
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/blogs/" >
   Blogs</option>
    <option value="/coding/" >
   Coding</option> 
    <option value="/coding/c/" >
   C / C&#43;&#43;</option>
    <option value="/coding/c-sharp/" >
   C#</option>
    <option value="/coding/golang/" >
   Golang</option>
    <option value="/coding/java/" >
   Java</option>
    <option value="/coding/javascript/" >
   JavaScript</option>
    <option value="/coding/python/" >
   Python</option>
    <option value="/coding/rustlang/" >
   RustLang</option>
    <option value="/coding/shell/" >
   Shell</option> 
      <option value="/coding/shell/cron-note-1/" > Cron Job Note - 1</option>
      <option value="/coding/shell/cron-note-2/"  selected> Cron Job Note - 2</option>
      <option value="/coding/shell/ps-note-1/" > Powershell Note - 1</option>
  
    <option value="/coding/sql/" >
   SQL</option>
  
    <option value="/frameworks/" >
   Frameworks</option>
    <option value="/hacks/" >
   Hacks</option>
    <option value="/os/" >
   OS</option>
    <option value="/projects/" >
   Projects</option>



        </select>
      </center>
    </div>


    


    
    
    
<div class="main-page">
    <div class="flex-item main-content">
            <h1>Cron Job Note - 2</h1>
        

<h3 id="refresh-the-database-nosql-cassandra">Refresh the database (NoSQL) - Cassandra</h3>

<h4 id="backup-the-cassandra-database-nightly">Backup the Cassandra database nightly</h4>

<ul>
<li>There is a keyspace named <code>hho_ks</code> in the Cassandra nodes store the production data.</li>
<li>Every night the staging Cassandra server will be refreshed with production&rsquo;s snapshot</li>
<li>This solution is not built on the incremental snapshot.</li>
<li>The production and staging nodes are running within the same subnet.</li>
<li>The backup script will be run nightly on production server</li>

<li><p>Cron job setting</p>

<pre><code class="language-bash">00 20   * * *   &lt;user_account&gt;  /home/&lt;user_account&gt;/cass_staging_refresh/cass_prod_snapshot.sh &gt;&gt; /home/&lt;user_account&gt;/cass_staging_refresh/refresh.log 2&gt;&amp;1
</code></pre></li>

<li><p>The script to create a snapshot:   <code>cass_prod_snapshot.sh</code></p>

<pre><code class="language-bash">#!/bin/bash

# the log file sits home/&lt;user_account&gt;/cass_staging_refresh/refresh.log 

# SET staging Cassandra IP
CASS_STG_IP=0.0.0.0

echo &quot;$(date): Beginning refresh of staging Cassandra ${CASS_STG_IP}&quot;
START=$(date +%s)

cd /data/cassandra

# Prepare a schema script of keyspace hho_ks
echo &quot;$(date): Prepare a schema script of keyspace hho_ks&quot;
sudo bash -c &quot;cqlsh -e 'DESC KEYSPACE hho_ks' &gt; hho_ks.cql&quot;

# Remove old snapshots folder and create new snapshots folder with some sub-folders
echo &quot;$(date): Remove old snapshots folder and create new snapshots folder with some sub-folders&quot;
sudo rm -rf snapshots
sudo mkdir snapshots
cd snapshots
sudo mkdir -p service interval imported_file market_file meter_config
cd /data/cassandra

# Clear snapshot hho_ks
echo &quot;$(date): Clear snapshot hho_ks&quot;
# find /data/cassandra/data/hho_ks/  -name snapshots -type d
nodetool clearsnapshot hho_ks &gt; /dev/null 2&gt;&amp;1 
# find /data/cassandra/data/hho_ks/  -name snapshots -type d

# Create new snapshot (cut out the snapshot id into a variable)
echo &quot;$(date): Create new snapshot&quot;
SNAP_ID=$(nodetool snapshot hho_ks | cut -c 66-78)
# echo SNAP_ID=$SNAP_ID

# Copy snapshot data to new folder snapshot
# ~ 7mins
echo &quot;$(date): Copy snapshot data to new snapshot folder&quot;
for d in $(ls /data/cassandra/snapshots); do \
sudo cp -R /data/cassandra/data/hho_ks/$d*/snapshots/$SNAP_ID/. /data/cassandra/snapshots/$d/ ; \
done

# Create a tarball of snapshots
echo &quot;$(date): Create a tarball of snapshots&quot;
sudo rm -rf snapshots.tar.gz
sudo tar -zcvf snapshots.tar.gz snapshots/ &gt; /dev/null 2&gt;&amp;1  # ~30mins

# Copy tarball and schema script to staging Cassandra
echo &quot;$(date): Copy tarball and schema script to staging Cassandra ${CASS_STG_IP}&quot;
scp snapshots.tar.gz &lt;user_account&gt;@${CASS_STG_IP}:/home/&lt;user_account&gt;/ # ~5mins
scp hho_ks.cql &lt;user_account&gt;@${CASS_STG_IP}:/home/&lt;user_account&gt;/

# Refresh snapshots on staging Cassandra
echo &quot;$(date): SSH to staging Cassandra ${CASS_STG_IP}&quot;
sudo ssh &lt;user_account&gt;@${CASS_STG_IP} 'bash -s' &lt; /home/&lt;user_account&gt;/cass_staging_refresh/cass_staging_refresh.sh

echo &quot;$(date): Completed refresh of staging Cassandra ${CASS_STG_IP}&quot;
END=$(date +%s)
echo &quot;Refresh duration: $(( $END - $START ))s&quot;

</code></pre></li>

<li><p>Refresh the staging Cassandra node</p></li>

<li><p>The script to refresh the staging node: <code>cass_staging_refresh</code></p>

<pre><code class="language-bash">#!/bin/bash

# Unzip tarball
echo &quot;$(date): Unzip tarball&quot;
cd
rm -rf snapshots
tar -zxvf snapshots.tar.gz &gt; /dev/null 2&gt;&amp;1 # ~5mins

# Attempt to drop keyspace hho_ks (will likely throw a java.lang.RuntimeException)
echo &quot;$(date): Drop keyspace hho_ks&quot;
cqlsh -e &quot;drop keyspace hho_ks&quot; &gt; /dev/null 2&gt;&amp;1 
sleep 1m

# Start/restart Cassandra service
echo &quot;$(date): Restart Cassandra service&quot;
sudo systemctl start cassandra.service
sudo systemctl restart cassandra.service

# Wait for 5 minutes to ensure the Cassandra service is running
echo &quot;$(date): Wait for 5 minutes to ensure the Cassandra service is running&quot;
sleep 5m

# Check Cassandra service status
# sudo systemctl status cassandra

# Attempt to drop keyspace hho_ks again (will likely compliain: Cannot drop non existing keyspace 'hho_ks')
cqlsh -e &quot;drop keyspace hho_ks&quot; &gt; /dev/null 2&gt;&amp;1 
sleep 1m

# Remove data folder hho_ks
echo &quot;$(date): Remove data folder hho_ks&quot;
sudo rm -r -f /var/lib/cassandra/data/hho_ks

# Recreate keyspace hho_ks
echo &quot;$(date): Recreate keyspace hho_ks&quot;
cqlsh --file=&quot;hho_ks.cql&quot; &gt; /dev/null 2&gt;&amp;1 

# Copy snapshots to new data folder hho_ks
# ~5mins
echo &quot;$(date): Copy snapshots to new data folder hho_ks&quot;
for d in $(ls snapshots); do \
sudo cp -R snapshots/$d/. /var/lib/cassandra/data/hho_ks/$d*/ ; \
done; 

# Refresh keyspace
# ~10mins
echo &quot;$(date): Refresh keyspace&quot;
for d in $(ls snapshots); do \
nodetool refresh -- hho_ks $d ; \
done


</code></pre></li>
</ul>

    </div>

    <div class="toc" >
        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#refresh-the-database-nosql-cassandra">Refresh the database (NoSQL) - Cassandra</a>
<ul>
<li><a href="#backup-the-cassandra-database-nightly">Backup the Cassandra database nightly</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>

</div>

    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="/coding/shell/cron-note-1/" title="Cron Job Note - 1"> <i class="fa fa-chevron-left"></i><label>Cron Job Note - 1</label></a>
    <a class="nav nav-next" href="/coding/shell/ps-note-1/" title="Powershell Note - 1" style="margin-right: 0px;"><label>Powershell Note - 1</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

    

    
  </div>


	<div>


  
    
  



	</div>
</footer>

<script src="/js/clipboard.min.js"></script>

<link href="/css/featherlight.min.css" rel="stylesheet">
<script src="/js/featherlight.min.js"></script>


<link href="/css/github.css" rel="stylesheet">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script src="/theme-flex/script.js"></script>


    

    
    

    
  </body>
</html>
<!DOCTYPE html>
<html>
  <head>
    <title>Hello World</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="revised" content="2020-02-16T13:41:22 AEDT">
<title>C Lecture - 1 :: Hello World</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/theme-flex/style.css" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "\/";
</script>
<meta name="description" content="Exercise 0 ~ 31">



    
  </head>
  <body data-url="/coding/c/lcthw-lectures.1/">
    
      <header>
  <div class="logo">
    
	
  
    <a class="baselink" href="/">Hello World</a>
  


  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
  <nav class="shortcuts">
    <div>
      <div class="searchbox">
        <input data-search-input id="search-by" type="text" placeholder="Search...">
      </div>
      <script type="text/javascript" src="/js/lunr.min.js"></script>
      <script type="text/javascript" src="/js/auto-complete.js"></script>
      <link href="/css/auto-complete.css" rel="stylesheet">
      <script type="text/javascript">
        
            var baseurl = "\/";
        
      </script>
      <script type="text/javascript" src="/js/search.js"></script>
    </div>
  </nav>
</header>
<article>
  <aside>
    <ul class="menu">
          <li data-nav-id="/" class="dd-item">
          <a href="/">
            <i class="fa fa-fw fa-home"></i>
          </a>
          </li>
    <li data-nav-id="/projects/" class="dd-item haschildren
        ">
      <div>
      <a href="/projects/">Projects</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/projects/python-flat-api/" class="dd-item">
        <div>
          <a href="/projects/python-flat-api/">
            FlatApi - Restful API for python dev
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/angular4-crm/" class="dd-item">
        <div>
          <a href="/projects/angular4-crm/">
            Angular 4 CRM Project
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/laravel-mvc-starter/" class="dd-item">
        <div>
          <a href="/projects/laravel-mvc-starter/">
            Laravel MVC Starter
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/react-crm/" class="dd-item">
        <div>
          <a href="/projects/react-crm/">
            React Redux CRM Project
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/vue2-admin/" class="dd-item">
        <div>
          <a href="/projects/vue2-admin/">
            Vue 2 Admin Project
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/vue2-crm/" class="dd-item">
        <div>
          <a href="/projects/vue2-crm/">
            Vue 2 CRM Project
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/angularjs-webpack-es6-starter/" class="dd-item">
        <div>
          <a href="/projects/angularjs-webpack-es6-starter/">
            Angularjs Webpack ES6 Starter
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/zf2-mvc-starter/" class="dd-item">
        <div>
          <a href="/projects/zf2-mvc-starter/">
            Zend Framework 2 MVC Starter
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/kube-cluster/" class="dd-item">
        <div>
          <a href="/projects/kube-cluster/">
            Kubernetes Cluster in 5min
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/coding/">Coding</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/coding/c/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/coding/c/">C </a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/c/lcthw-lectures.1/" class="dd-item active">
        <div>
          <a href="/coding/c/lcthw-lectures.1/">
            C Lecture - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c/lcthw-lectures.2/" class="dd-item">
        <div>
          <a href="/coding/c/lcthw-lectures.2/">
            C Lecture - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c/lcthw-lectures.3/" class="dd-item">
        <div>
          <a href="/coding/c/lcthw-lectures.3/">
            C Lecture - 3
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c/lcthw-lectures.4/" class="dd-item">
        <div>
          <a href="/coding/c/lcthw-lectures.4/">
            C Lecture - 4
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/c-sharp/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/c-sharp/">C#</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/c-sharp/csharp-note-1/" class="dd-item">
        <div>
          <a href="/coding/c-sharp/csharp-note-1/">
            C# Console App
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c-sharp/csharp-note-4/" class="dd-item">
        <div>
          <a href="/coding/c-sharp/csharp-note-4/">
             Generic Predicate &amp; Expression
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c-sharp/csharp-note-2/" class="dd-item">
        <div>
          <a href="/coding/c-sharp/csharp-note-2/">
            Scheduled task with window service
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c-sharp/csharp-note-3/" class="dd-item">
        <div>
          <a href="/coding/c-sharp/csharp-note-3/">
            Thread &amp; Task
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/db-sql/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/db-sql/">DB &amp; SQL</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/db-sql/mysql-note-1/" class="dd-item">
        <div>
          <a href="/coding/db-sql/mysql-note-1/">
            MySql Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/db-sql/mysql-note-2/" class="dd-item">
        <div>
          <a href="/coding/db-sql/mysql-note-2/">
            MySql Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/db-sql/mysql-note-3/" class="dd-item">
        <div>
          <a href="/coding/db-sql/mysql-note-3/">
            MySql Note - 3
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/db-sql/mysql-note-4/" class="dd-item">
        <div>
          <a href="/coding/db-sql/mysql-note-4/">
            MySql Note - 4
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/db-sql/mysql-note-5/" class="dd-item">
        <div>
          <a href="/coding/db-sql/mysql-note-5/">
            MySql Note - 5
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/db-sql/pgsql-note-1/" class="dd-item">
        <div>
          <a href="/coding/db-sql/pgsql-note-1/">
            PostgresQL Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/db-sql/mssql-note-1/" class="dd-item">
        <div>
          <a href="/coding/db-sql/mssql-note-1/">
            Sql Server Note - 1
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/golang/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/golang/">Golang</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/golang/go-note-1/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-1/">
            Getting started
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-2/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-2/">
            Map, Function &amp; Closure
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-3/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-3/">
            Struct &amp; Interface
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-4/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-4/">
            IO, Json &amp; XML
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-5/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-5/">
            Error handling
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-6/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-6/">
            Goroutine &amp; Channel - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-7/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-7/">
            Goroutine &amp; Channel - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-8/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-8/">
            Packaging
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-9/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-9/">
            Pitfalls
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-10/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-10/">
            Template
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-20/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-20/">
            Good practice - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-21/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-21/">
            Good practice 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-22/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-22/">
            Good practice 3
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-99/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-99/">
            Golang snippets
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/java/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/java/">Java</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/java/java-note-1/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-1/">
            Java Note - 1: Enum
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/java/java-note-2/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-2/">
            Java Note - 2: Concurrency
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/java/java-note-3/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-3/">
            Java Note - 3: Path and Files
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/java/java-note-4/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-4/">
            Java Note - 4: Date Time 
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/java/java-note-5/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-5/">
            Java Note - 5: Lambda 
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/js-ts/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/js-ts/">JS &amp; TS </a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/js-ts/js-note-1/" class="dd-item">
        <div>
          <a href="/coding/js-ts/js-note-1/">
            JS &amp; ES Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/js-ts/js-note-2/" class="dd-item">
        <div>
          <a href="/coding/js-ts/js-note-2/">
            JS &amp; ES Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/js-ts/js-note-3/" class="dd-item">
        <div>
          <a href="/coding/js-ts/js-note-3/">
            JS &amp; ES Note - 3
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/js-ts/js-note-99/" class="dd-item">
        <div>
          <a href="/coding/js-ts/js-note-99/">
            JS &amp; ES snippet
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/js-ts/ts-note-1/" class="dd-item">
        <div>
          <a href="/coding/js-ts/ts-note-1/">
            TypeScript Note - 1
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/python/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/python/">Python</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/python/python-note-1/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-1/">
            Package &amp; Module
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-2/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-2/">
            Closure &amp; Decorator
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-3/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-3/">
            String &amp; Representation
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-4/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-4/">
            Iteration
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-5/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-5/">
            Inheritance &amp; Polymorphism
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-6/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-6/">
            Collection
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-7/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-7/">
            Exception &amp; Assertion
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-8/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-8/">
            Context
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-9/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-9/">
            ABC
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/rustlang/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/rustlang/">Rustlang</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/rustlang/rust-note-1/" class="dd-item">
        <div>
          <a href="/coding/rustlang/rust-note-1/">
            Data Types &amp; Ownership
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/rustlang/rust-note-2/" class="dd-item">
        <div>
          <a href="/coding/rustlang/rust-note-2/">
            Project, Vector, String &amp; Hashmap
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/rustlang/rust-note-3/" class="dd-item">
        <div>
          <a href="/coding/rustlang/rust-note-3/">
            Error handling
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/rustlang/rust-note-4/" class="dd-item">
        <div>
          <a href="/coding/rustlang/rust-note-4/">
            Generic Type &amp; Trait 
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/shell/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/shell/">Shell</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/shell/bash-note-1/" class="dd-item">
        <div>
          <a href="/coding/shell/bash-note-1/">
            Adv Bash - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/shell/bash-note-2/" class="dd-item">
        <div>
          <a href="/coding/shell/bash-note-2/">
            Adv Bash - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/shell/bash-note-3/" class="dd-item">
        <div>
          <a href="/coding/shell/bash-note-3/">
            Adv Bash - 3
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/shell/cron-note-1/" class="dd-item">
        <div>
          <a href="/coding/shell/cron-note-1/">
            Cron Job Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/shell/cron-note-2/" class="dd-item">
        <div>
          <a href="/coding/shell/cron-note-2/">
            Cron Job Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/shell/ps-note-1/" class="dd-item">
        <div>
          <a href="/coding/shell/ps-note-1/">
            Powershell Note - 1
          </a>
        </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/cloud/" class="dd-item haschildren
        ">
      <div>
      <a href="/cloud/">Cloud</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/cloud/aws-note-1/" class="dd-item">
        <div>
          <a href="/cloud/aws-note-1/">
            AWS Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/cloud/aws-note-2/" class="dd-item">
        <div>
          <a href="/cloud/aws-note-2/">
            AWS Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/cloud/digito-note-1/" class="dd-item">
        <div>
          <a href="/cloud/digito-note-1/">
            DigitialOcean Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/cloud/digito-note-2/" class="dd-item">
        <div>
          <a href="/cloud/digito-note-2/">
            DigitialOcean Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/cloud/digito-note-3/" class="dd-item">
        <div>
          <a href="/cloud/digito-note-3/">
            DigitialOcean Note - 3
          </a>
        </div>
    </li>
      <li data-nav-id="/cloud/digito-note-4/" class="dd-item">
        <div>
          <a href="/cloud/digito-note-4/">
            DigitialOcean Note - 4
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/hacks/" class="dd-item haschildren
        ">
      <div>
      <a href="/hacks/">Hacks</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/hacks/git-notes/" class="dd-item">
        <div>
          <a href="/hacks/git-notes/">
            Git Practices
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/windows-command-3/" class="dd-item">
        <div>
          <a href="/hacks/windows-command-3/">
            Windows cmd &amp; hotkey - 3
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/windows-command-2/" class="dd-item">
        <div>
          <a href="/hacks/windows-command-2/">
            Windows cmd &amp; hotkey - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/windows-command-1/" class="dd-item">
        <div>
          <a href="/hacks/windows-command-1/">
            Windows cmd &amp; hotkey - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/cass-note/" class="dd-item">
        <div>
          <a href="/hacks/cass-note/">
            Cassandra Practices
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/php-debug/" class="dd-item">
        <div>
          <a href="/hacks/php-debug/">
            Debug PHP with Free IDE
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/qemu-notes/" class="dd-item">
        <div>
          <a href="/hacks/qemu-notes/">
            Qemu &amp; Virtual Machine
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/vbox-notes/" class="dd-item">
        <div>
          <a href="/hacks/vbox-notes/">
            VirtualBox Notes
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/os/" class="dd-item haschildren
        ">
      <div>
      <a href="/os/">OS</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/os/dual-boot-win10-ubuntu18/" class="dd-item">
        <div>
          <a href="/os/dual-boot-win10-ubuntu18/">
            Dual Boot Windows 10 &amp; Ubuntu 18
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-desktop-18/" class="dd-item">
        <div>
          <a href="/os/ubuntu-desktop-18/">
            Ubuntu Desktop 18 LTS note
          </a>
        </div>
    </li>
      <li data-nav-id="/os/raspberrypi-notes/" class="dd-item">
        <div>
          <a href="/os/raspberrypi-notes/">
            Raspberry Pi setup
          </a>
        </div>
    </li>
      <li data-nav-id="/os/lubuntu16-desktop/" class="dd-item">
        <div>
          <a href="/os/lubuntu16-desktop/">
            Lubuntu 16 desktop
          </a>
        </div>
    </li>
      <li data-nav-id="/os/grub-trouble-shooting/" class="dd-item">
        <div>
          <a href="/os/grub-trouble-shooting/">
            Grub Trouble Shooting
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-server-16/" class="dd-item">
        <div>
          <a href="/os/ubuntu-server-16/">
            Ubuntu 16 server note
          </a>
        </div>
    </li>
      <li data-nav-id="/os/centos-server-7/" class="dd-item">
        <div>
          <a href="/os/centos-server-7/">
            CentOS 7 Server note
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-server-14/" class="dd-item">
        <div>
          <a href="/os/ubuntu-server-14/">
            Ubuntu 14 -- server setup
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-desktop-14/" class="dd-item">
        <div>
          <a href="/os/ubuntu-desktop-14/">
            Ubuntu 14 -- desktop setup &amp; dual boot 
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-desktop-14-extra-tools/" class="dd-item">
        <div>
          <a href="/os/ubuntu-desktop-14-extra-tools/">
            Ubuntu 14 -- desktop, extra tools
          </a>
        </div>
    </li>
      <li data-nav-id="/os/centos-fedora-desktop/" class="dd-item">
        <div>
          <a href="/os/centos-fedora-desktop/">
            CentOS 6/7 Multi-Boot Setup
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/blogs/" class="dd-item haschildren
        ">
      <div>
      <a href="/blogs/">Blogs</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/blogs/k8s-on-vm/" class="dd-item">
        <div>
          <a href="/blogs/k8s-on-vm/">
            Try Minikube
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/vue-ng-react/" class="dd-item">
        <div>
          <a href="/blogs/vue-ng-react/">
            Angular vs React vs Vue
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/create-a-blog-on-github/" class="dd-item">
        <div>
          <a href="/blogs/create-a-blog-on-github/">
            Create a blog site on GitHub Pages
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/build-mobile-app/" class="dd-item">
        <div>
          <a href="/blogs/build-mobile-app/">
            Build mobile app with web tech
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/azure-notes/" class="dd-item">
        <div>
          <a href="/blogs/azure-notes/">
            Azure Practices
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/javascript-oop/" class="dd-item">
        <div>
          <a href="/blogs/javascript-oop/">
            JavaScript and OOP
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/frameworks/" class="dd-item haschildren
        ">
      <div>
      <a href="/frameworks/">Frameworks</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/frameworks/cntk-notes-1/" class="dd-item">
        <div>
          <a href="/frameworks/cntk-notes-1/">
            CNTK Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/frameworks/tensorflow-notes-1/" class="dd-item">
        <div>
          <a href="/frameworks/tensorflow-notes-1/">
            Tensorflow Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/frameworks/tensorflow-notes-2/" class="dd-item">
        <div>
          <a href="/frameworks/tensorflow-notes-2/">
            Tensorflow Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/frameworks/php-web/" class="dd-item">
        <div>
          <a href="/frameworks/php-web/">
            PHP Web Framework
          </a>
        </div>
    </li>
      <li data-nav-id="/frameworks/python-django/" class="dd-item">
        <div>
          <a href="/frameworks/python-django/">
            Python Web Framework
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/tut/" class="dd-item haschildren
        ">
      <div>
      <a href="/tut/">Tutorial</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/tut/docker/" class="dd-item">
        <div>
          <a href="/tut/docker/">
            Docker Tutorial
          </a>
        </div>
    </li>
      <li data-nav-id="/tut/javascript/" class="dd-item">
        <div>
          <a href="/tut/javascript/">
            JavaScript Tutorial
          </a>
        </div>
    </li>
      <li data-nav-id="/tut/kube/" class="dd-item">
        <div>
          <a href="/tut/kube/">
            Kubernetes Tutorial
          </a>
        </div>
    </li>
        </ul>
    </li>




    </ul>
    <section>
    </section>
  </aside>
  <section class="page">
    
    <div class="nav-select">
      <center>Navigation : 
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/projects/" >
   Projects</option>
    <option value="/coding/" >
   Coding</option> 
    <option value="/coding/c/" >
  - 
   C </option> 
      <option value="/coding/c/lcthw-lectures.1/"  selected>-- C Lecture - 1</option>
      <option value="/coding/c/lcthw-lectures.2/" >-- C Lecture - 2</option>
      <option value="/coding/c/lcthw-lectures.3/" >-- C Lecture - 3</option>
      <option value="/coding/c/lcthw-lectures.4/" >-- C Lecture - 4</option>
  
    <option value="/coding/c-sharp/" >
  - 
   C#</option>
    <option value="/coding/db-sql/" >
  - 
   DB &amp; SQL</option>
    <option value="/coding/golang/" >
  - 
   Golang</option>
    <option value="/coding/java/" >
  - 
   Java</option>
    <option value="/coding/js-ts/" >
  - 
   JS &amp; TS </option>
    <option value="/coding/python/" >
  - 
   Python</option>
    <option value="/coding/rustlang/" >
  - 
   Rustlang</option>
    <option value="/coding/shell/" >
  - 
   Shell</option>
  
    <option value="/cloud/" >
   Cloud</option>
    <option value="/hacks/" >
   Hacks</option>
    <option value="/os/" >
   OS</option>
    <option value="/blogs/" >
   Blogs</option>
    <option value="/frameworks/" >
   Frameworks</option>
    <option value="/tut/" >
   Tutorial</option>



        </select>
      </center>
    </div>


    


    
    
    
<div class="main-page">
    <div class="flex-item main-content">
            <h1>C Lecture - 1</h1>
        <p>Author: Zed A. Shaw</p>
<p>All content comes from Zed's <a href="https://github.com/zedshaw/learn-c-the-hard-way-lectures.git">Lecture Repository</a> and <a href="https://github.com/zedshaw/liblcthw">Libraries Repository</a>.  All credit goes to Zed.</p>
<h3 id="exercise-0-installing-software">Exercise 0 Installing Software</h3>
<p>The Plan</p>
<ul>
<li>Install software on your system.</li>
<li>Test that it works right.</li>
</ul>
<p>Linux Install</p>
<p>On Debian/Ubuntu use:</p>
<pre><code>$ sudo apt-get install build-essential
</code></pre>
<p>On RedHat/CentOS:</p>
<pre><code>$ sudo yum groupinstall development-tools
</code></pre>
<p>Linux Testing</p>
<p>Test that your C compiler works with:</p>
<pre><code>$ cc --version
</code></pre>
<p>OSX Install</p>
<p>Install <a href="https://developer.apple.com/xcode/">XCode</a>, this will take a while.</p>
<p>OSX Testing</p>
<p>Test that your C compiler works with:</p>
<pre><code>$ cc --version
</code></pre>
<p>Windows Install</p>
<p>Install <a href="http://www.mingw.org/">MinGW</a> or <a href="https://www.cygwin.com/">Cygwin</a> or Use <a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a> to run Linux.</p>
<p>Text Editors</p>
<p>You should already have one.
Just don't use an IDE. They aren't very helpful.</p>
<p>End of Lecture 0</p>
<h3 id="exercise-1-dust-off-that-compiler">Exercise 1 Dust Off That Compiler</h3>
<p>The Plan</p>
<ul>
<li>Write your first C program.</li>
<li>Build it.</li>
<li>Break it.</li>
</ul>
<p>The Code</p>
<p>.\ex01\ex1.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/* This is a comment. */</span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> distance <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>;

    <span style="color:#75715e">// this is also a comment
</span><span style="color:#75715e"></span>    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">You are %d miles away.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, distance);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>.\ex01\ex1_zed.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/* This is a comment. */</span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> distance <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>;

    <span style="color:#75715e">// this is also a comment
</span><span style="color:#75715e"></span>    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">You are %d miles away.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>The Analysis</p>
<p>Let's look at it line-by-line.</p>
<p>Breaking It</p>
<p>This is all crazy magic right now.</p>
<p>Extra Credit</p>
<ul>
<li>Open the <code>ex1</code> file in your text editor and change or delete random parts.
Try running it and see what happens.</li>
<li>Print out five more lines of text or something more complex than &ldquo;hello world.&rdquo;</li>
<li>Run <code>man 3 printf</code> and read about this function and many others.</li>
<li>For each line, write out the symbols you don't understand and
see if you can guess what they mean.  Write a little chart on
paper with your guess so you can check it later to see
if you got it right.</li>
</ul>
<h3 id="exercise-2-using-makefiles-to-build">Exercise 2 Using Makefiles to Build</h3>
<p>The Plan</p>
<ul>
<li>Start with simple make usage.</li>
<li>Set a few important settings.</li>
</ul>
<p>How Make Works</p>
<p>Implied dependencies and ancient lore.</p>
<p>Shell Commands</p>
<pre><code>$ make ex1
## or this one too
$ CFLAGS=&quot;-Wall&quot; make ex1
$ make clean
$ make ex1
</code></pre>
<p>Makefile</p>
<pre><code>CFLAGS=-Wall -g

clean:
    rm -f ex1
</code></pre>
<p>The Analysis</p>
<ul>
<li>Setting options.</li>
<li>Indicating dependencies.</li>
<li>Writing commends to run.</li>
</ul>
<p>Breaking It</p>
<ul>
<li>Watch out for tabs vs. spaces.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Create an <em>all: ex1</em> target that will build <em>ex1</em> with
just the command <em>make</em>.</li>
<li>Read <em>man make</em> to find out more information on how to run it.</li>
<li>Read <em>man cc</em> to find out more information on what the flags <em>-Wall</em> and <em>-g</em> do.</li>
<li>Research <em>Makefiles</em> online and see if you can improve this one.</li>
<li>Find a <em>Makefile</em> in another C project and try to understand
what it's doing.</li>
</ul>
<h3 id="exercise-3-formatted-printing">Exercise 3 Formatted Printing</h3>
<p>The Plan</p>
<ul>
<li>Introduction to <em>printf</em>.</li>
</ul>
<p>The Code</p>
<p>.\ex03\ex3.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> age <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>;
    <span style="color:#66d9ef">int</span> height <span style="color:#f92672">=</span> <span style="color:#ae81ff">72</span>;

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">I am %d years old.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, argv);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">I am %d inches tall.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, height);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>The Analysis</p>
<p>Breaking It</p>
<ul>
<li>Take the <em>age</em> variable out of the first <em>printf</em> call, then recompile. You should get a couple of warnings.</li>
<li>Run this new program and it will either crash or print out a really crazy age.</li>
<li>Put the <em>printf</em> back the way it was, and then don't set <em>age</em> to an initial value by changing that line to <em>int age;</em>, and then rebuild it and run it again.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Find as many other ways to break <em>ex3.c</em> as you can.</li>
<li>Run <em>man 3 printf</em> and read about the other <em>%</em> format
characters you can use.  These should look familiar if you used
them in other languages (they come from <em>printf</em>).</li>
<li>Add <em>ex3</em> the <em>all</em> list in your <em>Makefile</em>.  Use this
to <em>make clean all</em> and build all of your exercises thus far.</li>
<li>Add <em>ex3</em> to your <em>clean</em> list in your<em>Makefile</em> as well.
Use <em>make clean</em> to remove it when you need to.</li>
</ul>
<h3 id="exercise-4-using-a-debugger">Exercise 4 Using a Debugger</h3>
<p>The Plan</p>
<ul>
<li>See how GDB works (LLDB on OSX).</li>
<li>Look at memory checkers like Valgrind and AddressSanitizer.</li>
<li>Cover the quick reference.</li>
<li>Debug a program.</li>
</ul>
<p>Using GDB</p>
<p>Using LLDB</p>
<p>Using Valgrind</p>
<p>Using Lint</p>
<p>Using AddressSanitizer</p>
<p>You neeed clang for this.</p>
<p>&ldquo;The Debugger&rdquo;</p>
<p>When I say &ldquo;the debugger&rdquo; in the book I mean to use GDB, but use
every tool you can find that helps.</p>
<h3 id="exercise-5-memorizing-c-operators">Exercise 5 Memorizing C Operators</h3>
<p>The Plan</p>
<ul>
<li>Learn why memorizing works.</li>
<li>Learn how to memorize things.</li>
<li>Review the C operators.</li>
</ul>
<p>Memorization</p>
<ul>
<li>A &ldquo;backdoor&rdquo; hack to learning.</li>
<li>Memorize the operators, then reading is easier.</li>
<li>Works with any language.</li>
</ul>
<p>Memorization Proces</p>
<ul>
<li>Write everything on index cards.</li>
<li>Use Anki, but make your own cards.</li>
<li>Spend 30-60 minutes a day.</li>
<li>Track what you don't know, drill those more.</li>
</ul>
<p>Arithmetic Operators</p>
<pre><code>+    Add
-    Subtract
*    Multiply
/    Divide
%    Modulus
++   Increment
--   Decrement
</code></pre>
<p>Relational Operators</p>
<pre><code>==   Equal
!=   Not equal
&gt;    Greater than
&lt;    Less than
&gt;=   Greater than equal
&lt;=   Less than equal
</code></pre>
<p>Logical Operators</p>
<pre><code>&amp;&amp;   Logical and
||   Logical or
!    Logical not
? :  Logical ternary
</code></pre>
<p>Bitwise Operators</p>
<pre><code>&amp;    Bitwise and
|    Bitwise or
^    Bitwise xor
~    Bitwise ones compliment
&lt;&lt;   Bitwise shift left
&gt;&gt;   Bitwise shift right
</code></pre>
<p>Assignment Operators</p>
<pre><code>=    Assign equal
+=   Assign plus-equal
-=   Assign minus-equal
*=   Assign multiply-equal
/=   Assign divide-equal
%=   Assign modulus-equal
&lt;&lt;=  Assign shift-left-equal
&gt;&gt;=  Assign shift-right-equal
&amp;=   Assign and-equal
^=   Assign xor-equal
|=   Assign or-equal
</code></pre>
<p>Data Operators</p>
<pre><code>sizeof() Get the size of
[]       Array subscript
&amp;        The address of
*        The value of
-&gt;       Structure dereference
.        Structure reference
</code></pre>
<p>Miscellaneous Operators</p>
<pre><code>,         Comma
( )       Parenthesis
{ }       Braces
:         Colon
//        Single-line comment start
/*        Multi-line comment start
*/        Multi-line comment end
</code></pre>
<h3 id="exercise-6-memorizing-c-syntax">Exercise 6 Memorizing C Syntax</h3>
<p>The Plan</p>
<ul>
<li>Memorize the keywords of C.</li>
<li>Memorize the major syntax forms.</li>
</ul>
<p>Execution Keywords
break     Exit out of a compound statement.
case      A branch in a switch-statement.
continue  Continue to the top of a loop.
do        Start a do-while loop.
default   Default branch in a switch-statement.
else      An else branch of an if-statement.
for       Start a for-loop.
goto      Jump to a label.
if        Starts an if-statement.
return    Return from a function.
switch    Start a switch-statement.
while     Start a while-loop.</p>
<p>Type Keywords
char      Character data type.
double    A double floating point data type.
float     A floating point data type.
int       An integer data type.
long      A long integer data type.
short     A short integer data type.
void      Declare a data type empty.
union     Start a union-statement.
struct    Combine variables into a single record.</p>
<p>Data Keywords</p>
<pre><code>auto      Give a local variable a local lifetime.
const     Make a variable unmodifiable.
enum      Define a set of int constants.
extern    Declare an identifier is defined externally.
register  Declare a variable be stored in a CPU register.
signed    A signed modifier for integer data types.
sizeof    Determine the size of data.
static    Preserve variable value after its scope exits.
typedef   Create a new type.
unsigned  An unsigned modifier for integer data types.
volatile  Declare a variable might be modified elsewhere.
</code></pre>
<p>If-Statement</p>
<pre><code>if(TEST) {
    CODE;
} else if(TEST) {
    CODE;
} else {
    CODE;
}
</code></pre>
<p>Switch-Statement</p>
<pre><code>switch (OPERAND) {
    case CONSTANT:
        CODE;
        break;
    default:
        CODE;
}
</code></pre>
<p>While-Loop</p>
<pre><code>while(TEST) {
    CODE;
}
</code></pre>
<p>While with Continue</p>
<pre><code>while(TEST) {
    if(OTHER_TEST) {
        continue;
    }
    CODE;
}
</code></pre>
<p>While with Break</p>
<pre><code>while(TEST) {
    if(OTHER_TEST) {
        break;
    }
    CODE;
}
</code></pre>
<p>Do-While</p>
<pre><code>do {
    CODE;
} while(TEST);
</code></pre>
<p>For-Loop</p>
<pre><code>for(INIT; TEST; POST) {
    CODE;
}
</code></pre>
<ul>
<li><em>continue</em> and <em>break</em> work with <em>for</em></li>
</ul>
<p>Enum</p>
<pre><code>enum { CONST1, CONST2, CONST3 } NAME;
</code></pre>
<p>Goto</p>
<pre><code>if(ERROR_TEST) {
    goto fail;
}

fail:
    CODE;
</code></pre>
<p>Functions</p>
<pre><code>TYPE NAME(ARG1, ARG2, ..) {
    CODE;
    return VALUE;
}
</code></pre>
<p>Typedef</p>
<pre><code>typedef DEFINITION IDENTIFIER;

typedef unsigned char byte;
</code></pre>
<p>Struct</p>
<pre><code>struct NAME {
    ELEMENTS;
} [VARIABLE_NAME];
</code></pre>
<p>Typedef Struct</p>
<pre><code>typedef struct [STRUCT_NAME] {
    ELEMENTS;
} IDENTIFIER;
</code></pre>
<p>Union</p>
<pre><code>union NAME {
    ELEMENTS;
} [VARIABLE_NAME];
</code></pre>
<h3 id="exercise-7-variables-and-types">Exercise 7 Variables and Types</h3>
<p>The Plan</p>
<ul>
<li>Learn some basic variables and types.</li>
<li>int, float, double, char, and strings.</li>
</ul>
<p>The Code</p>
<p>.\ex07\ex7.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> distance <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>;
    <span style="color:#66d9ef">float</span> power <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.345f</span>;
    <span style="color:#66d9ef">double</span> super_power <span style="color:#f92672">=</span> <span style="color:#ae81ff">56789.4532</span>;
    <span style="color:#66d9ef">char</span> initial <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">A</span><span style="color:#e6db74">&#39;</span>;
    <span style="color:#66d9ef">char</span> first_name[] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Zed</span><span style="color:#e6db74">&#34;</span>;
    <span style="color:#66d9ef">char</span> last_name[] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Shaw</span><span style="color:#e6db74">&#34;</span>;

    first_name[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Z</span><span style="color:#e6db74">&#39;</span>;

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">You are %d miles away.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, distance);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">You have %f levels of power.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, power);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">You have %f awesome super powers.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, super_power);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">I have an initial %c.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, initial);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">I have a first name %s.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, first_name);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">I have a last name %s.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, last_name);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">My whole name is %s %c. %s.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,
            first_name, initial, last_name);

    <span style="color:#66d9ef">int</span> bugs <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>;
    <span style="color:#66d9ef">double</span> bug_rate <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.2</span>;

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">You have %d bugs at the imaginary rate of %f.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,
            bugs, bug_rate);

    <span style="color:#66d9ef">long</span> universe_of_defects <span style="color:#f92672">=</span> <span style="color:#ae81ff">1L</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1024L</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1024L</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1024L</span>;
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">The entire universe has %ld bugs.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, universe_of_defects);

    <span style="color:#66d9ef">double</span> expected_bugs <span style="color:#f92672">=</span> bugs <span style="color:#f92672">*</span> bug_rate;
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">You are expected to have %f bugs.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, expected_bugs);

    <span style="color:#66d9ef">double</span> part_of_universe <span style="color:#f92672">=</span> expected_bugs <span style="color:#f92672">/</span> universe_of_defects;
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">That is only a %e portion of the universe.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,
            part_of_universe);

    <span style="color:#75715e">// this makes no sense, just a demo of something weird
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">char</span> nul_byte <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>;
    <span style="color:#66d9ef">int</span> care_percentage <span style="color:#f92672">=</span> bugs <span style="color:#f92672">*</span> nul_byte;
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Which means you should care %d%%.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, care_percentage);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>The Analysis</p>
<p>Breaking It</p>
<ul>
<li>Strings give us so much more fun now!</li>
<li>Crafting bad strings.</li>
<li>Messing with pointers.</li>
<li>Abusing printf.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Make the number you assign to <em>universe_of_defects</em> various
sizes until you get a warning from the compiler.</li>
<li>What do these really huge numbers actually print out?</li>
<li>Change <em>long</em> to <em>unsigned long</em> and try to find
the number that makes it too big.</li>
<li>Go search online to find out what <em>unsigned</em> does.</li>
<li>Try to explain to yourself (before I do in the next exercise)
why you can multiply a <em>char</em> and an <em>int</em>.</li>
</ul>
<h3 id="exercise-8-if-else-if-else">Exercise 8 If, Else-If, Else</h3>
<p>The Plan</p>
<p>Simply learn to use this:</p>
<pre><code>if(TEST) {
    CODE;
} else if(TEST) {
    CODE;
} else {
    CODE;
}
</code></pre>
<p>The Code</p>
<p>.\ex08\ex8.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">You only have one argument. You suck.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> argc <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Here&#39;s your arguments:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);

        <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> argc; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
            printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s </span><span style="color:#e6db74">&#34;</span>, argv[i]);
        }
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">You have too many arguments. You suck.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>The Analysis</p>
<p>Breaking It</p>
<ul>
<li>It kind of just works, but remove the <em>else</em> and change the logic.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>You were briefly introduced to <em>&amp;&amp;</em>, which does an <em>and</em> comparison,
so go research online the different <em>Boolean operators</em>.</li>
<li>Write a few more test cases for this program to see what you can come
up with.</li>
</ul>
<h3 id="exercise-9-while-loop-and-boolean-expressions">Exercise 9 While-Loop and Boolean Expressions</h3>
<p>The Plan</p>
<p>You first loop shall be the <em>while</em>:</p>
<pre><code>while(TEST) {
    CODE;
}
</code></pre>
<p>The Code</p>
<p>.\ex09\ex9.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> i;
    <span style="color:#66d9ef">while</span> (i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">25</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, i);
        i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>The Analysis</p>
<p>Breaking It</p>
<ul>
<li>Forget to initialize the <em>int i</em>.</li>
<li>Forget to do an i++ and make it run forever.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Make the loop count backward by using <code>i--</code> to start
at 25 and go to 0.</li>
<li>Write a few more complex <code>while-loops</code> using what you know
so far.</li>
</ul>
<h3 id="exercise-10-switch-statements">Exercise 10 Switch Statements</h3>
<p>The Plan</p>
<ul>
<li>Learn about the <em>switch-statement</em> and indirectly jump tables.</li>
<li>Write a program that takes a command line argument.</li>
</ul>
<p>The Code</p>
<p>.\ex10\ex10.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">ERROR: You need one argument.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
        <span style="color:#75715e">// this is how you abort a program
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
    }

    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; argv[<span style="color:#ae81ff">1</span>][i] <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        <span style="color:#66d9ef">char</span> letter <span style="color:#f92672">=</span> argv[<span style="color:#ae81ff">1</span>][i];

        <span style="color:#66d9ef">switch</span> (letter) {
            <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">a</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">A</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
                printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d: &#39;A&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, i);
                <span style="color:#66d9ef">break</span>;

            <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">e</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">E</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
                printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d: &#39;E&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, i);
                <span style="color:#66d9ef">break</span>;

            <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">i</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">I</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
                printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d: &#39;I&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, i);
                <span style="color:#66d9ef">break</span>;

            <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">o</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">O</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
                printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d: &#39;O&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, i);
                <span style="color:#66d9ef">break</span>;

            <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">U</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
                printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d: &#39;U&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, i);
                <span style="color:#66d9ef">break</span>;

            <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">y</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Y</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
                <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span>) {
                    <span style="color:#75715e">// it&#39;s only sometimes Y
</span><span style="color:#75715e"></span>                    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d: &#39;Y&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, i);
                }
                <span style="color:#66d9ef">break</span>;

            <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
                printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d: %c is not a vowel</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, i, letter);
        }
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>The Analysis</p>
<p>Let's talk about jump tables, in the naive sense.</p>
<p>Breaking It</p>
<ul>
<li>Forget a <em>break</em>, and it'll run two or more blocks of code you don't want it to run.</li>
<li>Forget a <em>default</em>, and it'll silently ignore values you forgot.</li>
<li>Accidentally put a variable into the <em>switch</em> that evaluates to something unexpected, like an <em>int</em>, which becomes weird values.</li>
<li>Use uninitialized values in the <em>switch</em>.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Write another program that uses math on the letter to
convert it to lowercase, and then remove all of the extraneous
uppercase letters in the switch.</li>
<li>Use the <em>','</em> (comma) to initialize <em>letter</em>
in the <em>for-loop</em>.</li>
<li>Make it handle all of the arguments you pass it with
yet another <em>for-loop</em>.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Convert this <em>switch-statement</em> to an <em>if-statement</em>.
Which do you like better?</li>
<li>In the case for &lsquo;Y&rsquo; I have the break outside of the <em>if-statement</em>. What's the impact of this,
and what happens if you move it inside of the <em>if-statement</em>. Prove to yourself that you're right.</li>
</ul>
<h3 id="exercise-11-arrays-and-strings">Exercise 11 Arrays and Strings</h3>
<p>The Plan</p>
<ul>
<li>Learn the similarity between arrays and strings.</li>
<li>Avoid getting pedantic about them.</li>
<li>Learn how C stores strings and processes them.</li>
</ul>
<p>The Code</p>
<p>.\ex11\ex11.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> numbers[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> { <span style="color:#ae81ff">0</span> };
    <span style="color:#66d9ef">char</span> name[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> { <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">a</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">a</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">a</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">a</span><span style="color:#e6db74">&#39;</span> };

    <span style="color:#75715e">// first, print them out raw
</span><span style="color:#75715e"></span>    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">numbers: %d %d %d %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,
            numbers[<span style="color:#ae81ff">0</span>], numbers[<span style="color:#ae81ff">1</span>], numbers[<span style="color:#ae81ff">2</span>], numbers[<span style="color:#ae81ff">3</span>]);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">name each: %c %c %c %c</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,
            name[<span style="color:#ae81ff">0</span>], name[<span style="color:#ae81ff">1</span>], name[<span style="color:#ae81ff">2</span>], name[<span style="color:#ae81ff">3</span>]);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">name: %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, name);

    <span style="color:#75715e">// setup the numbers
</span><span style="color:#75715e"></span>    numbers[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
    numbers[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
    numbers[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;
    numbers[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>;

    <span style="color:#75715e">// setup the name
</span><span style="color:#75715e"></span>    name[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Z</span><span style="color:#e6db74">&#39;</span>;
    name[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">e</span><span style="color:#e6db74">&#39;</span>;
    name[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">d</span><span style="color:#e6db74">&#39;</span>;
    name[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">A</span><span style="color:#e6db74">&#39;</span>;

    <span style="color:#75715e">// then print them out initialized
</span><span style="color:#75715e"></span>    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">numbers: %d %d %d %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,
            numbers[<span style="color:#ae81ff">0</span>], numbers[<span style="color:#ae81ff">1</span>], numbers[<span style="color:#ae81ff">2</span>], numbers[<span style="color:#ae81ff">3</span>]);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">name each: %c %c %c %c</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,
            name[<span style="color:#ae81ff">0</span>], name[<span style="color:#ae81ff">1</span>], name[<span style="color:#ae81ff">2</span>], name[<span style="color:#ae81ff">3</span>]);

    <span style="color:#75715e">// print the name like a string
</span><span style="color:#75715e"></span>    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">name: %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, name);

    <span style="color:#75715e">// another way to use name
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>another <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Zed</span><span style="color:#e6db74">&#34;</span>;

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">another: %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, another);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">another each: %c %c %c %c</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,
            another[<span style="color:#ae81ff">0</span>], another[<span style="color:#ae81ff">1</span>], another[<span style="color:#ae81ff">2</span>], another[<span style="color:#ae81ff">3</span>]);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>The Analysis</p>
<p>Breaking It</p>
<p>So many ways to break this!</p>
<ul>
<li>Get rid of the initializers that set up <em>name</em>.</li>
<li>Accidentally set <em>name[3] = &lsquo;A&rsquo;;</em> so that there's no terminator.</li>
<li>Set the initializer to <em>{&lsquo;a&rsquo;,&lsquo;a&rsquo;,&lsquo;a&rsquo;,&lsquo;a&rsquo;}</em> so that there are too many
&lsquo;a&rsquo; characters and no space for the <em>'\0&rsquo;</em> terminator.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Assign the characters into <em>numbers</em>, and then use <em>printf</em>
to print them one character at a time.  What kind of compiler warnings
do you get?</li>
<li>Do the inverse for <em>name</em>, trying to treat it like an array
of <em>int</em> and print it out one <em>int</em> at a time.  What
does the debugger think of that?</li>
<li>In how many other ways can you print this out?</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>If an array of characters is 4 bytes long, and an integer is 4 bytes
long, then can you treat the whole <em>name</em> array like it's just
an integer?  How might you accomplish this crazy hack?</li>
<li>Take out a piece of paper and draw each of these arrays as a
row of boxes. Then do the operations you just did on paper to see
if you get them right.</li>
<li>Convert <em>name</em> to be in the style of <em>another</em> and see
if the code keeps working.</li>
</ul>
<h3 id="exercise-12-sizes-and-arrays">Exercise 12 Sizes and Arrays</h3>
<p>The Plan</p>
<ul>
<li>Learn about <em>sizeof</em> and how it relates to arrays.</li>
</ul>
<p>The Code</p>
<p>.\ex12\ex12.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> areas[] <span style="color:#f92672">=</span> { <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">20</span> };
    <span style="color:#66d9ef">char</span> name[] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Zed</span><span style="color:#e6db74">&#34;</span>;
    <span style="color:#66d9ef">char</span> full_name[] <span style="color:#f92672">=</span> {
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Z</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">e</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">d</span><span style="color:#e6db74">&#39;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> </span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">A</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">.</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> </span><span style="color:#e6db74">&#39;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">S</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">h</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">a</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">w</span><span style="color:#e6db74">&#39;</span> 
    };

    <span style="color:#75715e">// WARNING: On some systems you may have to change the
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// %ld in this code to a %u since it will use unsigned ints
</span><span style="color:#75715e"></span>    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">The size of an int: %ld</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>));
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">The size of areas (int[]): %ld</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#66d9ef">sizeof</span>(areas));
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">The number of ints in areas: %ld</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,
            <span style="color:#66d9ef">sizeof</span>(areas) <span style="color:#f92672">/</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>));
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">The first area is %d, the 2nd %d.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, areas[<span style="color:#ae81ff">0</span>], areas[<span style="color:#ae81ff">1</span>]);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">The size of a char: %ld</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">char</span>));
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">The size of name (char[]): %ld</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#66d9ef">sizeof</span>(name));
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">The number of chars: %ld</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#66d9ef">sizeof</span>(name) <span style="color:#f92672">/</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">char</span>));

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">The size of full_name (char[]): %ld</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#66d9ef">sizeof</span>(full_name));
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">The number of chars: %ld</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,
            <span style="color:#66d9ef">sizeof</span>(full_name) <span style="color:#f92672">/</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">char</span>));

    full_name[<span style="color:#ae81ff">12</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">X</span><span style="color:#e6db74">&#39;</span>;

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">name=</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74"> and full_name=</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, name, full_name);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>The Analysis</p>
<p>Breaking It</p>
<ul>
<li>Get rid of the <em>'\0&rsquo;</em> at the end of <em>full_name</em>
and re-run it.  Run it under the debugger, too.  Now, move the definition
of <em>full_name</em> to the top of <em>main</em> before <em>areas</em>.
Try running it under the debugger a few times and see if you get some
new errors.  In some cases, you might still get lucky and not catch
any errors.</li>
<li>Change it so that instead of <em>areas[0]</em> you try to
print <em>areas[10]</em>.  See what the debugger thinks of that.</li>
<li>Try other ways to break it like this, doing it to <em>name</em> and
<em>full_name</em> too.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Try assigning to elements in the <em>areas</em> array with <em>areas[0] = 100;</em> and similar.</li>
<li>Try assigning to elements of <em>name</em> and <em>full_name</em>.</li>
<li>Try setting one element of <em>areas</em> to a character from <em>name</em>.</li>
<li>Search online for the different sizes used for integers on different
CPUs.</li>
</ul>
<h3 id="exercise-13-for-loops-and-arrays-of-strings">Exercise 13 For-Loops and Arrays of Strings</h3>
<p>The Plan</p>
<p>Learn about this code:</p>
<pre><code>for(INITIALIZER; TEST; INCREMENTER) {
    CODE;
}
</code></pre>
<p>The Code</p>
<p>.\ex13\ex13.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#75715e">// go through each string in argv
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// why am I skipping argv[0]?
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> argc; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">arg %d: %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, i, argv[i]);
    }

    <span style="color:#75715e">// let&#39;s make our own array of strings
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>states[] <span style="color:#f92672">=</span> {
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">California</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Oregon</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Washington</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Texas</span><span style="color:#e6db74">&#34;</span>
    };

    <span style="color:#66d9ef">int</span> num_states <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> num_states; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">state %d: %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, i, states[i]);
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>The Analysis</p>
<p>Breaking It</p>
<ul>
<li>Take your favorite other language and use it to run this program, but include as many command line arguments as possible.  See if you can bust it
by giving it way too many arguments.</li>
<li>Initialize <em>i</em> to 0 and see what that does.  Do you have to adjust
<em>argc</em> as well, or does it just work?  Why does 0-based indexing work
here?</li>
<li>Set <em>num_states</em> wrong so that it's a higher value and see what
it does.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Figure out what kind of code you can put into the parts of a <em>for-loop</em>.</li>
<li>Look up how to use the comma character (,) to separate multiple
statements in the parts of the <em>for-loop</em>, but between the semicolon characters (;).</li>
<li>Read what a <em>NULL</em> is and try to use it in one of the elements from the
<em>states</em> array to see what it'll print.</li>
<li>See if you can assign an element from the <em>states</em> array to the
<em>argv</em> array before printing both.  Try the inverse.</li>
</ul>
<h3 id="exercise-14-writing-and-using-functions">Exercise 14 Writing and Using Functions</h3>
<p>The Plan</p>
<ul>
<li>Write your very first functions.</li>
</ul>
<p>The Code</p>
<p>.\ex14\ex14.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;ctype.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// forward declarations
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">can_print_it</span>(<span style="color:#66d9ef">char</span> ch);
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print_letters</span>(<span style="color:#66d9ef">char</span> arg[]);

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print_arguments</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> argc; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        print_letters(argv[i]);
    }
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print_letters</span>(<span style="color:#66d9ef">char</span> arg[])
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; arg[i] <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        <span style="color:#66d9ef">char</span> ch <span style="color:#f92672">=</span> arg[i];

        <span style="color:#66d9ef">if</span> (can_print_it(ch)) {
            printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#39;%c&#39; == %d </span><span style="color:#e6db74">&#34;</span>, ch, ch);
        }
    }

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">can_print_it</span>(<span style="color:#66d9ef">char</span> ch)
{
    <span style="color:#66d9ef">return</span> isalpha(ch) <span style="color:#f92672">|</span><span style="color:#f92672">|</span> isblank(ch);
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    print_arguments(argc<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, argv);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>The Analysis</p>
<p>Breaking It</p>
<ul>
<li>Remove the forward declarations to confuse the compiler and cause it to complains about <em>can_print_it</em> and <em>print_letters</em>.</li>
<li>When you call <em>print_arguments</em> inside <em>main</em>, try
adding 1 to <em>argc</em> so that it goes past the end of the
<em>argv</em> array.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Rework these functions so that you have fewer functions.  For example,
do you really need <em>can_print_it</em>?</li>
<li>Have <em>print_arguments</em> figure out how long each argument string
is by using the <em>strlen</em> function, and then pass that length
to <em>print_letters</em>.  Then, rewrite <em>print_letters</em>
so it only processes this fixed length and doesn't rely on the
<em>'\0&rsquo;</em> terminator.  You'll need the <em>#include &lt;string.h&gt;</em> for this.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Use <em>man</em> to look up information on <em>isalpha</em>
and <em>isblank</em>.  Use other similar functions to
print out only digits or other characters.</li>
<li>Go read about how other people like to format their
functions.  Never use the <em>K&amp;R syntax</em> (it's antiquated and
confusing) but understand what it's doing in case you run
into someone who likes it.</li>
</ul>
<h3 id="exercise-15-pointers-dreaded-pointers">Exercise 15 Pointers, Dreaded Pointers</h3>
<p>The Plan</p>
<ul>
<li>A long video on C pointers.</li>
<li>Lots of demonstration and visuals.</li>
</ul>
<p>The Code</p>
<p>.\ex15\ex15.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#75715e">// create two arrays we care about
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> ages[] <span style="color:#f92672">=</span> { <span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">43</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">89</span>, <span style="color:#ae81ff">2</span> };
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>names[] <span style="color:#f92672">=</span> {
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Alan</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Frank</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Mary</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">John</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Lisa</span><span style="color:#e6db74">&#34;</span>
    };

    <span style="color:#75715e">// safely get the size of ages
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> <span style="color:#66d9ef">sizeof</span>(ages) <span style="color:#f92672">/</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>);
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#75715e">// first way using indexing
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> count; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s has %d years alive.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, names[i], ages[i]);
    }

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">---</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#75715e">// setup the pointers to the start of the arrays
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>cur_age <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>)names;
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#f92672">*</span>cur_name <span style="color:#f92672">=</span> names;

    <span style="color:#75715e">// second way using pointers
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> count; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s is %d years old.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,
                <span style="color:#f92672">*</span>(cur_name <span style="color:#f92672">+</span> i), <span style="color:#f92672">*</span>(cur_age <span style="color:#f92672">+</span> i));
    }

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">---</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#75715e">// third way, pointers are just arrays
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> count; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s is %d years old again.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, cur_name[i], cur_age[i]);
    }

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">---</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#75715e">// fourth way with pointers in a stupid complex way
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (cur_name <span style="color:#f92672">=</span> names, cur_age <span style="color:#f92672">=</span> ages;
            (cur_age <span style="color:#f92672">-</span> ages) <span style="color:#f92672">&lt;</span> count; cur_name<span style="color:#f92672">+</span><span style="color:#f92672">+</span>, cur_age<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s lived %d years so far.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">*</span>cur_name, <span style="color:#f92672">*</span>cur_age);
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>The Pointer Lexicon</p>
<pre><code>type *ptr A pointer of type named ptr
*ptr The value of whatever ptr is pointed at
*(ptr + i) The value of (whatever ptr is pointed at plus i)
&amp;thing The address of thing
type *ptr = &amp;thing A pointer of type named ptr set to the address of thing
ptr++ Increment where ptr points
</code></pre>
<p>Pointers Visually</p>
<p>The Analysis</p>
<p>Breaking It</p>
<ul>
<li>Try to make <em>cur_age</em> point at <em>names</em>.  You'll need to
use a C cast to force it, so go look that up and try to figure it out.</li>
<li>In the final <em>for-loop</em>, try getting the math wrong in weird ways.</li>
<li>Try rewriting the loops so that they start at the end of the arrays and go
to the beginning.  This is harder than it looks.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Rewrite all of the arrays in this program as pointers.</li>
<li>Rewrite all of the pointers as arrays.</li>
<li>Go back to some of the other programs that use arrays and
try to use pointers instead.</li>
<li>Process command line arguments using just pointers similar to how
you did <em>names</em> in this one.</li>
<li>Play with combinations of getting the value of and the address of
things.</li>
<li>Add another <em>for-loop</em> at the end that prints out the
addresses that these pointers are using.  You'll need the <em>%p</em> format
for <em>printf</em>.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Rewrite this program to use a function for each of the ways you're
printing out things.  Try to pass pointers to these functions so that
they work on the data.  Remember you can declare a function to accept
a pointer, but just use it like an array.</li>
<li>Change the <em>for-loops</em> to <em>while-loops</em> and see what
works better for which kind of pointer usage.</li>
</ul>
<h3 id="exercise-16-structs-and-pointers-to-them">Exercise 16 Structs And Pointers To Them</h3>
<p>The Plan</p>
<ul>
<li>Learn to work with <em>structs</em> to structure data and make new types.</li>
<li>Learn to use pointers to work with <em>structs</em> better.</li>
</ul>
<p>The Code</p>
<p>.\ex16\ex16.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;assert.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">struct</span> Person {
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>name;
    <span style="color:#66d9ef">int</span> age;
    <span style="color:#66d9ef">int</span> height;
    <span style="color:#66d9ef">int</span> weight;
};

<span style="color:#66d9ef">struct</span> Person <span style="color:#f92672">*</span><span style="color:#a6e22e">Person_create</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>name, <span style="color:#66d9ef">int</span> age, <span style="color:#66d9ef">int</span> height,
        <span style="color:#66d9ef">int</span> weight)
{
    <span style="color:#66d9ef">struct</span> Person <span style="color:#f92672">*</span>who <span style="color:#f92672">=</span> malloc(<span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">struct</span> Person));
    assert(who <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL);

    who<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>name <span style="color:#f92672">=</span> strdup(name);
    who<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>age <span style="color:#f92672">=</span> age;
    who<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>height <span style="color:#f92672">=</span> height;
    who<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>weight <span style="color:#f92672">=</span> weight;

    <span style="color:#66d9ef">return</span> who;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Person_destroy</span>(<span style="color:#66d9ef">struct</span> Person <span style="color:#f92672">*</span>who)
{
    assert(who <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL);

    free(who<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>name);
    free(who);
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Person_print</span>(<span style="color:#66d9ef">struct</span> Person <span style="color:#f92672">*</span>who)
{
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Name: %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, who<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>name);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">Age: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, who<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>age);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">Height: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, who<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>height);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">Weight: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, who<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>weight);
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#75715e">// make two people structures
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">struct</span> Person <span style="color:#f92672">*</span>joe <span style="color:#f92672">=</span> Person_create(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Joe Alex</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">140</span>);

    <span style="color:#66d9ef">struct</span> Person <span style="color:#f92672">*</span>frank <span style="color:#f92672">=</span> Person_create(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Frank Blank</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">72</span>, <span style="color:#ae81ff">180</span>);

    <span style="color:#75715e">// print them out and where they are in memory
</span><span style="color:#75715e"></span>    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Joe is at memory location %p:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, joe);
    Person_print(joe);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Frank is at memory location %p:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, frank);
    Person_print(frank);

    <span style="color:#75715e">// make everyone age 20 years and print them again
</span><span style="color:#75715e"></span>    joe<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>age <span style="color:#f92672">+</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>;
    joe<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>height <span style="color:#f92672">-</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
    joe<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>weight <span style="color:#f92672">+</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>;
    Person_print(joe);

    frank<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>age <span style="color:#f92672">+</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>;
    frank<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>weight <span style="color:#f92672">+</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>;
    free(frank);
    Person_print(frank);

    <span style="color:#75715e">// destroy them both so we clean up
</span><span style="color:#75715e"></span>    Person_destroy(joe);
    Person_destroy(frank);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>The Analysis</p>
<p>Breaking It</p>
<ul>
<li>Try passing <em>NULL</em> to <em>Person_destroy</em> see what
it does.  If it doesn't abort, then you must not have the
<em>-g</em> option in your Makefile's <em>CFLAGS</em>.</li>
<li>Forget to call <em>Person_destroy</em> at the end, and then run
it under the debugger to see it report that you forgot
to free the memory.  Figure out the options you need to pass
to the debugger to get it to print how you leaked
this memory.</li>
</ul>
<p>Breaking It</p>
<ul>
<li>Forget to free <em>who-&gt;name</em> in <em>Person_destroy</em>
and compare the output.  Again, use the right options to
see how the debugger tells you exactly where you messed
up.</li>
<li>This time, pass <em>NULL</em> to <em>Person_print</em> and
see what the debugger thinks of that. You'll figure out that <em>NULL</em> is a quick way
to crash your program.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>How to create a <em>struct</em> on the <em>stack</em> just like you're making any other variable.</li>
<li>How to initialize it using the <em>x.y</em> (period) character
instead of the <em>x-&gt;y</em> syntax.</li>
<li>How to pass a structure to other functions without using
a pointer.</li>
</ul>
<h3 id="exercise-17-heap-and-stack-memory-allocation">Exercise 17 Heap and Stack Memory Allocation</h3>
<p>The Plan</p>
<ul>
<li>Learn to allocate data on the heap using <em>malloc</em>.</li>
<li>Memory management techniques to avoid leaking.</li>
<li>How the heap differs from the stack, and when to use them.</li>
</ul>
<p>The Code</p>
<p>.\ex17\ex17.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;assert.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;errno.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define MAX_DATA 512</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define MAX_ROWS 100</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">struct</span> Address {
    <span style="color:#66d9ef">int</span> id;
    <span style="color:#66d9ef">int</span> set;
    <span style="color:#66d9ef">char</span> name[MAX_DATA];
    <span style="color:#66d9ef">char</span> email[MAX_DATA];
};

<span style="color:#66d9ef">struct</span> Database {
    <span style="color:#66d9ef">struct</span> Address rows[MAX_ROWS];
};

<span style="color:#66d9ef">struct</span> Connection {
    FILE <span style="color:#f92672">*</span>file;
    <span style="color:#66d9ef">struct</span> Database <span style="color:#f92672">*</span>db;
};

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">die</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>message)
{
    <span style="color:#66d9ef">if</span> (errno) {
        perror(message);
    } <span style="color:#66d9ef">else</span> {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">ERROR: %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, message);
    }

    exit(<span style="color:#ae81ff">1</span>);
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Address_print</span>(<span style="color:#66d9ef">struct</span> Address <span style="color:#f92672">*</span>addr)
{
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d %s %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, addr<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>id, addr<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>name, addr<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>email);
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Database_load</span>(<span style="color:#66d9ef">struct</span> Connection <span style="color:#f92672">*</span>conn)
{
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> fread(conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>db, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">struct</span> Database), <span style="color:#ae81ff">1</span>, conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>file);
    <span style="color:#66d9ef">if</span> (rc <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
        die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to load database.</span><span style="color:#e6db74">&#34;</span>);
}

<span style="color:#66d9ef">struct</span> Connection <span style="color:#f92672">*</span><span style="color:#a6e22e">Database_open</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>filename, <span style="color:#66d9ef">char</span> mode)
{
    <span style="color:#66d9ef">struct</span> Connection <span style="color:#f92672">*</span>conn <span style="color:#f92672">=</span> malloc(<span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">struct</span> Connection));
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>conn)
        die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Memory error</span><span style="color:#e6db74">&#34;</span>);

    conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>db <span style="color:#f92672">=</span> malloc(<span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">struct</span> Database));
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>db)
        die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Memory error</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">if</span> (mode <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">c</span><span style="color:#e6db74">&#39;</span>) {
        conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>file <span style="color:#f92672">=</span> fopen(filename, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">w</span><span style="color:#e6db74">&#34;</span>);
    } <span style="color:#66d9ef">else</span> {
        conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>file <span style="color:#f92672">=</span> fopen(filename, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">r+</span><span style="color:#e6db74">&#34;</span>);

        <span style="color:#66d9ef">if</span> (conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>file) {
            Database_load(conn);
        }
    }

    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>file)
        die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to open the file</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> conn;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Database_close</span>(<span style="color:#66d9ef">struct</span> Connection <span style="color:#f92672">*</span>conn)
{
    <span style="color:#66d9ef">if</span> (conn) {
        <span style="color:#66d9ef">if</span> (conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>file)
            fclose(conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>file);
        <span style="color:#66d9ef">if</span> (conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>db)
            free(conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>db);
        free(conn);
    }
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Database_write</span>(<span style="color:#66d9ef">struct</span> Connection <span style="color:#f92672">*</span>conn)
{
    rewind(conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>file);

    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> fwrite(conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>db, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">struct</span> Database), <span style="color:#ae81ff">1</span>, conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>file);
    <span style="color:#66d9ef">if</span> (rc <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
        die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to write database.</span><span style="color:#e6db74">&#34;</span>);

    rc <span style="color:#f92672">=</span> fflush(conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>file);
    <span style="color:#66d9ef">if</span> (rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
        die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Cannot flush database.</span><span style="color:#e6db74">&#34;</span>);
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Database_create</span>(<span style="color:#66d9ef">struct</span> Connection <span style="color:#f92672">*</span>conn)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> MAX_ROWS; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        <span style="color:#75715e">// make a prototype to initialize it
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">struct</span> Address addr <span style="color:#f92672">=</span> {.id <span style="color:#f92672">=</span> i,.set <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> };
        <span style="color:#75715e">// then just assign it
</span><span style="color:#75715e"></span>        conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>db<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>rows[i] <span style="color:#f92672">=</span> addr;
    }
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Database_set</span>(<span style="color:#66d9ef">struct</span> Connection <span style="color:#f92672">*</span>conn, <span style="color:#66d9ef">int</span> id, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>name,
        <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>email)
{
    <span style="color:#66d9ef">struct</span> Address <span style="color:#f92672">*</span>addr <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>db<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>rows[id];
    <span style="color:#66d9ef">if</span> (addr<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>set)
        die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Already set, delete it first</span><span style="color:#e6db74">&#34;</span>);

    addr<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>set <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
    <span style="color:#75715e">// WARNING: bug, read the &#34;How To Break It&#34; and fix this
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>res <span style="color:#f92672">=</span> strncpy(addr<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>name, name, MAX_DATA);
    <span style="color:#75715e">// demonstrate the strncpy bug
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>res)
        die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Name copy failed</span><span style="color:#e6db74">&#34;</span>);

    res <span style="color:#f92672">=</span> strncpy(addr<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>email, email, MAX_DATA);
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>res)
        die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Email copy failed</span><span style="color:#e6db74">&#34;</span>);
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Database_get</span>(<span style="color:#66d9ef">struct</span> Connection <span style="color:#f92672">*</span>conn, <span style="color:#66d9ef">int</span> id)
{
    <span style="color:#66d9ef">struct</span> Address <span style="color:#f92672">*</span>addr <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>db<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>rows[id];

    <span style="color:#66d9ef">if</span> (addr<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>set) {
        Address_print(addr);
    } <span style="color:#66d9ef">else</span> {
        die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">ID is not set</span><span style="color:#e6db74">&#34;</span>);
    }
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Database_delete</span>(<span style="color:#66d9ef">struct</span> Connection <span style="color:#f92672">*</span>conn, <span style="color:#66d9ef">int</span> id)
{
    <span style="color:#66d9ef">struct</span> Address addr <span style="color:#f92672">=</span> {.id <span style="color:#f92672">=</span> id,.set <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> };
    conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>db<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>rows[id] <span style="color:#f92672">=</span> addr;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Database_list</span>(<span style="color:#66d9ef">struct</span> Connection <span style="color:#f92672">*</span>conn)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">struct</span> Database <span style="color:#f92672">*</span>db <span style="color:#f92672">=</span> conn<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>db;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> MAX_ROWS; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        <span style="color:#66d9ef">struct</span> Address <span style="color:#f92672">*</span>cur <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>db<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>rows[i];

        <span style="color:#66d9ef">if</span> (cur<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>set) {
            Address_print(cur);
        }
    }
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">3</span>)
        die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">USAGE: ex17 &lt;dbfile&gt; &lt;action&gt; [action params]</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>filename <span style="color:#f92672">=</span> argv[<span style="color:#ae81ff">1</span>];
    <span style="color:#66d9ef">char</span> action <span style="color:#f92672">=</span> argv[<span style="color:#ae81ff">2</span>][<span style="color:#ae81ff">0</span>];
    <span style="color:#66d9ef">struct</span> Connection <span style="color:#f92672">*</span>conn <span style="color:#f92672">=</span> Database_open(filename, action);
    <span style="color:#66d9ef">int</span> id <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">3</span>) id <span style="color:#f92672">=</span> atoi(argv[<span style="color:#ae81ff">3</span>]);
    <span style="color:#66d9ef">if</span> (id <span style="color:#f92672">&gt;</span><span style="color:#f92672">=</span> MAX_ROWS) die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">There&#39;s not that many records.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">switch</span> (action) {
        <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">c</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
            Database_create(conn);
            Database_write(conn);
            <span style="color:#66d9ef">break</span>;

        <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">g</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>)
                die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Need an id to get</span><span style="color:#e6db74">&#34;</span>);

            Database_get(conn, id);
            <span style="color:#66d9ef">break</span>;

        <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">s</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>)
                die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Need id, name, email to set</span><span style="color:#e6db74">&#34;</span>);

            Database_set(conn, id, argv[<span style="color:#ae81ff">4</span>], argv[<span style="color:#ae81ff">5</span>]);
            Database_write(conn);
            <span style="color:#66d9ef">break</span>;

        <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">d</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>)
                die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Need id to delete</span><span style="color:#e6db74">&#34;</span>);

            Database_delete(conn, id);
            Database_write(conn);
            <span style="color:#66d9ef">break</span>;

        <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">l</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
            Database_list(conn);
            <span style="color:#66d9ef">break</span>;
        <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
            die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Invalid action: c=create, g=get, s=set, d=del, l=list</span><span style="color:#e6db74">&#34;</span>);
    }

    Database_close(conn);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ make ex1. cc -Wall ­g ex17.c -o ex1. 
$ ./ex17 db.dat c 
$ ./ex17 db.dat s <span style="color:#ae81ff">1</span> zed zed@zedshaw.com 
$ ./ex17 db.dat s <span style="color:#ae81ff">2</span> frank frank@zedshaw.com$ 
$ ./ex17 db.dat s <span style="color:#ae81ff">3</span> joe joe@zedshaw.com 
$ 
$ ./ex17 db.dat l 
<span style="color:#ae81ff">1</span> zed zed@zedshaw.com 
<span style="color:#ae81ff">2</span> frank frank@zedshaw.com 
<span style="color:#ae81ff">3</span> joe joe@zedshaw.com 

$ ./ex17 db.dat d <span style="color:#ae81ff">3</span> 
$ ./ex17 db.dat l 
<span style="color:#ae81ff">1</span> zed zed@zedshaw.com 
<span style="color:#ae81ff">2</span> frank frank@zedshaw.com 

$ ./ex17 db.dat g <span style="color:#ae81ff">2</span> 
<span style="color:#ae81ff">2</span> frank frank@zedshaw.com 
</code></pre></div><p>The Analysis</p>
<p>Breaking It</p>
<ul>
<li>The classic way is to remove some of the safety checks so that you can
pass in arbitrary data. For example, remove the check on line 160
that prevents you from passing in any record number.</li>
<li>You can also try corrupting the data file.  Open it in any editor and
change random bytes, and then close it.</li>
<li>You could also find ways to pass bad arguments to the program when it's
run. For example, getting the file and action backwards will make it create
a file named after the action, and then do an action based on the first
character.</li>
</ul>
<p>Breaking It</p>
<ul>
<li>There's a bug in this program because <em>strncpy</em> is poorly
designed.  Go read about <em>strncpy</em> and try to find out what happens
when the <em>name</em> or <em>address</em> you give is <em>greater</em> than
512 bytes.  Fix this by simply forcing the last character to <em>'\0&rsquo;</em>
so that it's always set no matter what (which is what strncpy should do).</li>
<li>In the extra credit, I have you augment the program to create arbitrary
size databases.  Try to see what the biggest database is before you
cause the program to die due to lack of memory from <em>malloc</em>.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>The <em>die</em> function needs to be augmented to let you pass the <em>conn</em>
variable, so it can close it and clean up.</li>
<li>Change the code to accept parameters for <em>MAX_DATA</em> and <em>MAX_ROWS</em>, store them in the <em>Database</em> struct, and write that to the file, thus creating
a database that can be arbitrarily sized.</li>
<li>Add more operations you can do with the database, like <em>find</em>.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Read about how C does it's struct packing, and then try to see why your
file is the size it is.  See if you can calculate a new size after adding
more fields.</li>
<li>Add some more fields to <em>Address</em> and make them searchable.</li>
<li>Write a shell script that will do your testing automatically for you
by running commands in the right order.  Hint: Use <em>set -e</em> at the
top of a <em>bash</em> to make it abort the whole script if any command
has an error.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Try reworking the program to use a single global for the database connection.
How does this new version of the program compare to the other one?</li>
<li>Go research stack data structure and write one in your favorite language,
then try to do it in C.</li>
</ul>
<h3 id="exercise-18-pointers-to-functions">Exercise 18 Pointers to Functions</h3>
<p>The Plan</p>
<ul>
<li>Advanced topic of pointers to functions.</li>
<li>These are very useful but not encountered too often.</li>
</ul>
<p>The Code</p>
<p>.\ex18\ex18.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;errno.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/** Our old friend die from ex17. */</span>
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">die</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>message)
{
    <span style="color:#66d9ef">if</span> (errno) {
        perror(message);
    } <span style="color:#66d9ef">else</span> {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">ERROR: %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, message);
    }

    exit(<span style="color:#ae81ff">1</span>);
}

<span style="color:#75715e">// a typedef creates a fake type, in this
</span><span style="color:#75715e"></span><span style="color:#75715e">// case for a function pointer
</span><span style="color:#75715e"></span><span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">int</span> (<span style="color:#f92672">*</span>compare_cb) (<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b);

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * A classic bubble sort function that uses the 
</span><span style="color:#75715e"> * compare_cb to do the sorting. 
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">bubble_sort</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>numbers, <span style="color:#66d9ef">int</span> count, compare_cb cmp)
{
    <span style="color:#66d9ef">int</span> temp <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>target <span style="color:#f92672">=</span> malloc(count <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>));

    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>target)
        die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Memory error.</span><span style="color:#e6db74">&#34;</span>);

    memcpy(target, numbers, count <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>));

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> count; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        <span style="color:#66d9ef">for</span> (j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> count <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; j<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
            <span style="color:#66d9ef">if</span> (cmp(target[j], target[j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
                temp <span style="color:#f92672">=</span> target[j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>];
                target[j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> target[j];
                target[j] <span style="color:#f92672">=</span> temp;
            }
        }
    }

    <span style="color:#66d9ef">return</span> target;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">sorted_order</span>(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b)
{
    <span style="color:#66d9ef">return</span> a <span style="color:#f92672">-</span> b;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">reverse_order</span>(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b)
{
    <span style="color:#66d9ef">return</span> b <span style="color:#f92672">-</span> a;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">strange_order</span>(<span style="color:#66d9ef">int</span> a, <span style="color:#66d9ef">int</span> b)
{
    <span style="color:#66d9ef">if</span> (a <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span><span style="color:#f92672">|</span> b <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">return</span> a <span style="color:#f92672">%</span> b;
    }
}

<span style="color:#75715e">/** 
</span><span style="color:#75715e"> * Used to test that we are sorting things correctly
</span><span style="color:#75715e"> * by doing the sort and printing it out.
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test_sorting</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>numbers, <span style="color:#66d9ef">int</span> count, compare_cb cmp)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>sorted <span style="color:#f92672">=</span> bubble_sort(numbers, count, cmp);

    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>sorted)
        die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to sort as requested.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> count; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d </span><span style="color:#e6db74">&#34;</span>, sorted[i]);
    }
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);

    free(sorted);
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy</span>(compare_cb cmp)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>data <span style="color:#f92672">=</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)cmp;

    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        data[i] <span style="color:#f92672">=</span> i;
    }

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">dump</span>(compare_cb cmp)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>data <span style="color:#f92672">=</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)cmp;

    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">25</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%02x:</span><span style="color:#e6db74">&#34;</span>, data[i]);
    }

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">if</span> (argc <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>) die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">USAGE: ex18 4 3 1 5 6</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> argc <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#f92672">*</span>inputs <span style="color:#f92672">=</span> argv <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;

    <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>numbers <span style="color:#f92672">=</span> malloc(count <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>));
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>numbers) die(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Memory error.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> count; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        numbers[i] <span style="color:#f92672">=</span> atoi(inputs[i]);
    }

    test_sorting(numbers, count, sorted_order);
    test_sorting(numbers, count, reverse_order);
    test_sorting(numbers, count, strange_order);

    free(numbers);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">SORTED:</span><span style="color:#e6db74">&#34;</span>);
    dump(sorted_order);

    destroy(sorted_order);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">SORTED:</span><span style="color:#e6db74">&#34;</span>);
    dump(sorted_order);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>The Analysis</p>
<p>Breaking It</p>
<p>Let's hack your computer with this code:</p>
<pre><code>unsigned char *data = (unsigned char *)cmp;

for(i = 0; i &lt; 25; i++) {
    printf(&quot;%02x:&quot;, data[i]);
}

printf(&quot;\n&quot;);
</code></pre>
<p>You'll see how the bytes of code that make up your program can also be data.</p>
<p>Extra Credit</p>
<ul>
<li>Get a hex editor and open up <em>ex18</em>, and then find the sequence
of hex digits that start a function to see if you can find the function
in the raw program.</li>
<li>Find other random things in your hex editor and change them.  Rerun your
program and see what happens.  Strings you find are the easiest
things to change.</li>
<li>Pass in the wrong function for the <em>compare_cb</em> and see what
the C compiler complains about.</li>
<li>Pass in NULL and watch your program seriously bite it.  Then, run
the debugger and see what that reports.</li>
<li>Write another sorting algorithm, then change <em>test_sorting</em> so
that it takes <em>both</em> an arbitrary sort function and the sort function's
callback comparison.  Use it to test both of your algorithms.</li>
</ul>
<h3 id="exercise-19-zeds-awesome-debug-macros">Exercise 19 Zed's Awesome Debug Macros</h3>
<p>The Plan</p>
<ul>
<li>Learn about the macros that vastly improve my code quality.</li>
<li>Find out why they help you out.</li>
<li>Explore some advanced C Pre-Processor (CPP) macro magic code generation tricks.</li>
</ul>
<p>The Code</p>
<p>.\ex19\ex19.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">
<span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test_debug</span>()
{
    <span style="color:#75715e">// notice you don&#39;t need the \n
</span><span style="color:#75715e"></span>    debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">I have Brown Hair.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#75715e">// passing in arguments like printf
</span><span style="color:#75715e"></span>    debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">I am %d years old.</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">37</span>);
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test_log_err</span>()
{
    log_err(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">I believe everything is broken.</span><span style="color:#e6db74">&#34;</span>);
    log_err(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">There are %d problems in %s.</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">space</span><span style="color:#e6db74">&#34;</span>);
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test_log_warn</span>()
{
    log_warn(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">You can safely ignore this.</span><span style="color:#e6db74">&#34;</span>);
    log_warn(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Maybe consider looking at: %s.</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/etc/passwd</span><span style="color:#e6db74">&#34;</span>);
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test_log_info</span>()
{
    log_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Well I did something mundane.</span><span style="color:#e6db74">&#34;</span>);
    log_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">It happened %f times today.</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">1.3f</span>);
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">test_check</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>file_name)
{
    FILE <span style="color:#f92672">*</span>input <span style="color:#f92672">=</span> NULL;
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>block <span style="color:#f92672">=</span> NULL;

    block <span style="color:#f92672">=</span> malloc(<span style="color:#ae81ff">100</span>);
    check_mem(block);        <span style="color:#75715e">// should work
</span><span style="color:#75715e"></span>
    input <span style="color:#f92672">=</span> fopen(file_name, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;</span>);
    check(input, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to open %s.</span><span style="color:#e6db74">&#34;</span>, file_name);

    free(block);
    fclose(input);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">if</span> (block) free(block);
    <span style="color:#66d9ef">if</span> (input) fclose(input);
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">test_sentinel</span>(<span style="color:#66d9ef">int</span> code)
{
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>temp <span style="color:#f92672">=</span> malloc(<span style="color:#ae81ff">100</span>);
    check_mem(temp);

    <span style="color:#66d9ef">switch</span> (code) {
        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>
            log_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">It worked.</span><span style="color:#e6db74">&#34;</span>);
            <span style="color:#66d9ef">break</span>;
        <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
            sentinel(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">I shouldn&#39;t run.</span><span style="color:#e6db74">&#34;</span>);
    }

    free(temp);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">if</span> (temp)
        free(temp);
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">test_check_mem</span>()
{
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>test <span style="color:#f92672">=</span> NULL;
    check_mem(test);

    free(test);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;

error:
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">test_check_debug</span>()
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    check_debug(i <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Oops, I was 0.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
error:
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    check(argc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Need an argument.</span><span style="color:#e6db74">&#34;</span>);

    test_debug();
    test_log_err();
    test_log_warn();
    test_log_info();

    check(test_check(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">ex20.c</span><span style="color:#e6db74">&#34;</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">failed with ex20.c</span><span style="color:#e6db74">&#34;</span>);
    check(test_check(argv[<span style="color:#ae81ff">1</span>]) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">failed with argv</span><span style="color:#e6db74">&#34;</span>);
    check(test_sentinel(<span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">test_sentinel failed.</span><span style="color:#e6db74">&#34;</span>);
    check(test_sentinel(<span style="color:#ae81ff">100</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">test_sentinel failed.</span><span style="color:#e6db74">&#34;</span>);
    check(test_check_mem() <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">test_check_mem failed.</span><span style="color:#e6db74">&#34;</span>);
    check(test_check_debug() <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">test_check_debug failed.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}

</code></pre></div><p>The Analysis</p>
<p>Breaking It</p>
<p>These macros are designed on purpose to prevent you from doing this:</p>
<pre><code>if(blah) debug(&quot;This is a thing&quot;);
else debug (&quot;This is another thing&quot;);
</code></pre>
<p>Extra Credit</p>
<ul>
<li>Put <code>#define NDEBUG</code> at the top of the file and check that all
of the debug messages go away.</li>
<li>Undo that line, and add <code>-DNDEBUG</code> to <code>CFLAGS</code> at the
top of the <code>Makefile</code>, and then recompile to see the same thing.</li>
<li>Modify the logging so that it includes the function name, as well
as the <code>file:line</code>.</li>
</ul>
<h3 id="exercise-20-advanced-debugging-techniques">Exercise 20 Advanced Debugging Techniques</h3>
<p>The Plan</p>
<p>Demonstrate more advanced debugging techniques and tools.</p>
<p>The Demonstration</p>
<p>Extra Credit</p>
<ul>
<li>Find a graphical debugger and compare using it to raw <code>gdb</code>.
These are useful when the program you're looking at is local, but they
are pointless if you have to debug a program on a server.</li>
<li>You can enable core dumps on your OS, and when a program crashes,
you'll get a core file.  This core file is like a postmortem of
the program that you can load up to see what happened right at the crash
and what caused it.  Change <code>ex31.c</code> so that it crashes
after a few iterations, then try to get a core dump and analyze it.</li>
</ul>
<h3 id="exercise-21-advanced-data-types-and-flow-control">Exercise 21 Advanced Data Types and Flow Control</h3>
<p>The Plan</p>
<ul>
<li>Learn about the basic types and keywords for them.</li>
<li>Cover all the keywords for modifying those types.</li>
<li>Review fixed exact size types.</li>
<li>Learn all the different operators on those types.</li>
</ul>
<p>This is mostly a review!</p>
<p>Available Data Types</p>
<pre><code>int    Stores a regular integer, defaulting to 32 bits in size.
double Holds a large floating point number.
float  Holds a smaller floating point number.
char   Holds a single 1 byte character.
void   Indicates &quot;no type&quot;.
enum   Enumerated types, which work as and convert to integers.
</code></pre>
<p>Type Modifiers</p>
<pre><code>unsigned  Non-negative numbers.
signed    Gives you negative and positive numbers.
long      Bigger number.
short     Smaller number.
</code></pre>
<p>Type Qualifiers</p>
<pre><code>const     Constant.
volatile  Compiler can't trust it.
register  Put it in a CPU register.
</code></pre>
<p>Type Conversion</p>
<p>C type promotion order:</p>
<ul>
<li>long double</li>
<li>double</li>
<li>float</li>
<li>int (but only char and short int);</li>
<li>long</li>
</ul>
<p>When in doubt, parens it out!</p>
<p>Exact Size Types</p>
<p>If you need exact sizes use these:</p>
<pre><code>int8_t   8-bit signed integer
uint8_t  8-bit unsigned integer
int16_t  16-bit signed integer
uint16_t 16-bit unsigned integer
int32_t  32-bit signed integer
uint32_t 32-bit unsigned integer
int64_t  64-bit signed integer
uint64_t 64-bit unsigned integer
</code></pre>
<p>Getting Sizes</p>
<p>Refer to the book as there's a large number of
macros to help you get size information for types.</p>
<p>Examples:</p>
<pre><code>int_least32_t  int that holds at least 32 bits.
uint_fast32_t  unsigned fastest int for 32 bits.
intptr_t       signed int that can hold a pointer.
PTRDIFF_MAX    maximum value of ptrdiff_t
SIZE_MAX       maximum value of a size_t
</code></pre>
<p>Available Operators</p>
<p>This section is a review of what you memorized already
to make sure you know everything.</p>
<p>Memorize these again to be sure you have them.</p>
<p>Extra Credit</p>
<ul>
<li>Read stdint.h or a description of it, and write out all the
available size identifiers.</li>
<li>Go through each item here and write out what it does in code.  Research it online so you know you got it right.</li>
<li>Get this information memorized by making flash cards and spending 15
minutes a day practicing it.</li>
<li>Create a program that prints out examples of each type, and confirm that your
research is right.</li>
</ul>
<h3 id="exercise-22-the-stack-scope-and-globals">Exercise 22 The Stack, Scope, and Globals</h3>
<p>The Plan</p>
<ul>
<li>Start to learn about scope.</li>
<li>Stack vs. global.</li>
<li>Scope levels inside a function.</li>
<li>The <em>extern</em> keyword.</li>
</ul>
<p>The Code</p>
<p>.\ex22\ex22.h</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">ifndef _ex22_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define _ex22_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">struct</span> State {
    <span style="color:#66d9ef">int</span> the_size;
    <span style="color:#66d9ef">int</span> the_age;
};

<span style="color:#75715e">// gets and sets an internal static variable in ex22.c
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">get_age</span>(<span style="color:#66d9ef">struct</span> State <span style="color:#f92672">*</span>state);
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set_age</span>(<span style="color:#66d9ef">struct</span> State <span style="color:#f92672">*</span>state, <span style="color:#66d9ef">int</span> age);

<span style="color:#75715e">// updates a static variable that&#39;s inside update_ratio
</span><span style="color:#75715e"></span><span style="color:#66d9ef">double</span> <span style="color:#a6e22e">update_ratio</span>(<span style="color:#66d9ef">double</span> ratio);

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print_size</span>();

<span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
</code></pre></div><p>.\ex22\ex22.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;ex22.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">get_age</span>(<span style="color:#66d9ef">struct</span> State <span style="color:#f92672">*</span>state)
{
    <span style="color:#66d9ef">return</span> state<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>the_age;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set_age</span>(<span style="color:#66d9ef">struct</span> State <span style="color:#f92672">*</span>state, <span style="color:#66d9ef">int</span> age)
{
   state<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>the_age <span style="color:#f92672">=</span> age; 
}

<span style="color:#66d9ef">double</span> <span style="color:#a6e22e">update_ratio</span>(<span style="color:#66d9ef">double</span> new_ratio)
{
    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">double</span> ratio <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>;

    <span style="color:#66d9ef">double</span> old_ratio <span style="color:#f92672">=</span> ratio;
    ratio <span style="color:#f92672">=</span> new_ratio;

    <span style="color:#66d9ef">return</span> old_ratio;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print_size</span>()
{
    log_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">I think size is: %d</span><span style="color:#e6db74">&#34;</span>, THE_SIZE);
}

</code></pre></div><p>.\ex22\ex22_main.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;ex22.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>MY_NAME <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Zed A. Shaw</span><span style="color:#e6db74">&#34;</span>;

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">scope_demo</span>(<span style="color:#66d9ef">int</span> count)
{
    log_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">count is: %d</span><span style="color:#e6db74">&#34;</span>, count);

    <span style="color:#66d9ef">if</span> (count <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10</span>) {
        <span style="color:#66d9ef">int</span> numbers <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>;    <span style="color:#75715e">// BAD! BUGS!
</span><span style="color:#75715e"></span>
        log_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">count in this scope is %d</span><span style="color:#e6db74">&#34;</span>, numbers);
    }

    log_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">count is at exit: %d</span><span style="color:#e6db74">&#34;</span>, count);

    count <span style="color:#f92672">=</span> <span style="color:#ae81ff">3000</span>;

    log_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">count after assign: %d</span><span style="color:#e6db74">&#34;</span>, count);
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#75715e">// test out THE_AGE accessors
</span><span style="color:#75715e"></span>    log_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">My name: %s, age: %d</span><span style="color:#e6db74">&#34;</span>, MY_NAME, get_age());

    set_age(<span style="color:#ae81ff">100</span>);

    log_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">My age is now: %d</span><span style="color:#e6db74">&#34;</span>, get_age());

    <span style="color:#75715e">// test out THE_SIZE extern
</span><span style="color:#75715e"></span>    log_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">THE_SIZE is: %d</span><span style="color:#e6db74">&#34;</span>, THE_SIZE);
    print_size();

    THE_SIZE <span style="color:#f92672">=</span> <span style="color:#ae81ff">9</span>;

    log_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">THE SIZE is now: %d</span><span style="color:#e6db74">&#34;</span>, THE_SIZE);
    print_size();

    <span style="color:#75715e">// test the ratio function static
</span><span style="color:#75715e"></span>    log_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Ratio at first: %f</span><span style="color:#e6db74">&#34;</span>, update_ratio(<span style="color:#ae81ff">2.0</span>));
    log_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Ratio again: %f</span><span style="color:#e6db74">&#34;</span>, update_ratio(<span style="color:#ae81ff">10.0</span>));
    log_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Ratio once more: %f</span><span style="color:#e6db74">&#34;</span>, update_ratio(<span style="color:#ae81ff">300.0</span>));

    <span style="color:#75715e">// test the scope demo
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>;
    scope_demo(count);
    scope_demo(count <span style="color:#f92672">*</span> <span style="color:#ae81ff">20</span>);

    log_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">count after calling scope_demo: %d</span><span style="color:#e6db74">&#34;</span>, count);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>This exercises requires two files:</p>
<pre><code>* ex22.c
* ex22_main.c
</code></pre>
<p>The Analysis</p>
<p>Fixing It</p>
<p>Instead of breaking this one I'm going to fix it.</p>
<ul>
<li>Do not shadow a variable like <em>count</em> on ex22_main.c:11.</li>
<li>Avoid using too many globals.</li>
<li>When in doubt, put it on the heap (malloc).</li>
<li>Don't use function static variables like I did in ex22.c:update_ratio.</li>
<li>Avoid reusing function parameters.</li>
</ul>
<p>Breaking It</p>
<ul>
<li>Try to directly access variables in <code>ex22.c</code> from <code>ex22_main.c</code>
that you think you can't.  For example, can you get at <code>ratio</code>
inside <code>update_ratio</code>? What if you had a pointer to it?</li>
<li>Ditch the <code>extern</code> declaration in <code>ex22.h</code> to see what
errors or warnings you get.</li>
<li>Add <code>static</code> or <code>const</code> specifiers to different variables,
and then try to change them.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Research the concept of pass by value verses pass by reference.  Write an
example of both.</li>
<li>Use pointers to gain access to things you shouldn't have access to.</li>
<li>Use your debugger to see what this kind of access looks like when you
do it wrong.</li>
<li>Write a recursive function that causes a stack overflow.  Don't know
what a recursive function is?  Try calling <code>scope_demo</code> at the
bottom of <code>scope_demo</code> itself so that it loops.</li>
<li>Rewrite the <code>Makefile</code> so that it can build this.</li>
</ul>
<h3 id="exercise-23-meet-duffs-device">Exercise 23 Meet Duff's Device</h3>
<p>The Plan</p>
<p>Learn the most evil awesome hack ever:</p>
<p>Duff's Device</p>
<p>The Code</p>
<p>.\ex23\ex23.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">normal_copy</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>from, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>to, <span style="color:#66d9ef">int</span> count)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> count; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        to[i] <span style="color:#f92672">=</span> from[i];
    }

    <span style="color:#66d9ef">return</span> i;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">duffs_device</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>from, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>to, <span style="color:#66d9ef">int</span> count)
{
    {
        <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> (count <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">8</span>;

        <span style="color:#66d9ef">switch</span> (count <span style="color:#f92672">%</span> <span style="color:#ae81ff">8</span>) {
            <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span>
                <span style="color:#66d9ef">do</span> {
                    <span style="color:#f92672">*</span>to<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>from<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
                    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">7</span><span style="color:#f92672">:</span>
                    <span style="color:#f92672">*</span>to<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>from<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
                    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">6</span><span style="color:#f92672">:</span>
                    <span style="color:#f92672">*</span>to<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>from<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
                    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">:</span>
                    <span style="color:#f92672">*</span>to<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>from<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
                    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">:</span>
                    <span style="color:#f92672">*</span>to<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>from<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
                    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">:</span>
                    <span style="color:#f92672">*</span>to<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>from<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
                    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span>
                    <span style="color:#f92672">*</span>to<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>from<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
                    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>
                    <span style="color:#f92672">*</span>to<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>from<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
                } <span style="color:#66d9ef">while</span> (<span style="color:#f92672">-</span><span style="color:#f92672">-</span>n <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>);
        }
    }

    <span style="color:#66d9ef">return</span> count;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">zeds_device</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>from, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>to, <span style="color:#66d9ef">int</span> count)
{
    {
        <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> (count <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">8</span>;
        debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">n starts: %d, count: %d, count%%8: %d</span><span style="color:#e6db74">&#34;</span>, 
                n, count, count <span style="color:#f92672">%</span> <span style="color:#ae81ff">8</span>);

        <span style="color:#66d9ef">switch</span> (count <span style="color:#f92672">%</span> <span style="color:#ae81ff">8</span>) {
            <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span>
again:    <span style="color:#f92672">*</span>to<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>from<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;

            <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">7</span><span style="color:#f92672">:</span>
          <span style="color:#f92672">*</span>to<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>from<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
            <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">6</span><span style="color:#f92672">:</span>
          <span style="color:#f92672">*</span>to<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>from<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
            <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">:</span>
          <span style="color:#f92672">*</span>to<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>from<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
            <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">:</span>
          <span style="color:#f92672">*</span>to<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>from<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
            <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">:</span>
          <span style="color:#f92672">*</span>to<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>from<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
            <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span>
          <span style="color:#f92672">*</span>to<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>from<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
            <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>
          <span style="color:#f92672">*</span>to<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>from<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
          debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">last case: n=%d</span><span style="color:#e6db74">&#34;</span>, n);
          <span style="color:#66d9ef">if</span> (<span style="color:#f92672">-</span><span style="color:#f92672">-</span>n <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
              debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">going again: n=%d</span><span style="color:#e6db74">&#34;</span>, n);
              <span style="color:#66d9ef">goto</span> again;
          }
        }
    }

    <span style="color:#66d9ef">return</span> count;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">valid_copy</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>data, <span style="color:#66d9ef">int</span> count, <span style="color:#66d9ef">char</span> expects)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> count; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        <span style="color:#66d9ef">if</span> (data[i] <span style="color:#f92672">!</span><span style="color:#f92672">=</span> expects) {
            log_err(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">[%d] %c != %c</span><span style="color:#e6db74">&#34;</span>, i, data[i], expects);
            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
        }
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">char</span> from[<span style="color:#ae81ff">1003</span>] <span style="color:#f92672">=</span> { <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">a</span><span style="color:#e6db74">&#39;</span> };
    <span style="color:#66d9ef">char</span> to[<span style="color:#ae81ff">1003</span>] <span style="color:#f92672">=</span> { <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">c</span><span style="color:#e6db74">&#39;</span> };
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#75715e">// setup the from to have some stuff
</span><span style="color:#75715e"></span>    memset(from, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">x</span><span style="color:#e6db74">&#39;</span>, <span style="color:#ae81ff">1003</span>);
    <span style="color:#75715e">// set it to a failure mode
</span><span style="color:#75715e"></span>    memset(to, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">y</span><span style="color:#e6db74">&#39;</span>, <span style="color:#ae81ff">1003</span>);
    check(valid_copy(to, <span style="color:#ae81ff">1003</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">y</span><span style="color:#e6db74">&#39;</span>), <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Not initialized right.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#75715e">// use normal copy to 
</span><span style="color:#75715e"></span>    rc <span style="color:#f92672">=</span> normal_copy(from, to, <span style="color:#ae81ff">1003</span>);
    check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1003</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Normal copy failed: %d</span><span style="color:#e6db74">&#34;</span>, rc);
    check(valid_copy(to, <span style="color:#ae81ff">1003</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">x</span><span style="color:#e6db74">&#39;</span>), <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Normal copy failed.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#75715e">// reset
</span><span style="color:#75715e"></span>    memset(to, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">y</span><span style="color:#e6db74">&#39;</span>, <span style="color:#ae81ff">1003</span>);

    <span style="color:#75715e">// duffs version
</span><span style="color:#75715e"></span>    rc <span style="color:#f92672">=</span> duffs_device(from, to, <span style="color:#ae81ff">1003</span>);
    check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1003</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Duff&#39;s device failed: %d</span><span style="color:#e6db74">&#34;</span>, rc);
    check(valid_copy(to, <span style="color:#ae81ff">1003</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">x</span><span style="color:#e6db74">&#39;</span>), <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Duff&#39;s device failed copy.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#75715e">// reset
</span><span style="color:#75715e"></span>    memset(to, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">y</span><span style="color:#e6db74">&#39;</span>, <span style="color:#ae81ff">1003</span>);

    <span style="color:#75715e">// my version
</span><span style="color:#75715e"></span>    rc <span style="color:#f92672">=</span> zeds_device(from, to, <span style="color:#ae81ff">1003</span>);
    check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1003</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Zed&#39;s device failed: %d</span><span style="color:#e6db74">&#34;</span>, rc);
    check(valid_copy(to, <span style="color:#ae81ff">1003</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">x</span><span style="color:#e6db74">&#39;</span>), <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Zed&#39;s device failed copy.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
error:
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}

</code></pre></div><p>Remember that this is <em>bad</em> code.
It's very interesting though, so struggle with it.</p>
<p>The Analysis</p>
<p>Before you continue, try to figure out what this does.
Consider it a debugging problem.</p>
<p>Clues</p>
<ul>
<li>Print this code out so that you can write on some paper.</li>
<li>Write each of the variables in a table as they
look when they get initialized right before the <code>switch-statement</code>.</li>
<li>Follow the logic to the switch, then do the jump to the right case.</li>
<li>Update the variables, including the <code>to</code>, <code>from</code>, and the
arrays they point at.</li>
</ul>
<p>Clues</p>
<ul>
<li>When you get to the <code>while</code> part or my <code>goto</code> alternative,
check your variables, and then follow the logic either back to the
top of the <code>do-while</code> or to where the <code>again</code> label is
located.</li>
<li>Follow through this manual tracing, updating the variables, until
you're sure you see how this flows.</li>
</ul>
<p>Pause!</p>
<p>I will then show you the solution so pause if you do
<em>NOT</em> want to see it yet.</p>
<p>Solving It</p>
<p>Watch me walk through how this works to see if it matches what you did.</p>
<p>Extra Credit</p>
<ul>
<li>Never use this again.</li>
<li>Go look at the Wikipedia entry for Duff's device and see if you can
spot the error.  Read the article, compare it to the version I have here, and try to understand why the Wikipedia code won't work for you
but worked for Tom Duff.</li>
<li>Create a set of macros that lets you create any length of device like this.
For example, what if you wanted to have 32 case statements and didn't want
to write out all of them? Can you do a macro that lays down eight at a time?</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Change the <code>main</code> to conduct some speed tests to see which one is
really the fastest.</li>
<li>Read about <code>memcpy</code>, <code>memmove</code>, and <code>memset</code>, and also compare
their speed.</li>
<li>Never use this again!</li>
</ul>
<h3 id="exercise-24-input-output-files">Exercise 24 Input, Output, Files</h3>
<p>The Plan</p>
<ul>
<li>Learn the basics of working with files in C.</li>
<li>Get an initial list of the &ldquo;f-functions&rdquo;.</li>
</ul>
<p>The Code</p>
<p>.\ex24\ex24.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define MAX_DATA 100</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">enum</span> EyeColor {
    BLUE_EYES, GREEN_EYES, BROWN_EYES,
    BLACK_EYES, OTHER_EYES
} EyeColor;

<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>EYE_COLOR_NAMES[] <span style="color:#f92672">=</span> {
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Blue</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Green</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Brown</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Black</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Other</span><span style="color:#e6db74">&#34;</span>
};

<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> Person {
    <span style="color:#66d9ef">int</span> age;
    <span style="color:#66d9ef">char</span> first_name[MAX_DATA];
    <span style="color:#66d9ef">char</span> last_name[MAX_DATA];
    EyeColor eyes;
    <span style="color:#66d9ef">float</span> income;
} Person;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    Person you <span style="color:#f92672">=</span> {.age <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> };
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>in <span style="color:#f92672">=</span> NULL;

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">What&#39;s your First Name? </span><span style="color:#e6db74">&#34;</span>);
    in <span style="color:#f92672">=</span> fgets(you.first_name, MAX_DATA <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, stdin);
    check(in <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to read first name.</span><span style="color:#e6db74">&#34;</span>);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">What&#39;s your Last Name? </span><span style="color:#e6db74">&#34;</span>);
    in <span style="color:#f92672">=</span> fgets(you.last_name, MAX_DATA <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, stdin);
    check(in <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to read last name.</span><span style="color:#e6db74">&#34;</span>);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">How old are you? </span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> fscanf(stdin, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">&amp;</span>you.age);
    check(rc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">You have to enter a number.</span><span style="color:#e6db74">&#34;</span>);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">What color are your eyes:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span><span style="color:#f92672">=</span> OTHER_EYES; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d) %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, EYE_COLOR_NAMES[i]);
    }
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&gt; </span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">int</span> eyes <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
    rc <span style="color:#f92672">=</span> fscanf(stdin, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">&amp;</span>eyes);
    check(rc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">You have to enter a number.</span><span style="color:#e6db74">&#34;</span>);

    you.eyes <span style="color:#f92672">=</span> eyes <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
    check(you.eyes <span style="color:#f92672">&lt;</span><span style="color:#f92672">=</span> OTHER_EYES
            <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> you.eyes <span style="color:#f92672">&gt;</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Do it right, that&#39;s not an option.</span><span style="color:#e6db74">&#34;</span>);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">How much do you make an hour? </span><span style="color:#e6db74">&#34;</span>);
    rc <span style="color:#f92672">=</span> fscanf(stdin, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%f</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">&amp;</span>you.income);
    check(rc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Enter a floating point number.</span><span style="color:#e6db74">&#34;</span>);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">----- RESULTS -----</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">First Name: %s</span><span style="color:#e6db74">&#34;</span>, you.first_name);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Last Name: %s</span><span style="color:#e6db74">&#34;</span>, you.last_name);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Age: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, you.age);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Eyes: %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, EYE_COLOR_NAMES[you.eyes]);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Income: %f</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, you.income);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
error:

    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

</code></pre></div><p>The Analysis</p>
<p>Breaking It</p>
<ul>
<li>Trying out <em>fgets</em> and the problems with <em>gets</em>.</li>
<li>Feed it <em>/dev/urandom</em> to give it garbage.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Rewrite this to not use <code>fscanf</code> at all.  You'll need to use
functions like <code>atoi</code> to convert the input strings to numbers.</li>
<li>Change this to use plain <code>scanf</code> instead of <code>fscanf</code> to
see what the difference is.</li>
<li>Fix it so that their input names get stripped of the trailing newline
characters and any whites pace.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Use <code>scanf</code> to write a function that reads one character at a time
and files in the names but doesn't go past the end.  Make this function
generic so it can take a size for the string, but just make sure you end
the string with <code>'\0'</code> no matter what.</li>
</ul>
<h3 id="exercise-25-variable-argument-functions">Exercise 25 Variable Argument Functions</h3>
<p>The Plan</p>
<ul>
<li>Use variable argument functions.</li>
<li>Write our own simple version of <em>scanf</em>.</li>
</ul>
<p>The Code</p>
<p>.\ex25\ex25.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">
<span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdarg.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define MAX_DATA 100</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">read_string</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#f92672">*</span>out_string, <span style="color:#66d9ef">int</span> max_buffer)
{
    <span style="color:#f92672">*</span>out_string <span style="color:#f92672">=</span> calloc(<span style="color:#ae81ff">1</span>, max_buffer <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
    check_mem(<span style="color:#f92672">*</span>out_string);

    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>result <span style="color:#f92672">=</span> fgets(<span style="color:#f92672">*</span>out_string, max_buffer, stdin);
    check(result <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Input error.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">*</span>out_string) free(<span style="color:#f92672">*</span>out_string);
    <span style="color:#f92672">*</span>out_string <span style="color:#f92672">=</span> NULL;
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">read_int</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>out_int)
{
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>input <span style="color:#f92672">=</span> NULL;
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> read_string(<span style="color:#f92672">&amp;</span>input, MAX_DATA);
    check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to read number.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#f92672">*</span>out_int <span style="color:#f92672">=</span> atoi(input);

    free(input);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">if</span> (input) free(input);
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">read_scan</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>fmt, ...)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>out_int <span style="color:#f92672">=</span> NULL;
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>out_char <span style="color:#f92672">=</span> NULL;
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#f92672">*</span>out_string <span style="color:#f92672">=</span> NULL;
    <span style="color:#66d9ef">int</span> max_buffer <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    va_list argp;
    va_start(argp, fmt);

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; fmt[i] <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        <span style="color:#66d9ef">if</span> (fmt[i] <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%</span><span style="color:#e6db74">&#39;</span>) {
            i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
            <span style="color:#66d9ef">switch</span> (fmt[i]) {
                <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
                    sentinel(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Invalid format, you ended with %%.</span><span style="color:#e6db74">&#34;</span>);
                    <span style="color:#66d9ef">break</span>;

                <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">d</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
                    out_int <span style="color:#f92672">=</span> va_arg(argp, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>);
                    rc <span style="color:#f92672">=</span> read_int(out_int);
                    check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to read int.</span><span style="color:#e6db74">&#34;</span>);
                    <span style="color:#66d9ef">break</span>;

                <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">c</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
                    out_char <span style="color:#f92672">=</span> va_arg(argp, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>);
                    <span style="color:#f92672">*</span>out_char <span style="color:#f92672">=</span> fgetc(stdin);
                    <span style="color:#66d9ef">break</span>;

                <span style="color:#66d9ef">case</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">s</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">:</span>
                    max_buffer <span style="color:#f92672">=</span> va_arg(argp, <span style="color:#66d9ef">int</span>);
                    out_string <span style="color:#f92672">=</span> va_arg(argp, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#f92672">*</span>);
                    rc <span style="color:#f92672">=</span> read_string(out_string, max_buffer);
                    check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to read string.</span><span style="color:#e6db74">&#34;</span>);
                    <span style="color:#66d9ef">break</span>;

                <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
                    sentinel(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Invalid format.</span><span style="color:#e6db74">&#34;</span>);
            }
        } <span style="color:#66d9ef">else</span> {
            fgetc(stdin);
        }

        check(<span style="color:#f92672">!</span>feof(stdin) <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> <span style="color:#f92672">!</span>ferror(stdin), <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Input error.</span><span style="color:#e6db74">&#34;</span>);
    }

    va_end(argp);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    va_end(argp);
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>first_name <span style="color:#f92672">=</span> NULL;
    <span style="color:#66d9ef">char</span> initial <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> </span><span style="color:#e6db74">&#39;</span>;
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>last_name <span style="color:#f92672">=</span> NULL;
    <span style="color:#66d9ef">int</span> age <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">What&#39;s your first name? </span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> read_scan(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>, MAX_DATA, <span style="color:#f92672">&amp;</span>first_name);
    check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed first name.</span><span style="color:#e6db74">&#34;</span>);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">What&#39;s your initial? </span><span style="color:#e6db74">&#34;</span>);
    rc <span style="color:#f92672">=</span> read_scan(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%c</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">&amp;</span>initial);
    check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed initial.</span><span style="color:#e6db74">&#34;</span>);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">What&#39;s your last name? </span><span style="color:#e6db74">&#34;</span>);
    rc <span style="color:#f92672">=</span> read_scan(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>, MAX_DATA, <span style="color:#f92672">&amp;</span>last_name);
    check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed last name.</span><span style="color:#e6db74">&#34;</span>);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">How old are you? </span><span style="color:#e6db74">&#34;</span>);
    rc <span style="color:#f92672">=</span> read_scan(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">&amp;</span>age);

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">---- RESULTS ----</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">First Name: %s</span><span style="color:#e6db74">&#34;</span>, first_name);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Initial: &#39;%c&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, initial);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Last Name: %s</span><span style="color:#e6db74">&#34;</span>, last_name);
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Age: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, age);

    free(first_name);
    free(last_name);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
error:
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

</code></pre></div><p>The Analysis</p>
<p>Breaking It</p>
<ul>
<li>Change the code so that you forget to pass in the initial size for &lsquo;%s&rsquo; formats.</li>
<li>Give it more data than <code>MAX_DATA</code>, and then see how omitting <code>calloc</code> in <code>read_string</code> changes how it works.</li>
<li>There's a problem where fgets eats the newlines, so try to fix that using
<code>fgetc</code> but leave out the <code>\0</code> that ends the string.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Make double and triple sure that you know what each of the <code>out_</code>
variables are doing.  Most importantly, you should know what is <code>out_string</code> is and how it's
a pointer to a pointer, , so that you understand when you're setting the pointer versus the
contents is important.  Break down each of the</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Write a similar function to <code>printf</code> that uses the varargs system,
and rewrite <code>main</code> to use it.</li>
<li>As usual, read the man page on all of this so that you know what it does
on your platform.  Some platforms will use macros, others will use
functions, and some will have these do nothing.  It all depends on the
compiler and the platform you use.</li>
</ul>
<h3 id="exercise-26-project-logfind">Exercise 26 Project logfind</h3>
<p>The Plan</p>
<p>Attempt your first project!</p>
<p>logfind</p>
<p>How Projects Work</p>
<p>The projects in this book are designed to make you apply
what you know so far to something &ldquo;real world&rdquo;.</p>
<ol>
<li>I will tell you when to <em>pause</em> so you can try to solve it yourself.</li>
<li>You will be given the challenge.  Pause!</li>
<li>You will be given clues. Pause!</li>
<li>Finally the solution.</li>
<li>Then I try to break my own solution.</li>
</ol>
<p>The Code</p>
<p>logfind.1</p>
<p>.\ex26\logfind.1\logfind.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    check(argc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">USAGE: logfind word word word</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}

</code></pre></div><p>.\ex26\logfind.1\Makefile</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile">CFLAGS<span style="color:#f92672">=</span>-Wall -g

<span style="color:#a6e22e">all</span><span style="color:#f92672">:</span> logfind
    ./logfind <span style="color:#f92672">||</span> true
    ./logfind test test test

</code></pre></div><p>logfind.2</p>
<p>.\ex26\logfind.2\logfind.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">const</span> size_t MAX_LINE <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span>;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">scan_file</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>filename, <span style="color:#66d9ef">int</span> search_len, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>search_for[])
{
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>line <span style="color:#f92672">=</span> calloc(MAX_LINE, <span style="color:#ae81ff">1</span>);
    FILE <span style="color:#f92672">*</span>file <span style="color:#f92672">=</span> fopen(filename, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>found <span style="color:#f92672">=</span> NULL;
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    check_mem(line);
    check(file, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to open file: %s</span><span style="color:#e6db74">&#34;</span>, filename);

    <span style="color:#75715e">// read each line of the file and search that line for the contents
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span>(fgets(line, MAX_LINE<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, file) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> found <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL) {
        <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> search_len <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> found <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
            found <span style="color:#f92672">=</span> strcasestr(line, search_for[i]);
            <span style="color:#66d9ef">if</span>(found) {
                printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, filename);
            }
        }
    }

    free(line);
    fclose(file);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">if</span>(line) free(line);
    <span style="color:#66d9ef">if</span>(file) fclose(file);

    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    check(argc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">USAGE: logfind word word word</span><span style="color:#e6db74">&#34;</span>);

    scan_file(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">logfind.c</span><span style="color:#e6db74">&#34;</span>, argc, argv);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}

</code></pre></div><p>.\ex26\logfind.2\Makefile</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile">CFLAGS<span style="color:#f92672">=</span>-Wall -g

<span style="color:#a6e22e">all</span><span style="color:#f92672">:</span> logfind
    ./logfind <span style="color:#f92672">||</span> true
    ./logfind error

<span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
    rm -f logfind

</code></pre></div><p>logfind.3</p>
<p>.\ex26\logfind.3\logfind.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;glob.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">const</span> size_t MAX_LINE <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span>;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">list_files</span>(glob_t <span style="color:#f92672">*</span>pglob) 
{
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>line <span style="color:#f92672">=</span> calloc(MAX_LINE, <span style="color:#ae81ff">1</span>);
    FILE <span style="color:#f92672">*</span>file <span style="color:#f92672">=</span> fopen(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">.logfind</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">int</span> glob_flags <span style="color:#f92672">=</span> GLOB_TILDE;
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;

    check(pglob <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Invalid glob_t given.</span><span style="color:#e6db74">&#34;</span>);
    check_mem(line);
    check(file, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to open .logfind. Make that first.</span><span style="color:#e6db74">&#34;</span>);

    rc <span style="color:#f92672">=</span> glob(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">*.h</span><span style="color:#e6db74">&#34;</span>, glob_flags, NULL, pglob);
    check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to glob.</span><span style="color:#e6db74">&#34;</span>);
    rc <span style="color:#f92672">=</span> glob(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">*.c</span><span style="color:#e6db74">&#34;</span>, glob_flags <span style="color:#f92672">|</span> GLOB_APPEND, NULL, pglob);
    check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to glob.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> pglob<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>gl_pathc; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Matched file: %s</span><span style="color:#e6db74">&#34;</span>, pglob<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>gl_pathv[i]);
    }

    rc <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">// all good
</span><span style="color:#75715e"></span>
error: <span style="color:#75715e">// fallthrough
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span>(line) free(line);
    <span style="color:#66d9ef">return</span> rc;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">scan_file</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>filename, <span style="color:#66d9ef">int</span> search_len, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>search_for[])
{
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>line <span style="color:#f92672">=</span> calloc(MAX_LINE, <span style="color:#ae81ff">1</span>);
    FILE <span style="color:#f92672">*</span>file <span style="color:#f92672">=</span> fopen(filename, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>found <span style="color:#f92672">=</span> NULL;
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    check_mem(line);
    check(file, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to open file: %s</span><span style="color:#e6db74">&#34;</span>, filename);

    <span style="color:#75715e">// read each line of the file and search that line for the contents
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span>(fgets(line, MAX_LINE<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, file) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> found <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL) {
        <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> search_len <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> found <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
            found <span style="color:#f92672">=</span> strcasestr(line, search_for[i]);
            <span style="color:#66d9ef">if</span>(found) {
                printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, filename);
            }
        }
    }

    free(line);
    fclose(file);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">if</span>(line) free(line);
    <span style="color:#66d9ef">if</span>(file) fclose(file);

    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    glob_t files_found;
    check(argc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">USAGE: logfind word word word</span><span style="color:#e6db74">&#34;</span>);

    check(list_files(<span style="color:#f92672">&amp;</span>files_found) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to list files.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> files_found.gl_pathc; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        scan_file(files_found.gl_pathv[i], argc, argv);
    }

    globfree(<span style="color:#f92672">&amp;</span>files_found);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}

</code></pre></div><p>.\ex26\logfind.3\Makefile</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile">CFLAGS<span style="color:#f92672">=</span>-Wall -g

<span style="color:#a6e22e">all</span><span style="color:#f92672">:</span> logfind
    ./logfind <span style="color:#f92672">||</span> true
    ./logfind error

<span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
    rm -f logfind

</code></pre></div><p>logfind.4</p>
<p>.\ex26\logfind.4\logfind.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">define NDEBUG</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;glob.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">const</span> size_t MAX_LINE <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span>;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">list_files</span>(glob_t <span style="color:#f92672">*</span>pglob) 
{
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>line <span style="color:#f92672">=</span> calloc(MAX_LINE, <span style="color:#ae81ff">1</span>);
    FILE <span style="color:#f92672">*</span>file <span style="color:#f92672">=</span> fopen(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">.logfind</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">int</span> glob_flags <span style="color:#f92672">=</span> GLOB_TILDE;
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;

    check(pglob <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Invalid glob_t given.</span><span style="color:#e6db74">&#34;</span>);
    check_mem(line);
    check(file, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to open .logfind. Make that first.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">while</span>(fgets(line, MAX_LINE<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, file) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL) {
        line[strlen(line) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>; <span style="color:#75715e">// drop the \n ending
</span><span style="color:#75715e"></span>        debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Globbing %s</span><span style="color:#e6db74">&#34;</span>, line);

        rc <span style="color:#f92672">=</span> glob(line, glob_flags, NULL, pglob);
        check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span><span style="color:#f92672">|</span> rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> GLOB_NOMATCH, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to glob.</span><span style="color:#e6db74">&#34;</span>);

        <span style="color:#75715e">// dumb work around to a stupid design in glob
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span>(glob_flags <span style="color:#f92672">=</span><span style="color:#f92672">=</span> GLOB_TILDE) glob_flags <span style="color:#f92672">|</span><span style="color:#f92672">=</span> GLOB_APPEND;
    }

    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> pglob<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>gl_pathc; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Matched file: %s</span><span style="color:#e6db74">&#34;</span>, pglob<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>gl_pathv[i]);
    }

    rc <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">// all good
</span><span style="color:#75715e"></span>
error: <span style="color:#75715e">// fallthrough
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span>(line) free(line);
    <span style="color:#66d9ef">return</span> rc;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">scan_file</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>filename, <span style="color:#66d9ef">int</span> search_len, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>search_for[])
{
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>line <span style="color:#f92672">=</span> calloc(MAX_LINE, <span style="color:#ae81ff">1</span>);
    FILE <span style="color:#f92672">*</span>file <span style="color:#f92672">=</span> fopen(filename, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>found <span style="color:#f92672">=</span> NULL;
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    check_mem(line);
    check(file, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to open file: %s</span><span style="color:#e6db74">&#34;</span>, filename);

    <span style="color:#75715e">// read each line of the file and search that line for the contents
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span>(fgets(line, MAX_LINE<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, file) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> found <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL) {
        <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> search_len <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> found <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
            found <span style="color:#f92672">=</span> strcasestr(line, search_for[i]);
            <span style="color:#66d9ef">if</span>(found) {
                printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, filename);
            }
        }
    }

    free(line);
    fclose(file);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">if</span>(line) free(line);
    <span style="color:#66d9ef">if</span>(file) fclose(file);

    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    glob_t files_found;
    check(argc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">USAGE: logfind word word word</span><span style="color:#e6db74">&#34;</span>);

    check(list_files(<span style="color:#f92672">&amp;</span>files_found) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to list files.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> files_found.gl_pathc; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        scan_file(files_found.gl_pathv[i], argc, argv);
    }

    globfree(<span style="color:#f92672">&amp;</span>files_found);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}

</code></pre></div><p>.\ex26\logfind.4\Makefile</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile">CFLAGS<span style="color:#f92672">=</span>-Wall -g

<span style="color:#a6e22e">all</span><span style="color:#f92672">:</span> logfind
    ./logfind <span style="color:#f92672">||</span> true
    ./logfind MAX_LINE

<span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
    rm -f logfind

</code></pre></div><p>logfind.5</p>
<p>.\ex26\logfind.5\logfind.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">define NDEBUG</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;glob.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">const</span> size_t MAX_LINE <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span>;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">list_files</span>(glob_t <span style="color:#f92672">*</span>pglob) 
{
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>line <span style="color:#f92672">=</span> calloc(MAX_LINE, <span style="color:#ae81ff">1</span>);
    FILE <span style="color:#f92672">*</span>file <span style="color:#f92672">=</span> fopen(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">.logfind</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">int</span> glob_flags <span style="color:#f92672">=</span> GLOB_TILDE;
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;

    check(pglob <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Invalid glob_t given.</span><span style="color:#e6db74">&#34;</span>);
    check_mem(line);
    check(file, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to open .logfind. Make that first.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">while</span>(fgets(line, MAX_LINE<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, file) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL) {
        line[strlen(line) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>; <span style="color:#75715e">// drop the \n ending
</span><span style="color:#75715e"></span>        debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Globbing %s</span><span style="color:#e6db74">&#34;</span>, line);

        rc <span style="color:#f92672">=</span> glob(line, glob_flags, NULL, pglob);
        check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span><span style="color:#f92672">|</span> rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> GLOB_NOMATCH, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to glob.</span><span style="color:#e6db74">&#34;</span>);

        <span style="color:#75715e">// dumb work around to a stupid design in glob
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span>(glob_flags <span style="color:#f92672">=</span><span style="color:#f92672">=</span> GLOB_TILDE) glob_flags <span style="color:#f92672">|</span><span style="color:#f92672">=</span> GLOB_APPEND;
    }

    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> pglob<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>gl_pathc; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Matched file: %s</span><span style="color:#e6db74">&#34;</span>, pglob<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>gl_pathv[i]);
    }

    rc <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">// all good
</span><span style="color:#75715e"></span>
error: <span style="color:#75715e">// fallthrough
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span>(line) free(line);
    <span style="color:#66d9ef">return</span> rc;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">found_it</span>(<span style="color:#66d9ef">int</span> use_or, <span style="color:#66d9ef">int</span> found_count, <span style="color:#66d9ef">int</span> search_len)
{
    debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">use_or: %d, found_count: %d, search_len: %d</span><span style="color:#e6db74">&#34;</span>, use_or, found_count, search_len);

    <span style="color:#66d9ef">if</span>(use_or <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> found_count <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>use_or <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> found_count <span style="color:#f92672">=</span><span style="color:#f92672">=</span> search_len) {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
    }
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">scan_file</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>filename, <span style="color:#66d9ef">int</span> use_or, <span style="color:#66d9ef">int</span> search_len, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>search_for[])
{
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>line <span style="color:#f92672">=</span> calloc(MAX_LINE, <span style="color:#ae81ff">1</span>);
    FILE <span style="color:#f92672">*</span>file <span style="color:#f92672">=</span> fopen(filename, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">int</span> found_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    check_mem(line);
    check(file, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to open file: %s</span><span style="color:#e6db74">&#34;</span>, filename);

    <span style="color:#75715e">// read each line of the file and search that line for the contents
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span>(fgets(line, MAX_LINE<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, file) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL)
    {
        <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> search_len; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
            <span style="color:#66d9ef">if</span>(strcasestr(line, search_for[i]) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL) {
                debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">file: %s, line: %s, search: %s</span><span style="color:#e6db74">&#34;</span>, filename, line, search_for[i]);
                found_count<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
            }
        }

        <span style="color:#66d9ef">if</span>(found_it(use_or, found_count, search_len)) {
            printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, filename);
            <span style="color:#66d9ef">break</span>;
        } <span style="color:#66d9ef">else</span> {
            found_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        }
    }

    free(line);
    fclose(file);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">if</span>(line) free(line);
    <span style="color:#66d9ef">if</span>(file) fclose(file);

    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">parse_args</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>use_or, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#f92672">*</span>argv[]) 
{
    (<span style="color:#f92672">*</span>argc)<span style="color:#f92672">-</span><span style="color:#f92672">-</span>;
    (<span style="color:#f92672">*</span>argv)<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;

    <span style="color:#66d9ef">if</span>(strcmp((<span style="color:#f92672">*</span>argv)[<span style="color:#ae81ff">0</span>], <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">-o</span><span style="color:#e6db74">&#34;</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#f92672">*</span>use_or <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        (<span style="color:#f92672">*</span>argc)<span style="color:#f92672">-</span><span style="color:#f92672">-</span>; <span style="color:#75715e">// skip the -o
</span><span style="color:#75715e"></span>        (<span style="color:#f92672">*</span>argv)<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
        check(<span style="color:#f92672">*</span>argc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">You need words after -o.</span><span style="color:#e6db74">&#34;</span>);
    } <span style="color:#66d9ef">else</span> {
        use_or <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
error:
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> use_or <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    glob_t files_found;

    check(argc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">USAGE: logfind [-o] words</span><span style="color:#e6db74">&#34;</span>);

    check(parse_args(<span style="color:#f92672">&amp;</span>use_or, <span style="color:#f92672">&amp;</span>argc, <span style="color:#f92672">&amp;</span>argv) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">USAGE: logfind [-o] words</span><span style="color:#e6db74">&#34;</span>);

    check(list_files(<span style="color:#f92672">&amp;</span>files_found) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to list files.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> files_found.gl_pathc; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        scan_file(files_found.gl_pathv[i], use_or, argc, argv);
    }

    globfree(<span style="color:#f92672">&amp;</span>files_found);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}

</code></pre></div><p>.\ex26\logfind.5\Makefile</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile">CFLAGS<span style="color:#f92672">=</span>-Wall -g

<span style="color:#a6e22e">all</span><span style="color:#f92672">:</span> logfind
    ./logfind <span style="color:#f92672">||</span> true
    ./logfind MAX_LINE
    ./logfind error MAX LINE
    ./logfind -o error MAX LINE

<span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
    rm -f logfind

</code></pre></div><p>If you ever get super stuck, you can visit:</p>
<p>To get all of the code for this book.</p>
<p>The Challenge</p>
<p>I want a tool called <code>logfind</code> that let's me search through log files for
text.  This tool is a specialized version of another tool called <code>grep</code>, but
designed only for log files on a system.</p>
<p>The Challenge</p>
<ul>
<li>This tool takes any sequence of words and assumes I mean &ldquo;and&rdquo; for them.  So <code>logfind zedshaw smart guy</code> will find all files that have <code>zedshaw</code> <em>and</em> <code>smart</code> <em>and</em> <code>guy</code> in them.</li>
<li>It takes an optional argument of <code>-o</code> if the parameters are meant to be <em>or</em> logic.</li>
<li>It loads the list of allowed log files from <code>~/.logfind</code>.</li>
</ul>
<p>The Challenge</p>
<ul>
<li>The list of file names can be anything that the <code>glob</code> function allows.  Refer to <code>man 3 glob</code> to see how this works.  I suggest starting with just a flat list of exact files, and then add <code>glob</code> functionality.</li>
<li>You should output the matching lines as you scan, and try to match them as fast as possible.</li>
</ul>
<p>Demo</p>
<p>Here is a demo of me using the one I wrote.</p>
<p>Pause!</p>
<p>Now it's time for you to attempt to solve it from just this idea.</p>
<p>The Clues</p>
<ul>
<li>Remember to solve it a piece at a time.</li>
<li>Start with just getting the arguments.</li>
<li>Then figure out how to open files and just open the ones in this directory.</li>
<li>Then figure out how to read the files.</li>
<li>Then find out how to find the arguments in the files.</li>
<li>Then figure out how glob works.</li>
<li>Then use glob to find the files and open them.</li>
</ul>
<p>It helps to do each of these in <em>main()</em> then &ldquo;carve&rdquo; them out into their
own functions.</p>
<p>Pause!</p>
<p>The Solution</p>
<p>Breaking It</p>
<h3 id="exercise-27-creative-and-defensive-programming">Exercise 27 Creative and Defensive Programming</h3>
<p>logfind.5</p>
<p>.\ex27\logfind.5\logfind.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">define NDEBUG</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;glob.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;assert.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">const</span> size_t MAX_LINE <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span>;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">list_files</span>(glob_t <span style="color:#f92672">*</span>pglob) 
{
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>line <span style="color:#f92672">=</span> calloc(MAX_LINE, <span style="color:#ae81ff">1</span>);
    FILE <span style="color:#f92672">*</span>file <span style="color:#f92672">=</span> fopen(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">.logfind</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">int</span> glob_flags <span style="color:#f92672">=</span> GLOB_TILDE;
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;

    check(pglob <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Invalid glob_t given.</span><span style="color:#e6db74">&#34;</span>);
    check_mem(line);
    check(file, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to open .logfind. Make that first.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">while</span>(fgets(line, MAX_LINE<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, file) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL) {
        size_t line_length <span style="color:#f92672">=</span> strnlen(line, MAX_LINE <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
        assert(line_length <span style="color:#f92672">&lt;</span> MAX_LINE <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Got a line length too long.</span><span style="color:#e6db74">&#34;</span>);

        line[line_length] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>; <span style="color:#75715e">// drop the \n ending
</span><span style="color:#75715e"></span>        debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Globbing %s</span><span style="color:#e6db74">&#34;</span>, line);

        rc <span style="color:#f92672">=</span> glob(line, glob_flags, NULL, pglob);
        check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span><span style="color:#f92672">|</span> rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> GLOB_NOMATCH, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to glob.</span><span style="color:#e6db74">&#34;</span>);

        <span style="color:#75715e">// dumb work around to a stupid design in glob
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span>(glob_flags <span style="color:#f92672">=</span><span style="color:#f92672">=</span> GLOB_TILDE) glob_flags <span style="color:#f92672">|</span><span style="color:#f92672">=</span> GLOB_APPEND;
    }

    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> pglob<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>gl_pathc; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Matched file: %s</span><span style="color:#e6db74">&#34;</span>, pglob<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>gl_pathv[i]);
    }

    rc <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">// all good
</span><span style="color:#75715e"></span>
error: <span style="color:#75715e">// fallthrough
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span>(line) free(line);
    <span style="color:#66d9ef">return</span> rc;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">found_it</span>(<span style="color:#66d9ef">int</span> use_or, <span style="color:#66d9ef">int</span> found_count, <span style="color:#66d9ef">int</span> search_len)
{
    debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">use_or: %d, found_count: %d, search_len: %d</span><span style="color:#e6db74">&#34;</span>, use_or, found_count, search_len);

    <span style="color:#66d9ef">if</span>(use_or <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> found_count <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>use_or <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> found_count <span style="color:#f92672">=</span><span style="color:#f92672">=</span> search_len) {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
    }
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">scan_file</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>filename, <span style="color:#66d9ef">int</span> use_or, <span style="color:#66d9ef">int</span> search_len, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>search_for[])
{
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>line <span style="color:#f92672">=</span> calloc(MAX_LINE, <span style="color:#ae81ff">1</span>);
    FILE <span style="color:#f92672">*</span>file <span style="color:#f92672">=</span> fopen(filename, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">int</span> found_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    check_mem(line);
    check(file, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to open file: %s</span><span style="color:#e6db74">&#34;</span>, filename);

    <span style="color:#75715e">// read each line of the file and search that line for the contents
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span>(fgets(line, MAX_LINE<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, file) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL)
    {
        <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> search_len; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
            <span style="color:#66d9ef">if</span>(strcasestr(line, search_for[i]) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL) {
                debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">file: %s, line: %s, search: %s</span><span style="color:#e6db74">&#34;</span>, filename, line, search_for[i]);
                found_count<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
            }
        }

        <span style="color:#66d9ef">if</span>(found_it(use_or, found_count, search_len)) {
            printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, filename);
            <span style="color:#66d9ef">break</span>;
        } <span style="color:#66d9ef">else</span> {
            found_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        }
    }

    free(line);
    fclose(file);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">if</span>(line) free(line);
    <span style="color:#66d9ef">if</span>(file) fclose(file);

    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">parse_args</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>use_or, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#f92672">*</span>argv[]) 
{
    (<span style="color:#f92672">*</span>argc)<span style="color:#f92672">-</span><span style="color:#f92672">-</span>;
    (<span style="color:#f92672">*</span>argv)<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;

    <span style="color:#66d9ef">if</span>(strcmp((<span style="color:#f92672">*</span>argv)[<span style="color:#ae81ff">0</span>], <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">-o</span><span style="color:#e6db74">&#34;</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#f92672">*</span>use_or <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        (<span style="color:#f92672">*</span>argc)<span style="color:#f92672">-</span><span style="color:#f92672">-</span>; <span style="color:#75715e">// skip the -o
</span><span style="color:#75715e"></span>        (<span style="color:#f92672">*</span>argv)<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
        check(<span style="color:#f92672">*</span>argc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">You need words after -o.</span><span style="color:#e6db74">&#34;</span>);
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#f92672">*</span>use_or <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
error:
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> use_or <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
    glob_t files_found;

    check(argc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">USAGE: logfind [-o] words</span><span style="color:#e6db74">&#34;</span>);

    check(parse_args(<span style="color:#f92672">&amp;</span>use_or, <span style="color:#f92672">&amp;</span>argc, <span style="color:#f92672">&amp;</span>argv) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">USAGE: logfind [-o] words</span><span style="color:#e6db74">&#34;</span>);

    check(list_files(<span style="color:#f92672">&amp;</span>files_found) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to list files.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> files_found.gl_pathc; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        scan_file(files_found.gl_pathv[i], use_or, argc, argv);
    }

    globfree(<span style="color:#f92672">&amp;</span>files_found);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}

</code></pre></div><p>.\ex27\logfind.5\Makefile</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile">CFLAGS<span style="color:#f92672">=</span>-Wall -g

<span style="color:#a6e22e">all</span><span style="color:#f92672">:</span> logfind
    ./logfind <span style="color:#f92672">||</span> true
    ./logfind MAX_LINE
    ./logfind error MAX LINE
    ./logfind -o error MAX LINE

<span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
    rm -f logfind

</code></pre></div><p>logfind.5</p>
<p>.\ex27\logfind.5\logfind.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">define NDEBUG</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;glob.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;assert.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">const</span> size_t MAX_LINE <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span>;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">list_files</span>(glob_t <span style="color:#f92672">*</span>pglob) 
{
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>line <span style="color:#f92672">=</span> calloc(MAX_LINE, <span style="color:#ae81ff">1</span>);
    FILE <span style="color:#f92672">*</span>file <span style="color:#f92672">=</span> fopen(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">.logfind</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">int</span> glob_flags <span style="color:#f92672">=</span> GLOB_TILDE;
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;

    check(pglob <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Invalid glob_t given.</span><span style="color:#e6db74">&#34;</span>);
    check_mem(line);
    check(file, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to open .logfind. Make that first.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">while</span>(fgets(line, MAX_LINE<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, file) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL) {
        size_t line_length <span style="color:#f92672">=</span> strnlen(line, MAX_LINE <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
        assert(line_length <span style="color:#f92672">&lt;</span> MAX_LINE <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Got a line length too long.</span><span style="color:#e6db74">&#34;</span>);

        line[line_length] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>; <span style="color:#75715e">// drop the \n ending
</span><span style="color:#75715e"></span>        debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Globbing %s</span><span style="color:#e6db74">&#34;</span>, line);

        rc <span style="color:#f92672">=</span> glob(line, glob_flags, NULL, pglob);
        check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span><span style="color:#f92672">|</span> rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> GLOB_NOMATCH, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to glob.</span><span style="color:#e6db74">&#34;</span>);

        <span style="color:#75715e">// dumb work around to a stupid design in glob
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span>(glob_flags <span style="color:#f92672">=</span><span style="color:#f92672">=</span> GLOB_TILDE) glob_flags <span style="color:#f92672">|</span><span style="color:#f92672">=</span> GLOB_APPEND;
    }

    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> pglob<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>gl_pathc; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Matched file: %s</span><span style="color:#e6db74">&#34;</span>, pglob<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>gl_pathv[i]);
    }

    rc <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">// all good
</span><span style="color:#75715e"></span>
error: <span style="color:#75715e">// fallthrough
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span>(line) free(line);
    <span style="color:#66d9ef">return</span> rc;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">found_it</span>(<span style="color:#66d9ef">int</span> use_or, <span style="color:#66d9ef">int</span> found_count, <span style="color:#66d9ef">int</span> search_len)
{
    debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">use_or: %d, found_count: %d, search_len: %d</span><span style="color:#e6db74">&#34;</span>, use_or, found_count, search_len);

    <span style="color:#66d9ef">if</span>(use_or <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> found_count <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>use_or <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> found_count <span style="color:#f92672">=</span><span style="color:#f92672">=</span> search_len) {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
    }
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">scan_file</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>filename, <span style="color:#66d9ef">int</span> use_or, <span style="color:#66d9ef">int</span> search_len, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>search_for[])
{
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>line <span style="color:#f92672">=</span> calloc(MAX_LINE, <span style="color:#ae81ff">1</span>);
    FILE <span style="color:#f92672">*</span>file <span style="color:#f92672">=</span> fopen(filename, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">int</span> found_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    check_mem(line);
    check(file, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to open file: %s</span><span style="color:#e6db74">&#34;</span>, filename);

    <span style="color:#75715e">// read each line of the file and search that line for the contents
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span>(fgets(line, MAX_LINE<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, file) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL)
    {
        <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> search_len; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
            <span style="color:#66d9ef">if</span>(strcasestr(line, search_for[i]) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL) {
                debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">file: %s, line: %s, search: %s</span><span style="color:#e6db74">&#34;</span>, filename, line, search_for[i]);
                found_count<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
            }
        }

        <span style="color:#66d9ef">if</span>(found_it(use_or, found_count, search_len)) {
            printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, filename);
            <span style="color:#66d9ef">break</span>;
        } <span style="color:#66d9ef">else</span> {
            found_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        }
    }

    free(line);
    fclose(file);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">if</span>(line) free(line);
    <span style="color:#66d9ef">if</span>(file) fclose(file);

    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">parse_args</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>use_or, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#f92672">*</span>argv[]) 
{
    (<span style="color:#f92672">*</span>argc)<span style="color:#f92672">-</span><span style="color:#f92672">-</span>;
    (<span style="color:#f92672">*</span>argv)<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;

    <span style="color:#66d9ef">if</span>(strcmp((<span style="color:#f92672">*</span>argv)[<span style="color:#ae81ff">0</span>], <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">-o</span><span style="color:#e6db74">&#34;</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#f92672">*</span>use_or <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        (<span style="color:#f92672">*</span>argc)<span style="color:#f92672">-</span><span style="color:#f92672">-</span>; <span style="color:#75715e">// skip the -o
</span><span style="color:#75715e"></span>        (<span style="color:#f92672">*</span>argv)<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
        check(<span style="color:#f92672">*</span>argc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">You need words after -o.</span><span style="color:#e6db74">&#34;</span>);
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#f92672">*</span>use_or <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
error:
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> use_or <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
    glob_t files_found;

    check(argc <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">USAGE: logfind [-o] words</span><span style="color:#e6db74">&#34;</span>);

    check(parse_args(<span style="color:#f92672">&amp;</span>use_or, <span style="color:#f92672">&amp;</span>argc, <span style="color:#f92672">&amp;</span>argv) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">USAGE: logfind [-o] words</span><span style="color:#e6db74">&#34;</span>);

    check(list_files(<span style="color:#f92672">&amp;</span>files_found) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to list files.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> files_found.gl_pathc; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        scan_file(files_found.gl_pathv[i], use_or, argc, argv);
    }

    globfree(<span style="color:#f92672">&amp;</span>files_found);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}

</code></pre></div><p>.\ex27\logfind.5\Makefile</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-makefile" data-lang="makefile">CFLAGS<span style="color:#f92672">=</span>-Wall -g

<span style="color:#a6e22e">all</span><span style="color:#f92672">:</span> logfind
    ./logfind <span style="color:#f92672">||</span> true
    ./logfind MAX_LINE
    ./logfind error MAX LINE
    ./logfind -o error MAX LINE

<span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
    rm -f logfind

</code></pre></div><p>Read The Book</p>
<p>This video is a demonstration of the concepts in the book.</p>
<p>Go read the book.</p>
<p>Demonstration</p>
<p>I will demonstrate each of the following:</p>
<ul>
<li>Fail early and openly.</li>
<li>Document assumptions.</li>
<li>Prevention over documentation.</li>
<li>Automate everything.</li>
<li>Simplify and clarify.</li>
<li>Question authority.</li>
</ul>
<p>Fail Early and Openly</p>
<p>Document Assumptions</p>
<p>Prevention over Documentation</p>
<p>Automate Everything</p>
<p>Simplify and Clarify</p>
<p>Question Authority</p>
<p>Bonus: Assume Nothing</p>
<h3 id="exercise-28-intermediate-makefiles">Exercise 28 Intermediate Makefiles</h3>
<p>The Plan</p>
<ul>
<li>Learn how to create a project skeleton to make starting easier.</li>
<li>Learn more advanced GNU make tricks.</li>
</ul>
<p>The Skeleton</p>
<p>.\ex28\c-skeleton</p>
<p>.\ex28\c-skeleton\src\dbg.h</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">ifndef __dbg_h__</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define __dbg_h__</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;errno.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">ifdef NDEBUG</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define debug(M, ...)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">else</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define debug(M, ...) fprintf(stderr, &#34;DEBUG %s:%d: &#34; M &#34;\n&#34;,\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">        __FILE__, __LINE__, ##__VA_ARGS__)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define clean_errno() (errno == 0 ? &#34;None&#34; : strerror(errno))</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define log_err(M, ...) fprintf(stderr,\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">        &#34;[ERROR] (%s:%d: errno: %s) &#34; M &#34;\n&#34;, __FILE__, __LINE__,\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">        clean_errno(), ##__VA_ARGS__)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define log_warn(M, ...) fprintf(stderr,\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">        &#34;[WARN] (%s:%d: errno: %s) &#34; M &#34;\n&#34;,\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">        __FILE__, __LINE__, clean_errno(), ##__VA_ARGS__)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define log_info(M, ...) fprintf(stderr, &#34;[INFO] (%s:%d) &#34; M &#34;\n&#34;,\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">        __FILE__, __LINE__, ##__VA_ARGS__)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define check(A, M, ...) if(!(A)) {\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">    log_err(M, ##__VA_ARGS__); errno=0; goto error; }</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define sentinel(M, ...)  { log_err(M, ##__VA_ARGS__);\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">    errno=0; goto error; }</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define check_mem(A) check((A), &#34;Out of memory.&#34;)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define check_debug(A, M, ...) if(!(A)) { debug(M, ##__VA_ARGS__);\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">    errno=0; goto error; }</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
</code></pre></div><p>.\ex28\c-skeleton\src\libex29.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;ctype.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">print_a_message</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>msg)
{
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A STRING: %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, msg);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">uppercase</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>msg)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#75715e">// BUG: \0 termination problems
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; msg[i] <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%c</span><span style="color:#e6db74">&#34;</span>, toupper(msg[i]));
    }

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">lowercase</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>msg)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#75715e">// BUG: \0 termination problems
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; msg[i] <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%c</span><span style="color:#e6db74">&#34;</span>, tolower(msg[i]));
    }

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">fail_on_purpose</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>msg)
{
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
} 

</code></pre></div><p>.\ex28\c-skeleton\tests\libex29_tests.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;minunit.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;dlfcn.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">int</span> (<span style="color:#f92672">*</span>lib_function) (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>data);
<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>lib_file <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">build/libYOUR_LIBRARY.so</span><span style="color:#e6db74">&#34;</span>;
<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>lib <span style="color:#f92672">=</span> NULL;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">check_function</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>func_to_run, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>data,
        <span style="color:#66d9ef">int</span> expected)
{
    lib_function func <span style="color:#f92672">=</span> dlsym(lib, func_to_run);
    check(func <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL,
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Did not find %s function in the library %s: %s</span><span style="color:#e6db74">&#34;</span>, func_to_run,
            lib_file, dlerror());

    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> func(data);
    check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> expected, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Function %s return %d for data: %s</span><span style="color:#e6db74">&#34;</span>,
            func_to_run, rc, data);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
error:
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_dlopen</span>()
{
    lib <span style="color:#f92672">=</span> dlopen(lib_file, RTLD_NOW);
    mu_assert(lib <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to open the library to test.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_functions</span>()
{
    mu_assert(check_function(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">print_a_message</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Hello</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">0</span>),
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">print_a_message failed.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(check_function(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">uppercase</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Hello</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">0</span>),
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">uppercase failed.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(check_function(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">lowercase</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Hello</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">0</span>),
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">lowercase failed.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_failures</span>()
{
    mu_assert(check_function(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">fail_on_purpose</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Hello</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">1</span>),
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">fail_on_purpose should fail.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_dlclose</span>()
{
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> dlclose(lib);
    mu_assert(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to close lib.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">all_tests</span>()
{
    mu_suite_start();

    mu_run_test(test_dlopen);
    mu_run_test(test_functions);
    mu_run_test(test_failures);
    mu_run_test(test_dlclose);

    <span style="color:#66d9ef">return</span> NULL;
}

RUN_TESTS(all_tests);

</code></pre></div><p>The video is probably easier to follow than the book.
Watch me do this.</p>
<p>Using The Skeleton</p>
<p>.\ex28\c-skeleton</p>
<p>.\ex28\c-skeleton\src\dbg.h</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">ifndef __dbg_h__</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define __dbg_h__</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;errno.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">ifdef NDEBUG</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define debug(M, ...)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">else</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define debug(M, ...) fprintf(stderr, &#34;DEBUG %s:%d: &#34; M &#34;\n&#34;,\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">        __FILE__, __LINE__, ##__VA_ARGS__)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define clean_errno() (errno == 0 ? &#34;None&#34; : strerror(errno))</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define log_err(M, ...) fprintf(stderr,\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">        &#34;[ERROR] (%s:%d: errno: %s) &#34; M &#34;\n&#34;, __FILE__, __LINE__,\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">        clean_errno(), ##__VA_ARGS__)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define log_warn(M, ...) fprintf(stderr,\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">        &#34;[WARN] (%s:%d: errno: %s) &#34; M &#34;\n&#34;,\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">        __FILE__, __LINE__, clean_errno(), ##__VA_ARGS__)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define log_info(M, ...) fprintf(stderr, &#34;[INFO] (%s:%d) &#34; M &#34;\n&#34;,\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">        __FILE__, __LINE__, ##__VA_ARGS__)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define check(A, M, ...) if(!(A)) {\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">    log_err(M, ##__VA_ARGS__); errno=0; goto error; }</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define sentinel(M, ...)  { log_err(M, ##__VA_ARGS__);\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">    errno=0; goto error; }</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define check_mem(A) check((A), &#34;Out of memory.&#34;)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define check_debug(A, M, ...) if(!(A)) { debug(M, ##__VA_ARGS__);\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">    errno=0; goto error; }</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
</code></pre></div><p>.\ex28\c-skeleton\src\libex29.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;ctype.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">print_a_message</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>msg)
{
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A STRING: %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, msg);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">uppercase</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>msg)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#75715e">// BUG: \0 termination problems
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; msg[i] <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%c</span><span style="color:#e6db74">&#34;</span>, toupper(msg[i]));
    }

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">lowercase</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>msg)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#75715e">// BUG: \0 termination problems
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; msg[i] <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%c</span><span style="color:#e6db74">&#34;</span>, tolower(msg[i]));
    }

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">fail_on_purpose</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>msg)
{
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
} 

</code></pre></div><p>.\ex28\c-skeleton\tests\libex29_tests.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;minunit.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;dlfcn.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">int</span> (<span style="color:#f92672">*</span>lib_function) (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>data);
<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>lib_file <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">build/libYOUR_LIBRARY.so</span><span style="color:#e6db74">&#34;</span>;
<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>lib <span style="color:#f92672">=</span> NULL;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">check_function</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>func_to_run, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>data,
        <span style="color:#66d9ef">int</span> expected)
{
    lib_function func <span style="color:#f92672">=</span> dlsym(lib, func_to_run);
    check(func <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL,
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Did not find %s function in the library %s: %s</span><span style="color:#e6db74">&#34;</span>, func_to_run,
            lib_file, dlerror());

    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> func(data);
    check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> expected, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Function %s return %d for data: %s</span><span style="color:#e6db74">&#34;</span>,
            func_to_run, rc, data);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
error:
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_dlopen</span>()
{
    lib <span style="color:#f92672">=</span> dlopen(lib_file, RTLD_NOW);
    mu_assert(lib <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to open the library to test.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_functions</span>()
{
    mu_assert(check_function(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">print_a_message</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Hello</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">0</span>),
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">print_a_message failed.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(check_function(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">uppercase</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Hello</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">0</span>),
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">uppercase failed.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(check_function(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">lowercase</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Hello</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">0</span>),
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">lowercase failed.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_failures</span>()
{
    mu_assert(check_function(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">fail_on_purpose</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Hello</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">1</span>),
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">fail_on_purpose should fail.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_dlclose</span>()
{
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> dlclose(lib);
    mu_assert(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to close lib.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">all_tests</span>()
{
    mu_suite_start();

    mu_run_test(test_dlopen);
    mu_run_test(test_functions);
    mu_run_test(test_failures);
    mu_run_test(test_dlclose);

    <span style="color:#66d9ef">return</span> NULL;
}

RUN_TESTS(all_tests);

</code></pre></div><p>Now I'll use the skeleton to start a simple project for the next exercise.</p>
<p>The Analysis</p>
<p>Let's look at Makefile in depth.</p>
<p>Extra Credit</p>
<h3 id="exercise-29-libraries-and-linking">Exercise 29 Libraries and Linking</h3>
<p>The Plan</p>
<ul>
<li>Learn about libraries and how to link against them.</li>
<li>Learn how to load a dynamic library from inside C.</li>
</ul>
<p>The Code</p>
<p>.\ex29\ex29.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;dlfcn.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">int</span> (<span style="color:#f92672">*</span>lib_function) (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>data);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    check(argc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">USAGE: ex29 libex29.so function data</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>lib_file <span style="color:#f92672">=</span> argv[<span style="color:#ae81ff">1</span>];
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>func_to_run <span style="color:#f92672">=</span> argv[<span style="color:#ae81ff">2</span>];
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>data <span style="color:#f92672">=</span> argv[<span style="color:#ae81ff">3</span>];

    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>lib <span style="color:#f92672">=</span> dlopen(lib_file, RTLD_NOW);
    check(lib <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to open the library %s: %s</span><span style="color:#e6db74">&#34;</span>, lib_file,
            dlerror());

    lib_function func <span style="color:#f92672">=</span> dlsym(lib, func_to_run);
    check(func <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL,
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Did not find %s function in the library %s: %s</span><span style="color:#e6db74">&#34;</span>, func_to_run,
            lib_file, dlerror());

    rc <span style="color:#f92672">=</span> func(data);
    check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Function %s return %d for data: %s</span><span style="color:#e6db74">&#34;</span>, func_to_run,
            rc, data);

    rc <span style="color:#f92672">=</span> dlclose(lib);
    check(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to close %s</span><span style="color:#e6db74">&#34;</span>, lib_file);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}

</code></pre></div><p>.\ex29\libex29.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;ctype.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;dbg.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">print_a_message</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>msg)
{
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A STRING: %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, msg);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">uppercase</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>msg)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#75715e">// BUG: \0 termination problems
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; msg[i] <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%c</span><span style="color:#e6db74">&#34;</span>, toupper(msg[i]));
    }

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">lowercase</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>msg)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#75715e">// BUG: \0 termination problems
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; msg[i] <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%c</span><span style="color:#e6db74">&#34;</span>, tolower(msg[i]));
    }

    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">fail_on_purpose</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>msg)
{
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
} 

</code></pre></div><p>I'll use the project I started from the previous exercise.
This covers some of the extra credit.</p>
<p>The Analysis</p>
<p>This analysis might take a while, but be sure you know Exercise 28 well.</p>
<p>Breaking It</p>
<ul>
<li>Wreck the libex29.so file.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Were you paying attention to the bad code I have in the <code>libex29.c</code> functions?
Do you see how, even though I use a for-loop they still check for <code>'\0'</code>
endings?  Fix this so that the functions always take a length for the
string to work with inside the function.</li>
<li>Read the <code>man dlopen</code> documentation and read about all of the
related functions.  Try some of the other options to <code>dlopen</code>
beside <code>RTLD_NOW</code>.</li>
</ul>
<h3 id="exercise-30-automated-testing">Exercise 30 Automated Testing</h3>
<p>The Plan</p>
<p>Continue the Exercise 28-29 project and add automated tests to it.</p>
<p>Why Automate Tests</p>
<p>You are a programmer.
Your job is automating.</p>
<p>EVERYTHING</p>
<p>The Code</p>
<p>.\ex30\ex30.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;minunit.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_dlopen</span>(<span style="color:#66d9ef">int</span> stuff)
{
    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_functions</span>()
{

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_failures</span>()
{

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_dlclose</span>()
{

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">all_tests</span>()
{
    mu_suite_start();

    mu_run_test(test_dlopen);
    mu_run_test(test_functions);
    mu_run_test(test_failures);
    mu_run_test(test_dlclose);

    <span style="color:#66d9ef">return</span> NULL;
}

RUN_TESTS(all_tests);

</code></pre></div><p>Adding It To libex29</p>
<p>Breaking It</p>
<ul>
<li>Making tests fail first is useful.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>This works but it's probably a bit messy.  Clean the <code>c-skeleton</code>
directory up so that it has all of these files, but remove any of the code
related to Exercise 29.  You should be able to copy this directory
over and kick-start new projects without much editing.</li>
<li>Study the <code>runtests.sh</code>, and then go read about <code>bash</code> syntax
so you know what it does.  Do you think you could write a C version of this
script?</li>
</ul>
<h3 id="exercise-31-common-undefined-behavior">Exercise 31 Common Undefined Behavior</h3>
<p>The Plan</p>
<p>Review the issues around Undefined and Unspecified Behavior (UB).</p>
<p>Read The Book</p>
<p>The book lists many of the UB and discusses why they are important to know
about.</p>
<p>The Code</p>
<p>.\ex31\ex31.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[])
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">while</span> (i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">100</span>) {
        usleep(<span style="color:#ae81ff">3000</span>);
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

</code></pre></div><p>There is no code for this exercise, just a quick discussion for the book.</p>
<p>Undefined Behavior</p>
<ul>
<li>Compiler writers can do whatever they want.</li>
<li>This means even <em>nothing</em>, which will ruin you silently.</li>
<li>It's best to avoid it.</li>
</ul>
<p>Unspecified Behavior</p>
<ul>
<li>For practical purposes unspecified is the same as undefined.</li>
</ul>
<p>Handy Tools</p>
<ul>
<li>Clang's UB helpful flags.</li>
<li>Lint tools and static analyzers.</li>
</ul>
<p>Extra Credit</p>
<p>Spend a day reading through as much of the UB as you can and find examples of each.  Expect lots of frustration and failure when you do this.</p>

    </div>

    <div class="toc toc-fixed" >
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#exercise-0-installing-software">Exercise 0 Installing Software</a></li>
        <li><a href="#exercise-1-dust-off-that-compiler">Exercise 1 Dust Off That Compiler</a></li>
        <li><a href="#exercise-2-using-makefiles-to-build">Exercise 2 Using Makefiles to Build</a></li>
        <li><a href="#exercise-3-formatted-printing">Exercise 3 Formatted Printing</a></li>
        <li><a href="#exercise-4-using-a-debugger">Exercise 4 Using a Debugger</a></li>
        <li><a href="#exercise-5-memorizing-c-operators">Exercise 5 Memorizing C Operators</a></li>
        <li><a href="#exercise-6-memorizing-c-syntax">Exercise 6 Memorizing C Syntax</a></li>
        <li><a href="#exercise-7-variables-and-types">Exercise 7 Variables and Types</a></li>
        <li><a href="#exercise-8-if-else-if-else">Exercise 8 If, Else-If, Else</a></li>
        <li><a href="#exercise-9-while-loop-and-boolean-expressions">Exercise 9 While-Loop and Boolean Expressions</a></li>
        <li><a href="#exercise-10-switch-statements">Exercise 10 Switch Statements</a></li>
        <li><a href="#exercise-11-arrays-and-strings">Exercise 11 Arrays and Strings</a></li>
        <li><a href="#exercise-12-sizes-and-arrays">Exercise 12 Sizes and Arrays</a></li>
        <li><a href="#exercise-13-for-loops-and-arrays-of-strings">Exercise 13 For-Loops and Arrays of Strings</a></li>
        <li><a href="#exercise-14-writing-and-using-functions">Exercise 14 Writing and Using Functions</a></li>
        <li><a href="#exercise-15-pointers-dreaded-pointers">Exercise 15 Pointers, Dreaded Pointers</a></li>
        <li><a href="#exercise-16-structs-and-pointers-to-them">Exercise 16 Structs And Pointers To Them</a></li>
        <li><a href="#exercise-17-heap-and-stack-memory-allocation">Exercise 17 Heap and Stack Memory Allocation</a></li>
        <li><a href="#exercise-18-pointers-to-functions">Exercise 18 Pointers to Functions</a></li>
        <li><a href="#exercise-19-zeds-awesome-debug-macros">Exercise 19 Zed's Awesome Debug Macros</a></li>
        <li><a href="#exercise-20-advanced-debugging-techniques">Exercise 20 Advanced Debugging Techniques</a></li>
        <li><a href="#exercise-21-advanced-data-types-and-flow-control">Exercise 21 Advanced Data Types and Flow Control</a></li>
        <li><a href="#exercise-22-the-stack-scope-and-globals">Exercise 22 The Stack, Scope, and Globals</a></li>
        <li><a href="#exercise-23-meet-duffs-device">Exercise 23 Meet Duff's Device</a></li>
        <li><a href="#exercise-24-input-output-files">Exercise 24 Input, Output, Files</a></li>
        <li><a href="#exercise-25-variable-argument-functions">Exercise 25 Variable Argument Functions</a></li>
        <li><a href="#exercise-26-project-logfind">Exercise 26 Project logfind</a></li>
        <li><a href="#exercise-27-creative-and-defensive-programming">Exercise 27 Creative and Defensive Programming</a></li>
        <li><a href="#exercise-28-intermediate-makefiles">Exercise 28 Intermediate Makefiles</a></li>
        <li><a href="#exercise-29-libraries-and-linking">Exercise 29 Libraries and Linking</a></li>
        <li><a href="#exercise-30-automated-testing">Exercise 30 Automated Testing</a></li>
        <li><a href="#exercise-31-common-undefined-behavior">Exercise 31 Common Undefined Behavior</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

</div>

    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="/coding/c/" title="C "> <i class="fa fa-chevron-left"></i><label>C </label></a>
    <a class="nav nav-next" href="/coding/c/lcthw-lectures.2/" title="C Lecture - 2" style="margin-right: 0px;"><label>C Lecture - 2</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

    

    
  </div>


	<div>


  
    
  



	</div>
</footer>

<script src="/js/clipboard.min.js"></script>

<link href="/css/featherlight.min.css" rel="stylesheet">
<script src="/js/featherlight.min.js"></script>


<link href="/css/github.css" rel="stylesheet">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script src="/theme-flex/script.js"></script>


    

    
    

    
  </body>
</html>
<!DOCTYPE html>
<html>
  <head>
    <title>Hello World</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="revised" content="2020-02-16T13:41:22 AEDT">
<title>C Lecture - 2 :: Hello World</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/theme-flex/style.css" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "\/";
</script>
<meta name="description" content="Exercise 32 ~ 40">



    
  </head>
  <body data-url="/coding/c/lcthw-lectures.2/">
    
      <header>
  <div class="logo">
    
	
  
    <a class="baselink" href="/">Hello World</a>
  


  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
  <nav class="shortcuts">
    <div>
      <div class="searchbox">
        <input data-search-input id="search-by" type="text" placeholder="Search...">
      </div>
      <script type="text/javascript" src="/js/lunr.min.js"></script>
      <script type="text/javascript" src="/js/auto-complete.js"></script>
      <link href="/css/auto-complete.css" rel="stylesheet">
      <script type="text/javascript">
        
            var baseurl = "\/";
        
      </script>
      <script type="text/javascript" src="/js/search.js"></script>
    </div>
  </nav>
</header>
<article>
  <aside>
    <ul class="menu">
          <li data-nav-id="/" class="dd-item">
          <a href="/">
            <i class="fa fa-fw fa-home"></i>
          </a>
          </li>
    <li data-nav-id="/projects/" class="dd-item haschildren
        ">
      <div>
      <a href="/projects/">Projects</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/projects/python-flat-api/" class="dd-item">
        <div>
          <a href="/projects/python-flat-api/">
            FlatApi - Restful API for python dev
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/angular4-crm/" class="dd-item">
        <div>
          <a href="/projects/angular4-crm/">
            Angular 4 CRM Project
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/laravel-mvc-starter/" class="dd-item">
        <div>
          <a href="/projects/laravel-mvc-starter/">
            Laravel MVC Starter
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/react-crm/" class="dd-item">
        <div>
          <a href="/projects/react-crm/">
            React Redux CRM Project
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/vue2-admin/" class="dd-item">
        <div>
          <a href="/projects/vue2-admin/">
            Vue 2 Admin Project
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/vue2-crm/" class="dd-item">
        <div>
          <a href="/projects/vue2-crm/">
            Vue 2 CRM Project
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/angularjs-webpack-es6-starter/" class="dd-item">
        <div>
          <a href="/projects/angularjs-webpack-es6-starter/">
            Angularjs Webpack ES6 Starter
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/zf2-mvc-starter/" class="dd-item">
        <div>
          <a href="/projects/zf2-mvc-starter/">
            Zend Framework 2 MVC Starter
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/kube-cluster/" class="dd-item">
        <div>
          <a href="/projects/kube-cluster/">
            Kubernetes Cluster in 5min
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/coding/">Coding</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/coding/c/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/coding/c/">C </a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/c/lcthw-lectures.1/" class="dd-item">
        <div>
          <a href="/coding/c/lcthw-lectures.1/">
            C Lecture - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c/lcthw-lectures.2/" class="dd-item active">
        <div>
          <a href="/coding/c/lcthw-lectures.2/">
            C Lecture - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c/lcthw-lectures.3/" class="dd-item">
        <div>
          <a href="/coding/c/lcthw-lectures.3/">
            C Lecture - 3
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c/lcthw-lectures.4/" class="dd-item">
        <div>
          <a href="/coding/c/lcthw-lectures.4/">
            C Lecture - 4
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/c-sharp/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/c-sharp/">C#</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/c-sharp/csharp-note-1/" class="dd-item">
        <div>
          <a href="/coding/c-sharp/csharp-note-1/">
            C# Console App
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c-sharp/csharp-note-4/" class="dd-item">
        <div>
          <a href="/coding/c-sharp/csharp-note-4/">
             Generic Predicate &amp; Expression
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c-sharp/csharp-note-2/" class="dd-item">
        <div>
          <a href="/coding/c-sharp/csharp-note-2/">
            Scheduled task with window service
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c-sharp/csharp-note-3/" class="dd-item">
        <div>
          <a href="/coding/c-sharp/csharp-note-3/">
            Thread &amp; Task
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/db-sql/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/db-sql/">DB &amp; SQL</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/db-sql/mysql-note-1/" class="dd-item">
        <div>
          <a href="/coding/db-sql/mysql-note-1/">
            MySql Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/db-sql/mysql-note-2/" class="dd-item">
        <div>
          <a href="/coding/db-sql/mysql-note-2/">
            MySql Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/db-sql/mysql-note-3/" class="dd-item">
        <div>
          <a href="/coding/db-sql/mysql-note-3/">
            MySql Note - 3
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/db-sql/mysql-note-4/" class="dd-item">
        <div>
          <a href="/coding/db-sql/mysql-note-4/">
            MySql Note - 4
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/db-sql/mysql-note-5/" class="dd-item">
        <div>
          <a href="/coding/db-sql/mysql-note-5/">
            MySql Note - 5
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/db-sql/pgsql-note-1/" class="dd-item">
        <div>
          <a href="/coding/db-sql/pgsql-note-1/">
            PostgresQL Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/db-sql/mssql-note-1/" class="dd-item">
        <div>
          <a href="/coding/db-sql/mssql-note-1/">
            Sql Server Note - 1
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/golang/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/golang/">Golang</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/golang/go-note-1/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-1/">
            Getting started
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-2/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-2/">
            Map, Function &amp; Closure
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-3/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-3/">
            Struct &amp; Interface
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-4/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-4/">
            IO, Json &amp; XML
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-5/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-5/">
            Error handling
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-6/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-6/">
            Goroutine &amp; Channel - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-7/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-7/">
            Goroutine &amp; Channel - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-8/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-8/">
            Packaging
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-9/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-9/">
            Pitfalls
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-10/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-10/">
            Template
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-20/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-20/">
            Good practice - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-21/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-21/">
            Good practice 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-22/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-22/">
            Good practice 3
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-99/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-99/">
            Golang snippets
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/java/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/java/">Java</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/java/java-note-1/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-1/">
            Java Note - 1: Enum
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/java/java-note-2/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-2/">
            Java Note - 2: Concurrency
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/java/java-note-3/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-3/">
            Java Note - 3: Path and Files
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/java/java-note-4/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-4/">
            Java Note - 4: Date Time 
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/java/java-note-5/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-5/">
            Java Note - 5: Lambda 
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/js-ts/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/js-ts/">JS &amp; TS </a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/js-ts/js-note-1/" class="dd-item">
        <div>
          <a href="/coding/js-ts/js-note-1/">
            JS &amp; ES Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/js-ts/js-note-2/" class="dd-item">
        <div>
          <a href="/coding/js-ts/js-note-2/">
            JS &amp; ES Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/js-ts/js-note-3/" class="dd-item">
        <div>
          <a href="/coding/js-ts/js-note-3/">
            JS &amp; ES Note - 3
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/js-ts/js-note-99/" class="dd-item">
        <div>
          <a href="/coding/js-ts/js-note-99/">
            JS &amp; ES snippet
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/js-ts/ts-note-1/" class="dd-item">
        <div>
          <a href="/coding/js-ts/ts-note-1/">
            TypeScript Note - 1
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/python/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/python/">Python</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/python/python-note-1/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-1/">
            Package &amp; Module
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-2/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-2/">
            Closure &amp; Decorator
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-3/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-3/">
            String &amp; Representation
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-4/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-4/">
            Iteration
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-5/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-5/">
            Inheritance &amp; Polymorphism
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-6/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-6/">
            Collection
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-7/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-7/">
            Exception &amp; Assertion
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-8/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-8/">
            Context
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-9/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-9/">
            ABC
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/rustlang/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/rustlang/">Rustlang</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/rustlang/rust-note-1/" class="dd-item">
        <div>
          <a href="/coding/rustlang/rust-note-1/">
            Data Types &amp; Ownership
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/rustlang/rust-note-2/" class="dd-item">
        <div>
          <a href="/coding/rustlang/rust-note-2/">
            Project, Vector, String &amp; Hashmap
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/rustlang/rust-note-3/" class="dd-item">
        <div>
          <a href="/coding/rustlang/rust-note-3/">
            Error handling
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/rustlang/rust-note-4/" class="dd-item">
        <div>
          <a href="/coding/rustlang/rust-note-4/">
            Generic Type &amp; Trait 
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/shell/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/shell/">Shell</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/shell/bash-note-1/" class="dd-item">
        <div>
          <a href="/coding/shell/bash-note-1/">
            Adv Bash - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/shell/bash-note-2/" class="dd-item">
        <div>
          <a href="/coding/shell/bash-note-2/">
            Adv Bash - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/shell/bash-note-3/" class="dd-item">
        <div>
          <a href="/coding/shell/bash-note-3/">
            Adv Bash - 3
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/shell/cron-note-1/" class="dd-item">
        <div>
          <a href="/coding/shell/cron-note-1/">
            Cron Job Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/shell/cron-note-2/" class="dd-item">
        <div>
          <a href="/coding/shell/cron-note-2/">
            Cron Job Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/shell/ps-note-1/" class="dd-item">
        <div>
          <a href="/coding/shell/ps-note-1/">
            Powershell Note - 1
          </a>
        </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/cloud/" class="dd-item haschildren
        ">
      <div>
      <a href="/cloud/">Cloud</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/cloud/aws-note-1/" class="dd-item">
        <div>
          <a href="/cloud/aws-note-1/">
            AWS Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/cloud/aws-note-2/" class="dd-item">
        <div>
          <a href="/cloud/aws-note-2/">
            AWS Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/cloud/digito-note-1/" class="dd-item">
        <div>
          <a href="/cloud/digito-note-1/">
            DigitialOcean Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/cloud/digito-note-2/" class="dd-item">
        <div>
          <a href="/cloud/digito-note-2/">
            DigitialOcean Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/cloud/digito-note-3/" class="dd-item">
        <div>
          <a href="/cloud/digito-note-3/">
            DigitialOcean Note - 3
          </a>
        </div>
    </li>
      <li data-nav-id="/cloud/digito-note-4/" class="dd-item">
        <div>
          <a href="/cloud/digito-note-4/">
            DigitialOcean Note - 4
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/hacks/" class="dd-item haschildren
        ">
      <div>
      <a href="/hacks/">Hacks</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/hacks/git-notes/" class="dd-item">
        <div>
          <a href="/hacks/git-notes/">
            Git Practices
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/windows-command-3/" class="dd-item">
        <div>
          <a href="/hacks/windows-command-3/">
            Windows cmd &amp; hotkey - 3
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/windows-command-2/" class="dd-item">
        <div>
          <a href="/hacks/windows-command-2/">
            Windows cmd &amp; hotkey - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/windows-command-1/" class="dd-item">
        <div>
          <a href="/hacks/windows-command-1/">
            Windows cmd &amp; hotkey - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/cass-note/" class="dd-item">
        <div>
          <a href="/hacks/cass-note/">
            Cassandra Practices
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/php-debug/" class="dd-item">
        <div>
          <a href="/hacks/php-debug/">
            Debug PHP with Free IDE
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/qemu-notes/" class="dd-item">
        <div>
          <a href="/hacks/qemu-notes/">
            Qemu &amp; Virtual Machine
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/vbox-notes/" class="dd-item">
        <div>
          <a href="/hacks/vbox-notes/">
            VirtualBox Notes
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/os/" class="dd-item haschildren
        ">
      <div>
      <a href="/os/">OS</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/os/dual-boot-win10-ubuntu18/" class="dd-item">
        <div>
          <a href="/os/dual-boot-win10-ubuntu18/">
            Dual Boot Windows 10 &amp; Ubuntu 18
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-desktop-18/" class="dd-item">
        <div>
          <a href="/os/ubuntu-desktop-18/">
            Ubuntu Desktop 18 LTS note
          </a>
        </div>
    </li>
      <li data-nav-id="/os/raspberrypi-notes/" class="dd-item">
        <div>
          <a href="/os/raspberrypi-notes/">
            Raspberry Pi setup
          </a>
        </div>
    </li>
      <li data-nav-id="/os/lubuntu16-desktop/" class="dd-item">
        <div>
          <a href="/os/lubuntu16-desktop/">
            Lubuntu 16 desktop
          </a>
        </div>
    </li>
      <li data-nav-id="/os/grub-trouble-shooting/" class="dd-item">
        <div>
          <a href="/os/grub-trouble-shooting/">
            Grub Trouble Shooting
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-server-16/" class="dd-item">
        <div>
          <a href="/os/ubuntu-server-16/">
            Ubuntu 16 server note
          </a>
        </div>
    </li>
      <li data-nav-id="/os/centos-server-7/" class="dd-item">
        <div>
          <a href="/os/centos-server-7/">
            CentOS 7 Server note
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-server-14/" class="dd-item">
        <div>
          <a href="/os/ubuntu-server-14/">
            Ubuntu 14 -- server setup
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-desktop-14/" class="dd-item">
        <div>
          <a href="/os/ubuntu-desktop-14/">
            Ubuntu 14 -- desktop setup &amp; dual boot 
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-desktop-14-extra-tools/" class="dd-item">
        <div>
          <a href="/os/ubuntu-desktop-14-extra-tools/">
            Ubuntu 14 -- desktop, extra tools
          </a>
        </div>
    </li>
      <li data-nav-id="/os/centos-fedora-desktop/" class="dd-item">
        <div>
          <a href="/os/centos-fedora-desktop/">
            CentOS 6/7 Multi-Boot Setup
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/blogs/" class="dd-item haschildren
        ">
      <div>
      <a href="/blogs/">Blogs</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/blogs/k8s-on-vm/" class="dd-item">
        <div>
          <a href="/blogs/k8s-on-vm/">
            Try Minikube
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/vue-ng-react/" class="dd-item">
        <div>
          <a href="/blogs/vue-ng-react/">
            Angular vs React vs Vue
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/create-a-blog-on-github/" class="dd-item">
        <div>
          <a href="/blogs/create-a-blog-on-github/">
            Create a blog site on GitHub Pages
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/build-mobile-app/" class="dd-item">
        <div>
          <a href="/blogs/build-mobile-app/">
            Build mobile app with web tech
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/azure-notes/" class="dd-item">
        <div>
          <a href="/blogs/azure-notes/">
            Azure Practices
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/javascript-oop/" class="dd-item">
        <div>
          <a href="/blogs/javascript-oop/">
            JavaScript and OOP
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/frameworks/" class="dd-item haschildren
        ">
      <div>
      <a href="/frameworks/">Frameworks</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/frameworks/cntk-notes-1/" class="dd-item">
        <div>
          <a href="/frameworks/cntk-notes-1/">
            CNTK Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/frameworks/tensorflow-notes-1/" class="dd-item">
        <div>
          <a href="/frameworks/tensorflow-notes-1/">
            Tensorflow Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/frameworks/tensorflow-notes-2/" class="dd-item">
        <div>
          <a href="/frameworks/tensorflow-notes-2/">
            Tensorflow Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/frameworks/php-web/" class="dd-item">
        <div>
          <a href="/frameworks/php-web/">
            PHP Web Framework
          </a>
        </div>
    </li>
      <li data-nav-id="/frameworks/python-django/" class="dd-item">
        <div>
          <a href="/frameworks/python-django/">
            Python Web Framework
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/tut/" class="dd-item haschildren
        ">
      <div>
      <a href="/tut/">Tutorial</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/tut/docker/" class="dd-item">
        <div>
          <a href="/tut/docker/">
            Docker Tutorial
          </a>
        </div>
    </li>
      <li data-nav-id="/tut/javascript/" class="dd-item">
        <div>
          <a href="/tut/javascript/">
            JavaScript Tutorial
          </a>
        </div>
    </li>
      <li data-nav-id="/tut/kube/" class="dd-item">
        <div>
          <a href="/tut/kube/">
            Kubernetes Tutorial
          </a>
        </div>
    </li>
        </ul>
    </li>




    </ul>
    <section>
    </section>
  </aside>
  <section class="page">
    
    <div class="nav-select">
      <center>Navigation : 
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/projects/" >
   Projects</option>
    <option value="/coding/" >
   Coding</option> 
    <option value="/coding/c/" >
  - 
   C </option> 
      <option value="/coding/c/lcthw-lectures.1/" >-- C Lecture - 1</option>
      <option value="/coding/c/lcthw-lectures.2/"  selected>-- C Lecture - 2</option>
      <option value="/coding/c/lcthw-lectures.3/" >-- C Lecture - 3</option>
      <option value="/coding/c/lcthw-lectures.4/" >-- C Lecture - 4</option>
  
    <option value="/coding/c-sharp/" >
  - 
   C#</option>
    <option value="/coding/db-sql/" >
  - 
   DB &amp; SQL</option>
    <option value="/coding/golang/" >
  - 
   Golang</option>
    <option value="/coding/java/" >
  - 
   Java</option>
    <option value="/coding/js-ts/" >
  - 
   JS &amp; TS </option>
    <option value="/coding/python/" >
  - 
   Python</option>
    <option value="/coding/rustlang/" >
  - 
   Rustlang</option>
    <option value="/coding/shell/" >
  - 
   Shell</option>
  
    <option value="/cloud/" >
   Cloud</option>
    <option value="/hacks/" >
   Hacks</option>
    <option value="/os/" >
   OS</option>
    <option value="/blogs/" >
   Blogs</option>
    <option value="/frameworks/" >
   Frameworks</option>
    <option value="/tut/" >
   Tutorial</option>



        </select>
      </center>
    </div>


    


    
    
    
<div class="main-page">
    <div class="flex-item main-content">
            <h1>C Lecture - 2</h1>
        <p>Author: Zed A. Shaw</p>
<p>All content comes from Zed's <a href="https://github.com/zedshaw/learn-c-the-hard-way-lectures.git">Lecture Repository</a> and <a href="https://github.com/zedshaw/liblcthw">Libraries Repository</a>.  All credit goes to Zed.</p>
<h3 id="exercise-32-double-linked-lists">Exercise 32 Double Linked Lists</h3>
<p>The Plan</p>
<p>Learn about your very first data structure:</p>
<p>Double Linked Lists</p>
<p>Creating A liblcthw Project</p>
<p>We'll need a project for the rest of the book called <em>liblcthw</em>.</p>
<p>Algorithms and Data Structures</p>
<p>A big step in going from amateur to professional is learning
about data structures and algorithms.</p>
<p>A double linked list is the easiest one.</p>
<p>Double Linked Lists Visually</p>
<p>I'll quickly draw some diagrams to show you how they work.</p>
<p>Automated Testing Demo</p>
<p>You can enter the code just fine, but watch me write
the test.</p>
<p>Code Reviews</p>
<p>.\ex32\list.h</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">ifndef lcthw_List_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define lcthw_List_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">struct</span> ListNode;

<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> ListNode {
    <span style="color:#66d9ef">struct</span> ListNode <span style="color:#f92672">*</span>next;
    <span style="color:#66d9ef">struct</span> ListNode <span style="color:#f92672">*</span>prev;
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>value;
} ListNode;

<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> List {
    <span style="color:#66d9ef">int</span> count;
    ListNode <span style="color:#f92672">*</span>first;
    ListNode <span style="color:#f92672">*</span>last;
} List;

List <span style="color:#f92672">*</span><span style="color:#a6e22e">List_create</span>();
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">List_destroy</span>(List <span style="color:#f92672">*</span> list);
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">List_clear</span>(List <span style="color:#f92672">*</span> list);
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">List_clear_destroy</span>(List <span style="color:#f92672">*</span> list);

<span style="color:#75715e">#</span><span style="color:#75715e">define List_count(A) ((A)-&gt;count)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define List_first(A) ((A)-&gt;first != NULL ? (A)-&gt;first-&gt;value : NULL)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define List_last(A) ((A)-&gt;last != NULL ? (A)-&gt;last-&gt;value : NULL)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">List_push</span>(List <span style="color:#f92672">*</span> list, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>value);
<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">List_pop</span>(List <span style="color:#f92672">*</span> list);

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">List_unshift</span>(List <span style="color:#f92672">*</span> list, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>value);
<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">List_shift</span>(List <span style="color:#f92672">*</span> list);

<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">List_remove</span>(List <span style="color:#f92672">*</span> list, ListNode <span style="color:#f92672">*</span> node);

<span style="color:#75715e">#</span><span style="color:#75715e">define LIST_FOREACH(L, S, M, V) ListNode *_node = NULL;\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">                                                   ListNode *V = NULL;\</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">for(V = _node = L-&gt;S; _node != NULL; V = _node = _node-&gt;M)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
</code></pre></div><p>.\ex32\list.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/list.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/dbg.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
List <span style="color:#f92672">*</span><span style="color:#a6e22e">List_create</span>()
{
    <span style="color:#66d9ef">return</span> calloc(<span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">sizeof</span>(List));
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">List_destroy</span>(List <span style="color:#f92672">*</span> list)
{
    LIST_FOREACH(list, first, next, cur) {
        <span style="color:#66d9ef">if</span> (cur<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>prev) {
            free(cur<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>prev);
        }
    }

    free(list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>last);
    free(list);
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">List_clear</span>(List <span style="color:#f92672">*</span> list)
{
    LIST_FOREACH(list, first, next, cur) {
        free(cur<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>value);
    }
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">List_clear_destroy</span>(List <span style="color:#f92672">*</span> list)
{
    List_clear(list);
    List_destroy(list);
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">List_push</span>(List <span style="color:#f92672">*</span> list, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>value)
{
    ListNode <span style="color:#f92672">*</span>node <span style="color:#f92672">=</span> calloc(<span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">sizeof</span>(ListNode));
    check_mem(node);

    node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>value <span style="color:#f92672">=</span> value;

    <span style="color:#66d9ef">if</span> (list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>last <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL) {
        list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>first <span style="color:#f92672">=</span> node;
        list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>last <span style="color:#f92672">=</span> node;
    } <span style="color:#66d9ef">else</span> {
        list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>last<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>next <span style="color:#f92672">=</span> node;
        node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>prev <span style="color:#f92672">=</span> list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>last;
        list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>last <span style="color:#f92672">=</span> node;
    }

    list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>count<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;

error:
    <span style="color:#66d9ef">return</span>;
}

<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">List_pop</span>(List <span style="color:#f92672">*</span> list)
{
    ListNode <span style="color:#f92672">*</span>node <span style="color:#f92672">=</span> list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>last;
    <span style="color:#66d9ef">return</span> node <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL <span style="color:#f92672">?</span> List_remove(list, node) <span style="color:#f92672">:</span> NULL;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">List_unshift</span>(List <span style="color:#f92672">*</span> list, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>value)
{
    ListNode <span style="color:#f92672">*</span>node <span style="color:#f92672">=</span> calloc(<span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">sizeof</span>(ListNode));
    check_mem(node);

    node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>value <span style="color:#f92672">=</span> value;

    <span style="color:#66d9ef">if</span> (list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>first <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL) {
        list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>first <span style="color:#f92672">=</span> node;
        list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>last <span style="color:#f92672">=</span> node;
    } <span style="color:#66d9ef">else</span> {
        node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>next <span style="color:#f92672">=</span> list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>first;
        list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>first<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>prev <span style="color:#f92672">=</span> node;
        list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>first <span style="color:#f92672">=</span> node;
    }

    list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>count<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;

error:
    <span style="color:#66d9ef">return</span>;
}

<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">List_shift</span>(List <span style="color:#f92672">*</span> list)
{
    ListNode <span style="color:#f92672">*</span>node <span style="color:#f92672">=</span> list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>first;
    <span style="color:#66d9ef">return</span> node <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL <span style="color:#f92672">?</span> List_remove(list, node) <span style="color:#f92672">:</span> NULL;
}

<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">List_remove</span>(List <span style="color:#f92672">*</span> list, ListNode <span style="color:#f92672">*</span> node)
{
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>result <span style="color:#f92672">=</span> NULL;

    check(list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>first <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>last, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">List is empty.</span><span style="color:#e6db74">&#34;</span>);
    check(node, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">node can&#39;t be NULL</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">if</span> (node <span style="color:#f92672">=</span><span style="color:#f92672">=</span> list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>first <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> node <span style="color:#f92672">=</span><span style="color:#f92672">=</span> list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>last) {
        list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>first <span style="color:#f92672">=</span> NULL;
        list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>last <span style="color:#f92672">=</span> NULL;
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (node <span style="color:#f92672">=</span><span style="color:#f92672">=</span> list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>first) {
        list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>first <span style="color:#f92672">=</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>next;
        check(list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>first <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL,
                <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Invalid list, somehow got a first that is NULL.</span><span style="color:#e6db74">&#34;</span>);
        list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>first<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>prev <span style="color:#f92672">=</span> NULL;
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (node <span style="color:#f92672">=</span><span style="color:#f92672">=</span> list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>last) {
        list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>last <span style="color:#f92672">=</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>prev;
        check(list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>last <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL,
                <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Invalid list, somehow got a next that is NULL.</span><span style="color:#e6db74">&#34;</span>);
        list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>last<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>next <span style="color:#f92672">=</span> NULL;
    } <span style="color:#66d9ef">else</span> {
        ListNode <span style="color:#f92672">*</span>after <span style="color:#f92672">=</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>next;
        ListNode <span style="color:#f92672">*</span>before <span style="color:#f92672">=</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>prev;
        after<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>prev <span style="color:#f92672">=</span> before;
        before<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>next <span style="color:#f92672">=</span> after;
    }

    list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>count<span style="color:#f92672">-</span><span style="color:#f92672">-</span>;
    result <span style="color:#f92672">=</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>value;
    free(node);

error:
    <span style="color:#66d9ef">return</span> result;
}

</code></pre></div><p>.\ex32\list_tests.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;minunit.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/list.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;assert.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">static</span> List <span style="color:#f92672">*</span>list <span style="color:#f92672">=</span> NULL;
<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>test1 <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">test1 data</span><span style="color:#e6db74">&#34;</span>;
<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>test2 <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">test2 data</span><span style="color:#e6db74">&#34;</span>;
<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>test3 <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">test3 data</span><span style="color:#e6db74">&#34;</span>;

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_create</span>()
{
    list <span style="color:#f92672">=</span> List_create();
    mu_assert(list <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to create list.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_destroy</span>()
{
    List_clear_destroy(list);

    <span style="color:#66d9ef">return</span> NULL;

}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_push_pop</span>()
{
    List_push(list, test1);
    mu_assert(List_last(list) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> test1, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong last value.</span><span style="color:#e6db74">&#34;</span>);

    List_push(list, test2);
    mu_assert(List_last(list) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> test2, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong last value</span><span style="color:#e6db74">&#34;</span>);

    List_push(list, test3);
    mu_assert(List_last(list) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> test3, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong last value.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(List_count(list) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong count on push.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>val <span style="color:#f92672">=</span> List_pop(list);
    mu_assert(val <span style="color:#f92672">=</span><span style="color:#f92672">=</span> test3, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong value on pop.</span><span style="color:#e6db74">&#34;</span>);

    val <span style="color:#f92672">=</span> List_pop(list);
    mu_assert(val <span style="color:#f92672">=</span><span style="color:#f92672">=</span> test2, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong value on pop.</span><span style="color:#e6db74">&#34;</span>);

    val <span style="color:#f92672">=</span> List_pop(list);
    mu_assert(val <span style="color:#f92672">=</span><span style="color:#f92672">=</span> test1, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong value on pop.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(List_count(list) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong count after pop.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_unshift</span>()
{
    List_unshift(list, test1);
    mu_assert(List_first(list) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> test1, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong first value.</span><span style="color:#e6db74">&#34;</span>);

    List_unshift(list, test2);
    mu_assert(List_first(list) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> test2, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong first value</span><span style="color:#e6db74">&#34;</span>);

    List_unshift(list, test3);
    mu_assert(List_first(list) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> test3, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong last value.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(List_count(list) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong count on unshift.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_remove</span>()
{
    <span style="color:#75715e">// we only need to test the middle remove case since push/shift 
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// already tests the other cases
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>val <span style="color:#f92672">=</span> List_remove(list, list<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>first<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>next);
    mu_assert(val <span style="color:#f92672">=</span><span style="color:#f92672">=</span> test2, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong removed element.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(List_count(list) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong count after remove.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(List_first(list) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> test3, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong first after remove.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(List_last(list) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> test1, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong last after remove.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_shift</span>()
{
    mu_assert(List_count(list) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong count before shift.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>val <span style="color:#f92672">=</span> List_shift(list);
    mu_assert(val <span style="color:#f92672">=</span><span style="color:#f92672">=</span> test3, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong value on shift.</span><span style="color:#e6db74">&#34;</span>);

    val <span style="color:#f92672">=</span> List_shift(list);
    mu_assert(val <span style="color:#f92672">=</span><span style="color:#f92672">=</span> test1, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong value on shift.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(List_count(list) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong count after shift.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">all_tests</span>()
{
    mu_suite_start();

    mu_run_test(test_create);
    mu_run_test(test_push_pop);
    mu_run_test(test_unshift);
    mu_run_test(test_remove);
    mu_run_test(test_shift);
    mu_run_test(test_destroy);

    <span style="color:#66d9ef">return</span> NULL;
}

RUN_TESTS(all_tests);

</code></pre></div><p>Later videos will demonstrate how to code review to make code solid.</p>
<p>Improving It</p>
<ul>
<li>You can make <code>List_clear_destroy</code> more efficient by using
<code>LIST_FOREACH</code> and doing both <code>free</code> calls inside one
loop.</li>
<li>You can add asserts for preconditions so that the program isn't given a <code>NULL</code>
value for the <code>List *list</code> parameters.</li>
</ul>
<p>Improving It</p>
<ul>
<li>You can add invariants that check that the list's contents are always correct,
such as <code>count</code> is never <code>&lt; 0</code>, and if <code>count &gt; 0</code>, then <code>first</code> isn't NULL.</li>
<li>You can add documentation to the header file in the form of comments before
each struct, function, and macro that describes what it does.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Research doubly vs. singly linked lists and when one is preferred over
the other.</li>
<li>Research the limitations of a doubly linked list.  For example, while they
are efficient for inserting and deleting elements, they are very slow for
iterating over them all.</li>
<li>What operations are missing that you can imagine needing?  Some examples
are copying, joining, and splitting.  Implement these operations and write the
unit tests for them.</li>
</ul>
<h3 id="exercise-33-linked-list-algorithms">Exercise 33 Linked List Algorithms</h3>
<p>The Plan</p>
<p>Learn two sorting algorithms for double linked lists.</p>
<p>Watch how to conduct a simple code review.</p>
<p>The Code</p>
<p>.\ex33\list_algos.h</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">ifndef lcthw_List_algos_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define lcthw_List_algos_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/list.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">int</span> (<span style="color:#f92672">*</span>List_compare) (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>b);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">List_bubble_sort</span>(List <span style="color:#f92672">*</span> list, List_compare cmp);

List <span style="color:#f92672">*</span><span style="color:#a6e22e">List_merge_sort</span>(List <span style="color:#f92672">*</span> list, List_compare cmp);

<span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
</code></pre></div><p>.\ex33\list_algos.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/list_algos.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/dbg.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ListNode_swap</span>(ListNode <span style="color:#f92672">*</span> a, ListNode <span style="color:#f92672">*</span> b)
{
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>temp <span style="color:#f92672">=</span> a<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>value;
    a<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>value <span style="color:#f92672">=</span> b<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>value;
    b<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>value <span style="color:#f92672">=</span> temp;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">List_bubble_sort</span>(List <span style="color:#f92672">*</span> list, List_compare cmp)
{
    <span style="color:#66d9ef">int</span> sorted <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;

    <span style="color:#66d9ef">if</span> (List_count(list) <span style="color:#f92672">&lt;</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;        <span style="color:#75715e">// already sorted
</span><span style="color:#75715e"></span>    }

    <span style="color:#66d9ef">do</span> {
        sorted <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
        LIST_FOREACH(list, first, next, cur) {
            <span style="color:#66d9ef">if</span> (cur<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>next) {
                <span style="color:#66d9ef">if</span> (cmp(cur<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>value, cur<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>next<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>value) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
                    ListNode_swap(cur, cur<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>next);
                    sorted <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
                }
            }
        }
    } <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span>sorted);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">inline</span> List <span style="color:#f92672">*</span><span style="color:#a6e22e">List_merge</span>(List <span style="color:#f92672">*</span> left, List <span style="color:#f92672">*</span> right, List_compare cmp)
{
    List <span style="color:#f92672">*</span>result <span style="color:#f92672">=</span> List_create();
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>val <span style="color:#f92672">=</span> NULL;

    <span style="color:#66d9ef">while</span> (List_count(left) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span><span style="color:#f92672">|</span> List_count(right) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">if</span> (List_count(left) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> List_count(right) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
            <span style="color:#66d9ef">if</span> (cmp(List_first(left), List_first(right)) <span style="color:#f92672">&lt;</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
                val <span style="color:#f92672">=</span> List_shift(left);
            } <span style="color:#66d9ef">else</span> {
                val <span style="color:#f92672">=</span> List_shift(right);
            }

            List_push(result, val);
        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (List_count(left) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
            val <span style="color:#f92672">=</span> List_shift(left);
            List_push(result, val);
        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (List_count(right) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
            val <span style="color:#f92672">=</span> List_shift(right);
            List_push(result, val);
        }
    }

    <span style="color:#66d9ef">return</span> result;
}

List <span style="color:#f92672">*</span><span style="color:#a6e22e">List_merge_sort</span>(List <span style="color:#f92672">*</span> list, List_compare cmp)
{
    List <span style="color:#f92672">*</span>result <span style="color:#f92672">=</span> NULL;

    <span style="color:#66d9ef">if</span> (List_count(list) <span style="color:#f92672">&lt;</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) {
        <span style="color:#66d9ef">return</span> list;
    }

    List <span style="color:#f92672">*</span>left <span style="color:#f92672">=</span> List_create();
    List <span style="color:#f92672">*</span>right <span style="color:#f92672">=</span> List_create();
    <span style="color:#66d9ef">int</span> middle <span style="color:#f92672">=</span> List_count(list) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>;

    LIST_FOREACH(list, first, next, cur) {
        <span style="color:#66d9ef">if</span> (middle <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
            List_push(left, cur<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>value);
        } <span style="color:#66d9ef">else</span> {
            List_push(right, cur<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>value);
        }

        middle<span style="color:#f92672">-</span><span style="color:#f92672">-</span>;
    }

    List <span style="color:#f92672">*</span>sort_left <span style="color:#f92672">=</span> List_merge_sort(left, cmp);
    List <span style="color:#f92672">*</span>sort_right <span style="color:#f92672">=</span> List_merge_sort(right, cmp);

    <span style="color:#66d9ef">if</span> (sort_left <span style="color:#f92672">!</span><span style="color:#f92672">=</span> left)
        List_destroy(left);
    <span style="color:#66d9ef">if</span> (sort_right <span style="color:#f92672">!</span><span style="color:#f92672">=</span> right)
        List_destroy(right);

    result <span style="color:#f92672">=</span> List_merge(sort_left, sort_right, cmp);

    List_destroy(sort_left);
    List_destroy(sort_right);

    <span style="color:#66d9ef">return</span> result;
}

</code></pre></div><p>.\ex33\list_algos_tests.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;minunit.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/list_algos.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;assert.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>values[] <span style="color:#f92672">=</span> { <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">XXXX</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">1234</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">abcd</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">xjvef</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">NDSS</span><span style="color:#e6db74">&#34;</span> };

<span style="color:#75715e">#</span><span style="color:#75715e">define NUM_VALUES 5</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
List <span style="color:#f92672">*</span><span style="color:#a6e22e">create_words</span>()
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    List <span style="color:#f92672">*</span>words <span style="color:#f92672">=</span> List_create();

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> NUM_VALUES; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        List_push(words, values[i]);
    }

    <span style="color:#66d9ef">return</span> words;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">is_sorted</span>(List <span style="color:#f92672">*</span> words)
{
    LIST_FOREACH(words, first, next, cur) {
        <span style="color:#66d9ef">if</span> (cur<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>next <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> strcmp(cur<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>value, cur<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>next<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>value) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
            debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s %s</span><span style="color:#e6db74">&#34;</span>, (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)cur<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>value,
                    (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)cur<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>next<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>value);
            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
        }
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_bubble_sort</span>()
{
    List <span style="color:#f92672">*</span>words <span style="color:#f92672">=</span> create_words();

    <span style="color:#75715e">// should work on a list that needs sorting
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> List_bubble_sort(words, (List_compare) strcmp);
    mu_assert(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Bubble sort failed.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(is_sorted(words),
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Words are not sorted after bubble sort.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#75715e">// should work on an already sorted list
</span><span style="color:#75715e"></span>    rc <span style="color:#f92672">=</span> List_bubble_sort(words, (List_compare) strcmp);
    mu_assert(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Bubble sort of already sorted failed.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(is_sorted(words),
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Words should be sort if already bubble sorted.</span><span style="color:#e6db74">&#34;</span>);

    List_destroy(words);

    <span style="color:#75715e">// should work on an empty list
</span><span style="color:#75715e"></span>    words <span style="color:#f92672">=</span> List_create(words);
    rc <span style="color:#f92672">=</span> List_bubble_sort(words, (List_compare) strcmp);
    mu_assert(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Bubble sort failed on empty list.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(is_sorted(words), <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Words should be sorted if empty.</span><span style="color:#e6db74">&#34;</span>);

    List_destroy(words);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_merge_sort</span>()
{
    List <span style="color:#f92672">*</span>words <span style="color:#f92672">=</span> create_words();

    <span style="color:#75715e">// should work on a list that needs sorting
</span><span style="color:#75715e"></span>    List <span style="color:#f92672">*</span>res <span style="color:#f92672">=</span> List_merge_sort(words, (List_compare) strcmp);
    mu_assert(is_sorted(res), <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Words are not sorted after merge sort.</span><span style="color:#e6db74">&#34;</span>);

    List <span style="color:#f92672">*</span>res2 <span style="color:#f92672">=</span> List_merge_sort(res, (List_compare) strcmp);
    mu_assert(is_sorted(res),
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should still be sorted after merge sort.</span><span style="color:#e6db74">&#34;</span>);
    List_destroy(res2);
    List_destroy(res);

    List_destroy(words);
    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">all_tests</span>()
{
    mu_suite_start();

    mu_run_test(test_bubble_sort);
    mu_run_test(test_merge_sort);

    <span style="color:#66d9ef">return</span> NULL;
}

RUN_TESTS(all_tests);

</code></pre></div><p>You should be able to create this and figure out how it works.</p>
<p>I will assume you've done that, and now to code review.</p>
<p>Bubble Sort</p>
<p>Code review of bubble sort.</p>
<p>Start with the unit test and move from there.</p>
<p>Merge Sort</p>
<p>Code review of merge sort.</p>
<p>Improving It</p>
<ul>
<li>The merge sort does a crazy amount of copying and creating lists, so find ways to reduce this.</li>
<li>The bubble sort description in Wikipedia mentions a few optimizations. Try to implement them.</li>
<li>Can you use the <code>List_split</code> and <code>List_join</code> (if you implemented them) to improve merge sort?</li>
<li>Go through of all the defensive programming checks and improve the robustness of
this implementation, protecting against bad <code>NULL</code> pointers, and then create
an optional debug level invariant that works like <code>is_sorted</code> does
after a sort.</li>
</ul>
<p>Breaking It</p>
<ul>
<li>Overload the data structure to hit the worst case time complexity.</li>
<li>Give it a bad data structure.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Create a unit test that compares the performance of the two algorithms.  You'll want to look at <code>man 3 time</code> for a basic timer function,
and run enough iterations to at least have a few seconds of samples.</li>
<li>Play with the amount of data in the lists that need to be sorted and see if that changes your timing.</li>
<li>Find a way to simulate filling different sized random lists, measuring how long they take. Then, graph the result to see how it compares to the
description of the algorithm.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Try to explain why sorting linked lists is a really bad idea.</li>
<li>Implement a <code>List_insert_sorted</code> that will take a given value, and using the <code>List_compare</code>, insert the element at the
right position so that the list is always sorted.  How does using this method compare to sorting a list after you've built it?</li>
<li>Try implementing the bottom-up merge sort described on the Wikipedia page.  The code there is already C, so it should be easy to
recreate, but try to understand how it's working compared to the slower one I have here.</li>
</ul>
<h3 id="exercise-34-dynamic-array">Exercise 34 Dynamic Array</h3>
<p>The Plan</p>
<p>Learn about dynamic arrays, a very useful datastructure.</p>
<p>Code Review</p>
<p>.\ex34\darray.h</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">ifndef _DArray_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define _DArray_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;assert.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/dbg.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> DArray {
    <span style="color:#66d9ef">int</span> end;
    <span style="color:#66d9ef">int</span> max;
    size_t element_size;
    size_t expand_rate;
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#f92672">*</span>contents;
} DArray;

DArray <span style="color:#f92672">*</span><span style="color:#a6e22e">DArray_create</span>(size_t element_size, size_t initial_max);

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">DArray_destroy</span>(DArray <span style="color:#f92672">*</span> array);

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">DArray_clear</span>(DArray <span style="color:#f92672">*</span> array);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">DArray_expand</span>(DArray <span style="color:#f92672">*</span> array);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">DArray_contract</span>(DArray <span style="color:#f92672">*</span> array);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">DArray_push</span>(DArray <span style="color:#f92672">*</span> array, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>el);

<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">DArray_pop</span>(DArray <span style="color:#f92672">*</span> array);

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">DArray_clear_destroy</span>(DArray <span style="color:#f92672">*</span> array);

<span style="color:#75715e">#</span><span style="color:#75715e">define DArray_last(A) ((A)-&gt;contents[(A)-&gt;end - 1])</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define DArray_first(A) ((A)-&gt;contents[0])</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define DArray_end(A) ((A)-&gt;end)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define DArray_count(A) DArray_end(A)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define DArray_max(A) ((A)-&gt;max)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define DEFAULT_EXPAND_RATE 300</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">DArray_set</span>(DArray <span style="color:#f92672">*</span> array, <span style="color:#66d9ef">int</span> i, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>el)
{
    check(i <span style="color:#f92672">&lt;</span> array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">darray attempt to set past max</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">&gt;</span> array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end)
        array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">=</span> i;
    array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents[i] <span style="color:#f92672">=</span> el;
error:
    <span style="color:#66d9ef">return</span>;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">DArray_get</span>(DArray <span style="color:#f92672">*</span> array, <span style="color:#66d9ef">int</span> i)
{
    check(i <span style="color:#f92672">&lt;</span> array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">darray attempt to get past max</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">return</span> array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents[i];
error:
    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">DArray_remove</span>(DArray <span style="color:#f92672">*</span> array, <span style="color:#66d9ef">int</span> i)
{
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>el <span style="color:#f92672">=</span> array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents[i];

    array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents[i] <span style="color:#f92672">=</span> NULL;

    <span style="color:#66d9ef">return</span> el;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">DArray_new</span>(DArray <span style="color:#f92672">*</span> array)
{
    check(array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>element_size <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>,
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Can&#39;t use DArray_new on 0 size darrays.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> calloc(<span style="color:#ae81ff">1</span>, array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>element_size);

error:
    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#75715e">#</span><span style="color:#75715e">define DArray_free(E) free((E))</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
</code></pre></div><p>.\ex34\darray.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/darray.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;assert.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
DArray <span style="color:#f92672">*</span><span style="color:#a6e22e">DArray_create</span>(size_t element_size, size_t initial_max)
{
    DArray <span style="color:#f92672">*</span>array <span style="color:#f92672">=</span> malloc(<span style="color:#66d9ef">sizeof</span>(DArray));
    check_mem(array);
    array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max <span style="color:#f92672">=</span> initial_max;
    check(array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">You must set an initial_max &gt; 0.</span><span style="color:#e6db74">&#34;</span>);

    array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents <span style="color:#f92672">=</span> calloc(initial_max, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>));
    check_mem(array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents);

    array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>element_size <span style="color:#f92672">=</span> element_size;
    array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>expand_rate <span style="color:#f92672">=</span> DEFAULT_EXPAND_RATE;

    <span style="color:#66d9ef">return</span> array;

error:
    <span style="color:#66d9ef">if</span> (array)
        free(array);
    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">DArray_clear</span>(DArray <span style="color:#f92672">*</span> array)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">if</span> (array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>element_size <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
            <span style="color:#66d9ef">if</span> (array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents[i] <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL) {
                free(array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents[i]);
            }
        }
    }
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">DArray_resize</span>(DArray <span style="color:#f92672">*</span> array, size_t newsize)
{
    array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max <span style="color:#f92672">=</span> newsize;
    check(array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">The newsize must be &gt; 0.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>contents <span style="color:#f92672">=</span> realloc(
            array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents, array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>));
    <span style="color:#75715e">// check contents and assume realloc doesn&#39;t harm the original on error
</span><span style="color:#75715e"></span>
    check_mem(contents);

    array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents <span style="color:#f92672">=</span> contents;

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
error:
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">DArray_expand</span>(DArray <span style="color:#f92672">*</span> array)
{
    size_t old_max <span style="color:#f92672">=</span> array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max;
    check(DArray_resize(array, array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max <span style="color:#f92672">+</span> array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>expand_rate) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to expand array to new size: %d</span><span style="color:#e6db74">&#34;</span>,
            array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max <span style="color:#f92672">+</span> (<span style="color:#66d9ef">int</span>)array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>expand_rate);

    memset(array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents <span style="color:#f92672">+</span> old_max, <span style="color:#ae81ff">0</span>, array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>expand_rate <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">DArray_contract</span>(DArray <span style="color:#f92672">*</span> array)
{
    <span style="color:#66d9ef">int</span> new_size <span style="color:#f92672">=</span> array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">&lt;</span> (<span style="color:#66d9ef">int</span>)array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>expand_rate <span style="color:#f92672">?</span> 
            (<span style="color:#66d9ef">int</span>)array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>expand_rate : array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end;

    <span style="color:#66d9ef">return</span> DArray_resize(array, new_size <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">DArray_destroy</span>(DArray <span style="color:#f92672">*</span> array)
{
    <span style="color:#66d9ef">if</span> (array) {
        <span style="color:#66d9ef">if</span> (array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents)
            free(array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents);
        free(array);
    }
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">DArray_clear_destroy</span>(DArray <span style="color:#f92672">*</span> array)
{
    DArray_clear(array);
    DArray_destroy(array);
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">DArray_push</span>(DArray <span style="color:#f92672">*</span> array, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>el)
{
    array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents[array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end] <span style="color:#f92672">=</span> el;
    array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;

    <span style="color:#66d9ef">if</span> (DArray_end(array) <span style="color:#f92672">&gt;</span><span style="color:#f92672">=</span> DArray_max(array)) {
        <span style="color:#66d9ef">return</span> DArray_expand(array);
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
    }
}

<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">DArray_pop</span>(DArray <span style="color:#f92672">*</span> array)
{
    check(array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&gt;</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Attempt to pop from empty array.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>el <span style="color:#f92672">=</span> DArray_remove(array, array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>);
    array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end<span style="color:#f92672">-</span><span style="color:#f92672">-</span>;

    <span style="color:#66d9ef">if</span> (DArray_end(array) <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">int</span>)array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>expand_rate
            <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> DArray_end(array) <span style="color:#f92672">%</span> array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>expand_rate) {
        DArray_contract(array);
    }

    <span style="color:#66d9ef">return</span> el;
error:
    <span style="color:#66d9ef">return</span> NULL;
}

</code></pre></div><p>.\ex34\darray_tests.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;minunit.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/darray.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">static</span> DArray <span style="color:#f92672">*</span>array <span style="color:#f92672">=</span> NULL;
<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>val1 <span style="color:#f92672">=</span> NULL;
<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>val2 <span style="color:#f92672">=</span> NULL;

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_create</span>()
{
    array <span style="color:#f92672">=</span> DArray_create(<span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>), <span style="color:#ae81ff">100</span>);
    mu_assert(array <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DArray_create failed.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">contents are wrong in darray</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">end isn&#39;t at the right spot</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>element_size <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>),
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">element size is wrong.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">wrong max length on initial size</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_destroy</span>()
{
    DArray_destroy(array);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_new</span>()
{
    val1 <span style="color:#f92672">=</span> DArray_new(array);
    mu_assert(val1 <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">failed to make a new element</span><span style="color:#e6db74">&#34;</span>);

    val2 <span style="color:#f92672">=</span> DArray_new(array);
    mu_assert(val2 <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">failed to make a new element</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_set</span>()
{
    DArray_set(array, <span style="color:#ae81ff">0</span>, val1);
    DArray_set(array, <span style="color:#ae81ff">1</span>, val2);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_get</span>()
{
    mu_assert(DArray_get(array, <span style="color:#ae81ff">0</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> val1, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong first value.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(DArray_get(array, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> val2, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong second value.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_remove</span>()
{
    <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>val_check <span style="color:#f92672">=</span> DArray_remove(array, <span style="color:#ae81ff">0</span>);
    mu_assert(val_check <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should not get NULL.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(<span style="color:#f92672">*</span>val_check <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">*</span>val1, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should get the first value.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(DArray_get(array, <span style="color:#ae81ff">0</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should be gone.</span><span style="color:#e6db74">&#34;</span>);
    DArray_free(val_check);

    val_check <span style="color:#f92672">=</span> DArray_remove(array, <span style="color:#ae81ff">1</span>);
    mu_assert(val_check <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should not get NULL.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(<span style="color:#f92672">*</span>val_check <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">*</span>val2, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should get the first value.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(DArray_get(array, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should be gone.</span><span style="color:#e6db74">&#34;</span>);
    DArray_free(val_check);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_expand_contract</span>()
{
    <span style="color:#66d9ef">int</span> old_max <span style="color:#f92672">=</span> array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max;
    DArray_expand(array);
    mu_assert((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max <span style="color:#f92672">=</span><span style="color:#f92672">=</span> old_max <span style="color:#f92672">+</span> array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>expand_rate,
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong size after expand.</span><span style="color:#e6db74">&#34;</span>);

    DArray_contract(array);
    mu_assert((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max <span style="color:#f92672">=</span><span style="color:#f92672">=</span> array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>expand_rate <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>,
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should stay at the expand_rate at least.</span><span style="color:#e6db74">&#34;</span>);

    DArray_contract(array);
    mu_assert((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max <span style="color:#f92672">=</span><span style="color:#f92672">=</span> array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>expand_rate <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>,
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should stay at the expand_rate at least.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_push_pop</span>()
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1000</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>val <span style="color:#f92672">=</span> DArray_new(array);
        <span style="color:#f92672">*</span>val <span style="color:#f92672">=</span> i <span style="color:#f92672">*</span> <span style="color:#ae81ff">333</span>;
        DArray_push(array, val);
    }

    mu_assert(array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1201</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong max size.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">999</span>; i <span style="color:#f92672">&gt;</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i<span style="color:#f92672">-</span><span style="color:#f92672">-</span>) {
        <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>val <span style="color:#f92672">=</span> DArray_pop(array);
        mu_assert(val <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Shouldn&#39;t get a NULL.</span><span style="color:#e6db74">&#34;</span>);
        mu_assert(<span style="color:#f92672">*</span>val <span style="color:#f92672">=</span><span style="color:#f92672">=</span> i <span style="color:#f92672">*</span> <span style="color:#ae81ff">333</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong value.</span><span style="color:#e6db74">&#34;</span>);
        DArray_free(val);
    }

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">all_tests</span>()
{
    mu_suite_start();

    mu_run_test(test_create);
    mu_run_test(test_new);
    mu_run_test(test_set);
    mu_run_test(test_get);
    mu_run_test(test_remove);
    mu_run_test(test_expand_contract);
    mu_run_test(test_push_pop);
    mu_run_test(test_destroy);

    <span style="color:#66d9ef">return</span> NULL;
}

RUN_TESTS(all_tests);

</code></pre></div><p>Starting with the header file to implement, then the test, then the implementation.</p>
<p>The Analysis</p>
<p>DArray Advantages</p>
<ul>
<li>Iteration:  You can just use a basic for-loop and <code>DArray_count</code>
with <code>DArray_get</code>, and you're done.  No special macros needed, and
it's faster because you aren't walking through pointers.</li>
<li>Indexing:  You can use <code>DArray_get</code> and <code>DArray_set</code> to
access any element at random, but with a <code>List</code> you have to go
through N elements to get to N+1.</li>
<li>Destroying:  You can just free the struct and the <code>contents</code> in
two operations.  A <code>List</code> requires a series of <code>free</code> calls
and walking every element.</li>
</ul>
<p>DArray Advantages</p>
<ul>
<li>Cloning: You can also clone it in just two operations (plus whatever
it's storing) by copying the struct and <code>contents</code>.  A list
again requires walking through the whole thing and copying every <code>ListNode</code>
plus its value.</li>
<li>Sorting: As you saw, <code>List</code> is horrible if you need to keep the
data sorted.  A <code>DArray</code> opens up a whole class of great sorting
algorithms, because now you can access elements randomly.</li>
<li>Large Data: If you need to keep around a lot of data, then a <code>DArray</code>
wins since its base, <code>contents</code>, takes up less memory than the same
number of <code>ListNode</code> structs.</li>
</ul>
<p>DArray Disadvantages</p>
<ul>
<li>Insert and remove on the front (what I called shift).  A <code>DArray</code>
needs special treatment to be able to do this efficiently, and usually it
has to do some copying.</li>
<li>Splitting or joining:  A <code>List</code> can just copy some pointers and
it's done, but with a <code>DArray</code>, you have copy all of the
arrays involved.</li>
</ul>
<p>DArray Disadvantages</p>
<ul>
<li>Small Data. If you only need to store a few elements, then typically the
storage will be less in a <code>List</code> than a generic <code>DArray</code>. This is because
the <code>DArray</code> needs to expand the backing store to accommodate future
inserts, while a <code>List</code> only makes what it needs.</li>
</ul>
<p>Breaking It</p>
<ul>
<li>Forget to check the return value from malloc and then use the buffer.</li>
<li>Getting the end and start count of the buffer wrong.  Easy to do an off-by-one here.</li>
<li>Exploit the insert and delete costs to cause a denial of service.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Improve the unit tests to cover more of the operations, and test them
using a for-loop to ensure that they work.</li>
<li>Research what it would take to implement bubble sort and merge sort
for DArray, but don't do it yet.  I'll be implementing DArray algorithms
next, so you'll do this then.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Write some performance tests for common operations and compare them
to the same operations in <code>List</code>.  You did some of this already, but this
time, write a unit test that repeatedly does the operation in question, and
then in the main runner, do the timing.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Look at how the <code>DArray_expand</code> is implemented using a constant increase (size + 300).
Typically, dynamic arrays are implemented with a multiplicative increase (size * 2), but I've
found this to cost needless memory for no real performance gain.  Test my assertion
and see when you'd want a multiplicative increase instead of a constant increase.</li>
</ul>
<h3 id="exercise-35-sorting-and-searching">Exercise 35 Sorting and Searching</h3>
<p>The Plan</p>
<ul>
<li>Make a simple DArray sorting library using existing functions.</li>
<li>Implement a new structure and algorithm called a &ldquo;Radix Map&rdquo;.</li>
<li>Create a binary search algorithm for the RadixMap.</li>
</ul>
<p>The DArray Code</p>
<p>.\ex35\darray_algos.h</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">ifndef darray_algos_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define darray_algos_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/darray.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">int</span> (<span style="color:#f92672">*</span>DArray_compare) (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>b);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">DArray_qsort</span>(DArray <span style="color:#f92672">*</span> array, DArray_compare cmp);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">DArray_heapsort</span>(DArray <span style="color:#f92672">*</span> array, DArray_compare cmp);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">DArray_mergesort</span>(DArray <span style="color:#f92672">*</span> array, DArray_compare cmp);

<span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
</code></pre></div><p>.\ex35\darray_algos.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/darray_algos.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">DArray_qsort</span>(DArray <span style="color:#f92672">*</span> array, DArray_compare cmp)
{
    qsort(array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents, DArray_count(array), <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>), cmp);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">DArray_heapsort</span>(DArray <span style="color:#f92672">*</span> array, DArray_compare cmp)
{
    <span style="color:#66d9ef">return</span> heapsort(array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents, DArray_count(array),
            <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>), cmp);
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">DArray_mergesort</span>(DArray <span style="color:#f92672">*</span> array, DArray_compare cmp)
{
    <span style="color:#66d9ef">return</span> mergesort(array<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents, DArray_count(array),
            <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>), cmp);
}

</code></pre></div><p>.\ex35\darray_algos_tests.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;minunit.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/darray_algos.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">testcmp</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#f92672">*</span>a, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#f92672">*</span>b)
{
    <span style="color:#66d9ef">return</span> strcmp(<span style="color:#f92672">*</span>a, <span style="color:#f92672">*</span>b);
}

DArray <span style="color:#f92672">*</span><span style="color:#a6e22e">create_words</span>()
{
    DArray <span style="color:#f92672">*</span>result <span style="color:#f92672">=</span> DArray_create(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>);
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>words[] <span style="color:#f92672">=</span> { <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">asdfasfd</span><span style="color:#e6db74">&#34;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">werwar</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">13234</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">asdfasfd</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">oioj</span><span style="color:#e6db74">&#34;</span> };
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">5</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        DArray_push(result, words[i]);
    }

    <span style="color:#66d9ef">return</span> result;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">is_sorted</span>(DArray <span style="color:#f92672">*</span> array)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> DArray_count(array) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        <span style="color:#66d9ef">if</span> (strcmp(DArray_get(array, i), DArray_get(array, i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
        }
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">run_sort_test</span>(<span style="color:#66d9ef">int</span> (<span style="color:#f92672">*</span>func) (DArray <span style="color:#f92672">*</span>, DArray_compare),
        <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>name)
{
    DArray <span style="color:#f92672">*</span>words <span style="color:#f92672">=</span> create_words();
    mu_assert(<span style="color:#f92672">!</span>is_sorted(words), <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Words should start not sorted.</span><span style="color:#e6db74">&#34;</span>);

    debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">--- Testing %s sorting algorithm</span><span style="color:#e6db74">&#34;</span>, name);
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> func(words, (DArray_compare) testcmp);
    mu_assert(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">sort failed</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(is_sorted(words), <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">didn&#39;t sort it</span><span style="color:#e6db74">&#34;</span>);

    DArray_destroy(words);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_qsort</span>()
{
    <span style="color:#66d9ef">return</span> run_sort_test(DArray_qsort, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">qsort</span><span style="color:#e6db74">&#34;</span>);
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_heapsort</span>()
{
    <span style="color:#66d9ef">return</span> run_sort_test(DArray_heapsort, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">heapsort</span><span style="color:#e6db74">&#34;</span>);
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_mergesort</span>()
{
    <span style="color:#66d9ef">return</span> run_sort_test(DArray_mergesort, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">mergesort</span><span style="color:#e6db74">&#34;</span>);
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">all_tests</span>()
{
    mu_suite_start();

    mu_run_test(test_qsort);
    mu_run_test(test_heapsort);
    mu_run_test(test_mergesort);

    <span style="color:#66d9ef">return</span> NULL;
}

RUN_TESTS(all_tests);

</code></pre></div><p>Continuing the code review method with a part of DArray.</p>
<p>The RadixMap Code</p>
<p>.\ex35\radixmap.h</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">ifndef _radixmap_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdint.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">union</span> RMElement {
    uint64_t raw;
    <span style="color:#66d9ef">struct</span> {
        uint32_t key;
        uint32_t value;
    } data;
} RMElement;

<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> RadixMap {
    size_t max;
    size_t end;
    uint32_t counter;
    RMElement <span style="color:#f92672">*</span>contents;
    RMElement <span style="color:#f92672">*</span>temp;
} RadixMap;

RadixMap <span style="color:#f92672">*</span><span style="color:#a6e22e">RadixMap_create</span>(size_t max);

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">RadixMap_destroy</span>(RadixMap <span style="color:#f92672">*</span> map);

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">RadixMap_sort</span>(RadixMap <span style="color:#f92672">*</span> map);

RMElement <span style="color:#f92672">*</span><span style="color:#a6e22e">RadixMap_find</span>(RadixMap <span style="color:#f92672">*</span> map, uint32_t key);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">RadixMap_add</span>(RadixMap <span style="color:#f92672">*</span> map, uint32_t key, uint32_t value);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">RadixMap_delete</span>(RadixMap <span style="color:#f92672">*</span> map, RMElement <span style="color:#f92672">*</span> el);

<span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
</code></pre></div><p>.\ex35\radixmap.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">/*
</span><span style="color:#75715e"> * Based on code by Andre Reinald then heavily modified by Zed A. Shaw.
</span><span style="color:#75715e"> */</span>

<span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;assert.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/radixmap.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/dbg.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
RadixMap <span style="color:#f92672">*</span><span style="color:#a6e22e">RadixMap_create</span>(size_t max)
{
    RadixMap <span style="color:#f92672">*</span>map <span style="color:#f92672">=</span> calloc(<span style="color:#66d9ef">sizeof</span>(RadixMap), <span style="color:#ae81ff">1</span>);
    check_mem(map);

    map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents <span style="color:#f92672">=</span> calloc(<span style="color:#66d9ef">sizeof</span>(RMElement), max <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
    check_mem(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents);

    map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>temp <span style="color:#f92672">=</span> calloc(<span style="color:#66d9ef">sizeof</span>(RMElement), max <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
    check_mem(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>temp);

    map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max <span style="color:#f92672">=</span> max;
    map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">return</span> map;
error:
    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">RadixMap_destroy</span>(RadixMap <span style="color:#f92672">*</span> map)
{
    <span style="color:#66d9ef">if</span> (map) {
        free(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents);
        free(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>temp);
        free(map);
    }
}

<span style="color:#75715e">#</span><span style="color:#75715e">define ByteOf(x,y) (((uint8_t *)x)[(y)])</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">radix_sort</span>(<span style="color:#66d9ef">short</span> offset, uint64_t max,
        uint64_t <span style="color:#f92672">*</span> source, uint64_t <span style="color:#f92672">*</span> dest)
{
    uint64_t count[<span style="color:#ae81ff">256</span>] <span style="color:#f92672">=</span> { <span style="color:#ae81ff">0</span> };
    uint64_t <span style="color:#f92672">*</span>cp <span style="color:#f92672">=</span> NULL;
    uint64_t <span style="color:#f92672">*</span>sp <span style="color:#f92672">=</span> NULL;
    uint64_t <span style="color:#f92672">*</span>end <span style="color:#f92672">=</span> NULL;
    uint64_t s <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    uint64_t c <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#75715e">// count occurences of every byte value
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (sp <span style="color:#f92672">=</span> source, end <span style="color:#f92672">=</span> source <span style="color:#f92672">+</span> max; sp <span style="color:#f92672">&lt;</span> end; sp<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        count[ByteOf(sp, offset)]<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
    }

    <span style="color:#75715e">// transform count into index by summing
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// elements and storing into same array
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (s <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, cp <span style="color:#f92672">=</span> count, end <span style="color:#f92672">=</span> count <span style="color:#f92672">+</span> <span style="color:#ae81ff">256</span>; cp <span style="color:#f92672">&lt;</span> end; cp<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        c <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>cp;
        <span style="color:#f92672">*</span>cp <span style="color:#f92672">=</span> s;
        s <span style="color:#f92672">+</span><span style="color:#f92672">=</span> c;
    }

    <span style="color:#75715e">// fill dest with the right values in the right place
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (sp <span style="color:#f92672">=</span> source, end <span style="color:#f92672">=</span> source <span style="color:#f92672">+</span> max; sp <span style="color:#f92672">&lt;</span> end; sp<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        cp <span style="color:#f92672">=</span> count <span style="color:#f92672">+</span> ByteOf(sp, offset);
        dest[<span style="color:#f92672">*</span>cp] <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>sp;
        <span style="color:#f92672">+</span><span style="color:#f92672">+</span>(<span style="color:#f92672">*</span>cp);
    }
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">RadixMap_sort</span>(RadixMap <span style="color:#f92672">*</span> map)
{
    uint64_t <span style="color:#f92672">*</span>source <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents[<span style="color:#ae81ff">0</span>].raw;
    uint64_t <span style="color:#f92672">*</span>temp <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>temp[<span style="color:#ae81ff">0</span>].raw;

    radix_sort(<span style="color:#ae81ff">0</span>, map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end, source, temp);
    radix_sort(<span style="color:#ae81ff">1</span>, map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end, temp, source);
    radix_sort(<span style="color:#ae81ff">2</span>, map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end, source, temp);
    radix_sort(<span style="color:#ae81ff">3</span>, map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end, temp, source);
}

RMElement <span style="color:#f92672">*</span><span style="color:#a6e22e">RadixMap_find</span>(RadixMap <span style="color:#f92672">*</span> map, uint32_t to_find)
{
    <span style="color:#66d9ef">int</span> low <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> high <span style="color:#f92672">=</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
    RMElement <span style="color:#f92672">*</span>data <span style="color:#f92672">=</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents;

    <span style="color:#66d9ef">while</span> (low <span style="color:#f92672">&lt;</span><span style="color:#f92672">=</span> high) {
        <span style="color:#66d9ef">int</span> middle <span style="color:#f92672">=</span> low <span style="color:#f92672">+</span> (high <span style="color:#f92672">-</span> low) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>;
        uint32_t key <span style="color:#f92672">=</span> data[middle].data.key;

        <span style="color:#66d9ef">if</span> (to_find <span style="color:#f92672">&lt;</span> key) {
            high <span style="color:#f92672">=</span> middle <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (to_find <span style="color:#f92672">&gt;</span> key) {
            low <span style="color:#f92672">=</span> middle <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
        } <span style="color:#66d9ef">else</span> {
            <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span>data[middle];
        }
    }

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">RadixMap_add</span>(RadixMap <span style="color:#f92672">*</span> map, uint32_t key, uint32_t value)
{
    check(key <span style="color:#f92672">&lt;</span> UINT32_MAX, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Key can&#39;t be equal to UINT32_MAX.</span><span style="color:#e6db74">&#34;</span>);

    RMElement element <span style="color:#f92672">=</span> {.data <span style="color:#f92672">=</span> {.key <span style="color:#f92672">=</span> key,.value <span style="color:#f92672">=</span> value} };
    check(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">RadixMap is full.</span><span style="color:#e6db74">&#34;</span>);

    map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents[map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end<span style="color:#f92672">+</span><span style="color:#f92672">+</span>] <span style="color:#f92672">=</span> element;

    RadixMap_sort(map);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">RadixMap_delete</span>(RadixMap <span style="color:#f92672">*</span> map, RMElement <span style="color:#f92672">*</span> el)
{
    check(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">There is nothing to delete.</span><span style="color:#e6db74">&#34;</span>);
    check(el <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Can&#39;t delete a NULL element.</span><span style="color:#e6db74">&#34;</span>);

    el<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data.key <span style="color:#f92672">=</span> UINT32_MAX;

    <span style="color:#66d9ef">if</span> (map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>) {
        <span style="color:#75715e">// don&#39;t bother resorting a map of 1 length
</span><span style="color:#75715e"></span>        RadixMap_sort(map);
    }

    map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end<span style="color:#f92672">-</span><span style="color:#f92672">-</span>;

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
error:
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

</code></pre></div><p>.\ex35\radixmap_tests.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;minunit.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/radixmap.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;time.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">make_random</span>(RadixMap <span style="color:#f92672">*</span> map)
{
    size_t i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        uint32_t key <span style="color:#f92672">=</span> (uint32_t) (rand() <span style="color:#f92672">|</span> (rand() <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span>));
        check(RadixMap_add(map, key, i) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to add key %u.</span><span style="color:#e6db74">&#34;</span>,
                key);
    }

    <span style="color:#66d9ef">return</span> i;

error:
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">check_order</span>(RadixMap <span style="color:#f92672">*</span> map)
{
    RMElement d1, d2;
    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#75715e">// only signal errors if any (should not be)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> i <span style="color:#f92672">&lt;</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        d1 <span style="color:#f92672">=</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents[i];
        d2 <span style="color:#f92672">=</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>];

        <span style="color:#66d9ef">if</span> (d1.data.key <span style="color:#f92672">&gt;</span> d2.data.key) {
            debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">FAIL:i=%u, key: %u, value: %u, equals max? %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, i,
                    d1.data.key, d1.data.value,
                    d2.data.key <span style="color:#f92672">=</span><span style="color:#f92672">=</span> UINT32_MAX);
            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
        }
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">test_search</span>(RadixMap <span style="color:#f92672">*</span> map)
{
    <span style="color:#66d9ef">unsigned</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    RMElement <span style="color:#f92672">*</span>d <span style="color:#f92672">=</span> NULL;
    RMElement <span style="color:#f92672">*</span>found <span style="color:#f92672">=</span> NULL;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>; i <span style="color:#f92672">&lt;</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        d <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents[i];
        found <span style="color:#f92672">=</span> RadixMap_find(map, d<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data.key);
        check(found <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Didn&#39;t find %u at %u.</span><span style="color:#e6db74">&#34;</span>, d<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data.key, i);
        check(found<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data.key <span style="color:#f92672">=</span><span style="color:#f92672">=</span> d<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data.key,
                <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Got the wrong result: %p:%u looking for %u at %u</span><span style="color:#e6db74">&#34;</span>, found,
                found<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data.key, d<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data.key, i);
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
error:
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#75715e">// test for big number of elements
</span><span style="color:#75715e"></span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_operations</span>()
{
    size_t N <span style="color:#f92672">=</span> <span style="color:#ae81ff">200</span>;

    RadixMap <span style="color:#f92672">*</span>map <span style="color:#f92672">=</span> RadixMap_create(N);
    mu_assert(map <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to make the map.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(make_random(map), <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Didn&#39;t make a random fake radix map.</span><span style="color:#e6db74">&#34;</span>);

    RadixMap_sort(map);
    mu_assert(check_order(map),
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to properly sort the RadixMap.</span><span style="color:#e6db74">&#34;</span>);

    mu_assert(test_search(map), <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed the search test.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(check_order(map),
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">RadixMap didn&#39;t stay sorted after search.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">while</span> (map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
        RMElement <span style="color:#f92672">*</span>el <span style="color:#f92672">=</span> RadixMap_find(map,
                map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>contents[map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>].data.key);
        mu_assert(el <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should get a result.</span><span style="color:#e6db74">&#34;</span>);

        size_t old_end <span style="color:#f92672">=</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end;

        mu_assert(RadixMap_delete(map, el) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Didn&#39;t delete it.</span><span style="color:#e6db74">&#34;</span>);
        mu_assert(old_end <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong size after delete.</span><span style="color:#e6db74">&#34;</span>);

        <span style="color:#75715e">// test that the end is now the old value,
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// but uint32 max so it trails off
</span><span style="color:#75715e"></span>        mu_assert(check_order(map),
                <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">RadixMap didn&#39;t stay sorted after delete.</span><span style="color:#e6db74">&#34;</span>);
    }

    RadixMap_destroy(map);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">all_tests</span>()
{
    mu_suite_start();
    srand(time(NULL));

    mu_run_test(test_operations);

    <span style="color:#66d9ef">return</span> NULL;
}

RUN_TESTS(all_tests);

</code></pre></div><p>Code review this code next.</p>
<p>The Binary Search Code</p>
<p>Finally, code review of the BSTree code.</p>
<p>Improving It</p>
<ul>
<li>Use a binary search to find the minimum position for the
new element, then only sort from there to the end.  You find the
minimum, put the new element on the end, and then just sort from
the minimum on.   This will cut your sort space down
considerably most of the time.</li>
<li>Keep track of the biggest key currently being used, and then only
sort enough digits to handle that key.  You can also keep track
of the smallest number, and then only sort the digits necessary
for the range.  To do this, you'll have to start caring about
CPU integer ordering (endianness).</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Implement quicksort, heapsort, and merge sort and then provide a <em>#define</em>
that lets you pick between the two, or create a second set of functions
you can call.  Use the technique I taught you to read the Wikipedia page
for the algorithm, and then implement it with the psuedo-code.</li>
<li>Compare the performance of your optimizations to the original implementations.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Use these sorting functions to create a <em>DArray_sort_add</em> that
adds elements to the <em>DArray</em> but sorts the array after.</li>
<li>Write a <em>DArray_find</em> that uses the binary search algorithm from
<em>RadixMap_find</em> and the <em>DArray_compare</em> to find elements
in a sorted <em>DArray</em>.</li>
</ul>
<h3 id="exercise-36-safer-strings">Exercise 36 Safer Strings</h3>
<p>.\ex36\ex36.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">copy</span>(<span style="color:#66d9ef">char</span> to[], <span style="color:#66d9ef">char</span> from[])
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#75715e">// while loop will not end if from isn&#39;t &#39;\0&#39; terminated
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span> ((to[i] <span style="color:#f92672">=</span> from[i]) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>) {
        <span style="color:#f92672">+</span><span style="color:#f92672">+</span>i;
    }
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">safercopy</span>(<span style="color:#66d9ef">int</span> from_len, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>from, <span style="color:#66d9ef">int</span> to_len, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>to)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> max <span style="color:#f92672">=</span> from_len <span style="color:#f92672">&gt;</span> to_len <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">?</span> to_len <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> from_len;

    <span style="color:#75715e">// to_len must have at least 1 byte
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (from_len <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span><span style="color:#f92672">|</span> to_len <span style="color:#f92672">&lt;</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
        <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> max; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        to[i] <span style="color:#f92672">=</span> from[i];
    }

    to[to_len <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>;

    <span style="color:#66d9ef">return</span> i;
}

</code></pre></div><p>.\ex36\ex36.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">copy</span>(<span style="color:#66d9ef">char</span> to[], <span style="color:#66d9ef">char</span> from[])
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#75715e">// while loop will not end if from isn&#39;t &#39;\0&#39; terminated
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span> ((to[i] <span style="color:#f92672">=</span> from[i]) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>) {
        <span style="color:#f92672">+</span><span style="color:#f92672">+</span>i;
    }
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">safercopy</span>(<span style="color:#66d9ef">int</span> from_len, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>from, <span style="color:#66d9ef">int</span> to_len, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>to)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> max <span style="color:#f92672">=</span> from_len <span style="color:#f92672">&gt;</span> to_len <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">?</span> to_len <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> from_len;

    <span style="color:#75715e">// to_len must have at least 1 byte
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (from_len <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span><span style="color:#f92672">|</span> to_len <span style="color:#f92672">&lt;</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
        <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> max; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        to[i] <span style="color:#f92672">=</span> from[i];
    }

    to[to_len <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">\0</span><span style="color:#e6db74">&#39;</span>;

    <span style="color:#66d9ef">return</span> i;
}

</code></pre></div><p>The Plan</p>
<p>Learn about an alternative string implementation to avoid most C string problems.</p>
<p>C Strings Suck</p>
<p>It is impossible to safely process strings in C.</p>
<p>The bstrling Library</p>
<p>An alternative is a library that provides alternative APIs for working with
C strings.</p>
<p>The Common Functions</p>
<pre><code>bfromcstr    Create a bstring from a C style constant.
blk2bstr     Do the same thing, but give the length of the buffer.
bstrcpy      Copy a bstring.
bassign      Set one bstring to another.
bassigncstr  Set a bstring to a C string's contents.
bassignblk   Set a bstring to a C string but give the length.
bdestroy     Destroy a bstring.
bconcat      Concatenate one bstring onto another.
bstricmp     Compare two bstrings returning the same result as strcmp.
biseq        Tests if two bstrings are equal.
</code></pre>
<p>The Common Functions</p>
<pre><code>binstr       Tells if one bstring is in another.
bfindreplace Find one bstring in another, then replace it with a third.
bsplit       Split a bstring into a bstrList.
bformat      Do a format string, which is super handy.
blength      Get the length of a bstring.
bdata        Get the data from a bstring.
bchar        Get a char from a bstring.
</code></pre>
<p>Extra Credit</p>
<p>There is only one extra credit and that's to write a <em>tests/bstr_tests.c</em> file that
tests all of these functions.  The bstrlib comes with a test that you can reference it if needed.</p>
<h3 id="exercise-37-hashmaps">Exercise 37 Hashmaps</h3>
<p>The Plan</p>
<p>Implement a Hashmap in C.
In Python these are called Dictionaries.</p>
<p>Hashmaps Visually</p>
<p>Hashmaps are very intuitive once you know how a DArray works.
It's all about the hashing function used.</p>
<p>Code Review</p>
<p>.\ex37\hashmap.h</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">ifndef _lcthw_Hashmap_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define _lcthw_Hashmap_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdint.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/darray.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">define DEFAULT_NUMBER_OF_BUCKETS 100</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">int</span> (<span style="color:#f92672">*</span>Hashmap_compare) (<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>b);
<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">uint32_t</span>(<span style="color:#f92672">*</span>Hashmap_hash) (<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key);

<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> Hashmap {
    DArray <span style="color:#f92672">*</span>buckets;
    Hashmap_compare compare;
    Hashmap_hash hash;
} Hashmap;

<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> HashmapNode {
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key;
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data;
    uint32_t hash;
} HashmapNode;

<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">int</span> (<span style="color:#f92672">*</span>Hashmap_traverse_cb) (HashmapNode <span style="color:#f92672">*</span> node);

Hashmap <span style="color:#f92672">*</span><span style="color:#a6e22e">Hashmap_create</span>(Hashmap_compare compare, Hashmap_hash);
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Hashmap_destroy</span>(Hashmap <span style="color:#f92672">*</span> map);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Hashmap_set</span>(Hashmap <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data);
<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Hashmap_get</span>(Hashmap <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Hashmap_traverse</span>(Hashmap <span style="color:#f92672">*</span> map, Hashmap_traverse_cb traverse_cb);

<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Hashmap_delete</span>(Hashmap <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key);

<span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
</code></pre></div><p>.\ex37\hashmap.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">undef NDEBUG</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdint.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/hashmap.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/dbg.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/bstrlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">default_compare</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>b)
{
    <span style="color:#66d9ef">return</span> bstrcmp((bstring) a, (bstring) b);
}

<span style="color:#75715e">/** 
</span><span style="color:#75715e"> * Simple Bob Jenkins&#39;s hash algorithm taken from the
</span><span style="color:#75715e"> * wikipedia description.
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">static</span> uint32_t <span style="color:#a6e22e">default_hash</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>a)
{
    size_t len <span style="color:#f92672">=</span> blength((bstring) a);
    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>key <span style="color:#f92672">=</span> bdata((bstring) a);
    uint32_t hash <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    uint32_t i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">for</span> (hash <span style="color:#f92672">=</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> len; <span style="color:#f92672">+</span><span style="color:#f92672">+</span>i) {
        hash <span style="color:#f92672">+</span><span style="color:#f92672">=</span> key[i];
        hash <span style="color:#f92672">+</span><span style="color:#f92672">=</span> (hash <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span>);
        hash <span style="color:#f92672">^</span><span style="color:#f92672">=</span> (hash <span style="color:#f92672">&gt;</span><span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">6</span>);
    }

    hash <span style="color:#f92672">+</span><span style="color:#f92672">=</span> (hash <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">3</span>);
    hash <span style="color:#f92672">^</span><span style="color:#f92672">=</span> (hash <span style="color:#f92672">&gt;</span><span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">11</span>);
    hash <span style="color:#f92672">+</span><span style="color:#f92672">=</span> (hash <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">15</span>);

    <span style="color:#66d9ef">return</span> hash;
}

Hashmap <span style="color:#f92672">*</span><span style="color:#a6e22e">Hashmap_create</span>(Hashmap_compare compare, Hashmap_hash hash)
{
    Hashmap <span style="color:#f92672">*</span>map <span style="color:#f92672">=</span> calloc(<span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">sizeof</span>(Hashmap));
    check_mem(map);

    map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>compare <span style="color:#f92672">=</span> compare <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL <span style="color:#f92672">?</span> default_compare : compare;
    map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>hash <span style="color:#f92672">=</span> hash <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL <span style="color:#f92672">?</span> default_hash : hash;
    map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>buckets <span style="color:#f92672">=</span> DArray_create(
            <span style="color:#66d9ef">sizeof</span>(DArray <span style="color:#f92672">*</span>), DEFAULT_NUMBER_OF_BUCKETS);
    map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>buckets<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>end <span style="color:#f92672">=</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>buckets<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>max;    <span style="color:#75715e">// fake out expanding it
</span><span style="color:#75715e"></span>    check_mem(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>buckets);

    <span style="color:#66d9ef">return</span> map;

error:
    <span style="color:#66d9ef">if</span> (map) {
        Hashmap_destroy(map);
    }

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Hashmap_destroy</span>(Hashmap <span style="color:#f92672">*</span> map)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">if</span> (map) {
        <span style="color:#66d9ef">if</span> (map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>buckets) {
            <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> DArray_count(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>buckets); i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
                DArray <span style="color:#f92672">*</span>bucket <span style="color:#f92672">=</span> DArray_get(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>buckets, i);
                <span style="color:#66d9ef">if</span> (bucket) {
                    <span style="color:#66d9ef">for</span> (j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> DArray_count(bucket); j<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
                        free(DArray_get(bucket, j));
                    }
                    DArray_destroy(bucket);
                }
            }
            DArray_destroy(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>buckets);
        }

        free(map);
    }
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> HashmapNode <span style="color:#f92672">*</span><span style="color:#a6e22e">Hashmap_node_create</span>(<span style="color:#66d9ef">int</span> hash, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key,
        <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data)
{
    HashmapNode <span style="color:#f92672">*</span>node <span style="color:#f92672">=</span> calloc(<span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">sizeof</span>(HashmapNode));
    check_mem(node);

    node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key <span style="color:#f92672">=</span> key;
    node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data <span style="color:#f92672">=</span> data;
    node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>hash <span style="color:#f92672">=</span> hash;

    <span style="color:#66d9ef">return</span> node;

error:
    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> DArray <span style="color:#f92672">*</span><span style="color:#a6e22e">Hashmap_find_bucket</span>(Hashmap <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key,
        <span style="color:#66d9ef">int</span> create,
        uint32_t <span style="color:#f92672">*</span> hash_out)
{
    uint32_t hash <span style="color:#f92672">=</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>hash(key);
    <span style="color:#66d9ef">int</span> bucket_n <span style="color:#f92672">=</span> hash <span style="color:#f92672">%</span> DEFAULT_NUMBER_OF_BUCKETS;
    check(bucket_n <span style="color:#f92672">&gt;</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Invalid bucket found: %d</span><span style="color:#e6db74">&#34;</span>, bucket_n);
    <span style="color:#75715e">// store it for the return so the caller can use it
</span><span style="color:#75715e"></span>    <span style="color:#f92672">*</span>hash_out <span style="color:#f92672">=</span> hash;

    DArray <span style="color:#f92672">*</span>bucket <span style="color:#f92672">=</span> DArray_get(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>buckets, bucket_n);

    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>bucket <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> create) {
        <span style="color:#75715e">// new bucket, set it up
</span><span style="color:#75715e"></span>        bucket <span style="color:#f92672">=</span> DArray_create(
                <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>), DEFAULT_NUMBER_OF_BUCKETS);
        check_mem(bucket);
        DArray_set(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>buckets, bucket_n, bucket);
    }

    <span style="color:#66d9ef">return</span> bucket;

error:
    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Hashmap_set</span>(Hashmap <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data)
{
    uint32_t hash <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    DArray <span style="color:#f92672">*</span>bucket <span style="color:#f92672">=</span> Hashmap_find_bucket(map, key, <span style="color:#ae81ff">1</span>, <span style="color:#f92672">&amp;</span>hash);
    check(bucket, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Error can&#39;t create bucket.</span><span style="color:#e6db74">&#34;</span>);

    HashmapNode <span style="color:#f92672">*</span>node <span style="color:#f92672">=</span> Hashmap_node_create(hash, key, data);
    check_mem(node);

    DArray_push(bucket, node);

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;

error:
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Hashmap_get_node</span>(Hashmap <span style="color:#f92672">*</span> map, uint32_t hash,
        DArray <span style="color:#f92672">*</span> bucket, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> DArray_end(bucket); i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">TRY: %d</span><span style="color:#e6db74">&#34;</span>, i);
        HashmapNode <span style="color:#f92672">*</span>node <span style="color:#f92672">=</span> DArray_get(bucket, i);
        <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>hash <span style="color:#f92672">=</span><span style="color:#f92672">=</span> hash <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>compare(node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key, key) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
            <span style="color:#66d9ef">return</span> i;
        }
    }

    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Hashmap_get</span>(Hashmap <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key)
{
    uint32_t hash <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    DArray <span style="color:#f92672">*</span>bucket <span style="color:#f92672">=</span> Hashmap_find_bucket(map, key, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">&amp;</span>hash);
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>bucket) <span style="color:#66d9ef">return</span> NULL;

    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> Hashmap_get_node(map, hash, bucket, key);
    <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">return</span> NULL;

    HashmapNode <span style="color:#f92672">*</span>node <span style="color:#f92672">=</span> DArray_get(bucket, i);
    check(node <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL,
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to get node from bucket when it should exist.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data;

error:            <span style="color:#75715e">// fallthrough
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Hashmap_traverse</span>(Hashmap <span style="color:#f92672">*</span> map, Hashmap_traverse_cb traverse_cb)
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> DArray_count(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>buckets); i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        DArray <span style="color:#f92672">*</span>bucket <span style="color:#f92672">=</span> DArray_get(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>buckets, i);
        <span style="color:#66d9ef">if</span> (bucket) {
            <span style="color:#66d9ef">for</span> (j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> DArray_count(bucket); j<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
                HashmapNode <span style="color:#f92672">*</span>node <span style="color:#f92672">=</span> DArray_get(bucket, j);
                rc <span style="color:#f92672">=</span> traverse_cb(node);
                <span style="color:#66d9ef">if</span> (rc <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
                    <span style="color:#66d9ef">return</span> rc;
            }
        }
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Hashmap_delete</span>(Hashmap <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key)
{
    uint32_t hash <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    DArray <span style="color:#f92672">*</span>bucket <span style="color:#f92672">=</span> Hashmap_find_bucket(map, key, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">&amp;</span>hash);
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>bucket)
        <span style="color:#66d9ef">return</span> NULL;

    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> Hashmap_get_node(map, hash, bucket, key);
    <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
        <span style="color:#66d9ef">return</span> NULL;

    HashmapNode <span style="color:#f92672">*</span>node <span style="color:#f92672">=</span> DArray_get(bucket, i);
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data <span style="color:#f92672">=</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data;
    free(node);

    HashmapNode <span style="color:#f92672">*</span>ending <span style="color:#f92672">=</span> DArray_pop(bucket);

    <span style="color:#66d9ef">if</span> (ending <span style="color:#f92672">!</span><span style="color:#f92672">=</span> node) {
        <span style="color:#75715e">// alright looks like it&#39;s not the last one, swap it
</span><span style="color:#75715e"></span>        DArray_set(bucket, i, ending);
    }

    <span style="color:#66d9ef">return</span> data;
}

</code></pre></div><p>Conducting a review of Hashmap by following the test.</p>
<p>Improving It</p>
<ul>
<li>You can use a sort on each bucket so that they're always sorted.
This increases your insert time but decreases your find time, because
you can then use a binary search to find each node.  Right now,
it's looping through all of the nodes in a bucket just to find one.</li>
<li>You can dynamically size the number of buckets, or let the caller
specify the number for each <em>Hashmap</em> created.</li>
<li>You can use a better <em>default_hash</em>.  There are tons of them.</li>
</ul>
<p>Improving It</p>
<ul>
<li>This (and nearly every <em>Hashmap</em>) is vulnerable to someone picking
keys that will fill only one bucket, and then tricking your program
into processing them.  This then makes your program run slower because
it changes from processing a <em>Hashmap</em> to effectively processing
a single <em>DArray</em>.  If you sort the nodes in the bucket, this
helps, but you can also use better hashing functions, and for
the really paranoid programmer, add a random salt so that keys can't be predicted.</li>
</ul>
<p>Improving It</p>
<ul>
<li>You could have it delete buckets that are empty of nodes to save space,
or put empty buckets into a cache so you can save on time lost creating and destroying
them.</li>
<li>Right now, it just adds elements even if they already exist.  Write an
alternative set method that only adds an element if it isn't set already.</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Research the <em>Hashmap</em> implementation in your favorite programming language to see what features it has.</li>
<li>Find out what the major disadvantages of a <em>Hashmap</em> are and how to avoid them.  For example, it doesn't preserve order without special changes, nor does it work when you need to find things based on parts
of keys.</li>
<li>Write a unit test that demonstrates the defect of filling a <em>Hashmap</em> with keys that land
in the same bucket, then test how this impacts performance.  A good way to do this is to just reduce
the number of buckets to something stupid, like five.</li>
</ul>
<h3 id="exercise-38-hashmap-algorithms">Exercise 38 Hashmap Algorithms</h3>
<p>The Plan</p>
<p>Learn three different string hashing algorithms and make them dynamically available
to the Hashmap.</p>
<p>Code Review</p>
<p>.\ex38\hashmap_algos.h</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">ifndef hashmap_algos_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define hashmap_algos_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdint.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
uint32_t <span style="color:#a6e22e">Hashmap_fnv1a_hash</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data);

uint32_t <span style="color:#a6e22e">Hashmap_adler32_hash</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data);

uint32_t <span style="color:#a6e22e">Hashmap_djb_hash</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data);

<span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
</code></pre></div><p>.\ex38\hashmap_algos.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/hashmap_algos.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/bstrlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// settings taken from
</span><span style="color:#75715e"></span><span style="color:#75715e">// http://www.isthe.com/chongo/tech/comp/fnv/index.html#FNV-param
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> uint32_t FNV_PRIME <span style="color:#f92672">=</span> <span style="color:#ae81ff">16777619</span>;
<span style="color:#66d9ef">const</span> uint32_t FNV_OFFSET_BASIS <span style="color:#f92672">=</span> <span style="color:#ae81ff">2166136261</span>;

uint32_t <span style="color:#a6e22e">Hashmap_fnv1a_hash</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data)
{
    bstring s <span style="color:#f92672">=</span> (bstring) data;
    uint32_t hash <span style="color:#f92672">=</span> FNV_OFFSET_BASIS;
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> blength(s); i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        hash <span style="color:#f92672">^</span><span style="color:#f92672">=</span> bchare(s, i, <span style="color:#ae81ff">0</span>);
        hash <span style="color:#f92672">*</span><span style="color:#f92672">=</span> FNV_PRIME;
    }

    <span style="color:#66d9ef">return</span> hash;
}

<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> MOD_ADLER <span style="color:#f92672">=</span> <span style="color:#ae81ff">65521</span>;

uint32_t <span style="color:#a6e22e">Hashmap_adler32_hash</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data)
{
    bstring s <span style="color:#f92672">=</span> (bstring) data;
    uint32_t a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, b <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> blength(s); i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        a <span style="color:#f92672">=</span> (a <span style="color:#f92672">+</span> bchare(s, i, <span style="color:#ae81ff">0</span>)) <span style="color:#f92672">%</span> MOD_ADLER;
        b <span style="color:#f92672">=</span> (b <span style="color:#f92672">+</span> a) <span style="color:#f92672">%</span> MOD_ADLER;
    }

    <span style="color:#66d9ef">return</span> (b <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span>) <span style="color:#f92672">|</span> a;
}

uint32_t <span style="color:#a6e22e">Hashmap_djb_hash</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data)
{
    bstring s <span style="color:#f92672">=</span> (bstring) data;
    uint32_t hash <span style="color:#f92672">=</span> <span style="color:#ae81ff">5381</span>;
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> blength(s); i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        hash <span style="color:#f92672">=</span> ((hash <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">+</span> hash) <span style="color:#f92672">+</span> bchare(s, i, <span style="color:#ae81ff">0</span>);    <span style="color:#75715e">/* hash * 33 + c */</span>
    }

    <span style="color:#66d9ef">return</span> hash;
}

</code></pre></div><p>The default is the Jenkin's hash.</p>
<p>You added the FNV1a, Adler32, and DJB hashing algorithms.</p>
<p>Review the code for FNV1a vs. DJB.</p>
<p>Breaking It</p>
<p>In this exercise you will attempt to write the worst hashing function that can
pass for a real one.  Try to make one that either looks complicated but
statistically is way off, or is a discrete change to an existing one that is a
bad change.</p>
<p>Extra Credit</p>
<ul>
<li>Take the <code>default_hash</code> out of the <code>hashmap.c</code>, make it
one of the algorithms in <code>hashmap_algos.c</code>, and then make all
of the tests work again.</li>
<li>Add the <code>default_hash</code> to the <code>hashmap_algos_tests.c</code>
test and compare its statistics to the other hash functions.</li>
<li>Find a few more hash functions and add them, too. You can never have too
many hash functions!</li>
</ul>
<h3 id="exercise-39-string-algorithms">Exercise 39 String Algorithms</h3>
<p>The Plan</p>
<p>Develop a formal code review procedure.</p>
<p>The Code</p>
<p>.\ex39\string_algos.h</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">ifndef string_algos_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define string_algos_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/bstrlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/darray.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> StringScanner {
    bstring in;
    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>haystack;
    ssize_t hlen;
    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>needle;
    ssize_t nlen;
    size_t skip_chars[UCHAR_MAX <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>];
} StringScanner;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">String_find</span>(bstring in, bstring what);

StringScanner <span style="color:#f92672">*</span><span style="color:#a6e22e">StringScanner_create</span>(bstring in);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">StringScanner_scan</span>(StringScanner <span style="color:#f92672">*</span> scan, bstring tofind);

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">StringScanner_destroy</span>(StringScanner <span style="color:#f92672">*</span> scan);

<span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
</code></pre></div><p>.\ex39\string_algos.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/string_algos.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;limits.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">String_setup_skip_chars</span>(size_t <span style="color:#f92672">*</span> skip_chars,
        <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>needle,
        ssize_t nlen)
{
    size_t i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    size_t last <span style="color:#f92672">=</span> nlen <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> UCHAR_MAX <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        skip_chars[i] <span style="color:#f92672">=</span> nlen;
    }

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> last; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        skip_chars[needle[i]] <span style="color:#f92672">=</span> last <span style="color:#f92672">-</span> i;
    }
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">String_base_search</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span>
        <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>haystack,
        ssize_t hlen,
        <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span>
        <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>needle,
        ssize_t nlen,
        size_t <span style="color:#f92672">*</span>
        skip_chars)
{
    size_t i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    size_t last <span style="color:#f92672">=</span> nlen <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;

    assert(haystack <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Given bad haystack to search.</span><span style="color:#e6db74">&#34;</span>);
    assert(needle <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Given bad needle to search for.</span><span style="color:#e6db74">&#34;</span>);

    check(nlen <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">nlen can&#39;t be &lt;= 0</span><span style="color:#e6db74">&#34;</span>);
    check(hlen <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">hlen can&#39;t be &lt;= 0</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">while</span> (hlen <span style="color:#f92672">&gt;</span><span style="color:#f92672">=</span> nlen) {
        <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> last; haystack[i] <span style="color:#f92672">=</span><span style="color:#f92672">=</span> needle[i]; i<span style="color:#f92672">-</span><span style="color:#f92672">-</span>) {
            <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
                <span style="color:#66d9ef">return</span> haystack;
            }
        }

        hlen <span style="color:#f92672">-</span><span style="color:#f92672">=</span> skip_chars[haystack[last]];
        haystack <span style="color:#f92672">+</span><span style="color:#f92672">=</span> skip_chars[haystack[last]];
    }

error:            <span style="color:#75715e">// fallthrough
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">String_find</span>(bstring in, bstring what)
{
    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>found <span style="color:#f92672">=</span> NULL;

    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>haystack <span style="color:#f92672">=</span> (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)bdata(in);
    ssize_t hlen <span style="color:#f92672">=</span> blength(in);
    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>needle <span style="color:#f92672">=</span> (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)bdata(what);
    ssize_t nlen <span style="color:#f92672">=</span> blength(what);
    size_t skip_chars[UCHAR_MAX <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> { <span style="color:#ae81ff">0</span> };

    String_setup_skip_chars(skip_chars, needle, nlen);

    found <span style="color:#f92672">=</span> String_base_search(haystack, hlen,
                 needle, nlen, skip_chars);

    <span style="color:#66d9ef">return</span> found <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL <span style="color:#f92672">?</span> found <span style="color:#f92672">-</span> haystack : <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

StringScanner <span style="color:#f92672">*</span><span style="color:#a6e22e">StringScanner_create</span>(bstring in)
{
    StringScanner <span style="color:#f92672">*</span>scan <span style="color:#f92672">=</span> calloc(<span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">sizeof</span>(StringScanner));
    check_mem(scan);

    scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>in <span style="color:#f92672">=</span> in;
    scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>haystack <span style="color:#f92672">=</span> (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)bdata(in);
    scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>hlen <span style="color:#f92672">=</span> blength(in);

    assert(scan <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">fuck</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#66d9ef">return</span> scan;

error:
    free(scan);
    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">StringScanner_set_needle</span>(StringScanner <span style="color:#f92672">*</span> scan,
        bstring tofind)
{
    scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>needle <span style="color:#f92672">=</span> (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)bdata(tofind);
    scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>nlen <span style="color:#f92672">=</span> blength(tofind);

    String_setup_skip_chars(scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>skip_chars, scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>needle, scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>nlen);
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">StringScanner_reset</span>(StringScanner <span style="color:#f92672">*</span> scan)
{
    scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>haystack <span style="color:#f92672">=</span> (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)bdata(scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>in);
    scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>hlen <span style="color:#f92672">=</span> blength(scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>in);
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">StringScanner_scan</span>(StringScanner <span style="color:#f92672">*</span> scan, bstring tofind)
{
    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>found <span style="color:#f92672">=</span> NULL;
    ssize_t found_at <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">if</span> (scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>hlen <span style="color:#f92672">&lt;</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
        StringScanner_reset(scan);
        <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
    }

    <span style="color:#66d9ef">if</span> ((<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)bdata(tofind) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>needle) {
        StringScanner_set_needle(scan, tofind);
    }

    found <span style="color:#f92672">=</span> String_base_search(scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>haystack, scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>hlen,
            scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>needle, scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>nlen,
            scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>skip_chars);

    <span style="color:#66d9ef">if</span> (found) {
        found_at <span style="color:#f92672">=</span> found <span style="color:#f92672">-</span> (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)bdata(scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>in);
        scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>haystack <span style="color:#f92672">=</span> found <span style="color:#f92672">+</span> scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>nlen;
        scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>hlen <span style="color:#f92672">-</span><span style="color:#f92672">=</span> found_at <span style="color:#f92672">-</span> scan<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>nlen;
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#75715e">// done, reset the setup
</span><span style="color:#75715e"></span>        StringScanner_reset(scan);
        found_at <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
    }

    <span style="color:#66d9ef">return</span> found_at;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">StringScanner_destroy</span>(StringScanner <span style="color:#f92672">*</span> scan)
{
    <span style="color:#66d9ef">if</span> (scan) {
        free(scan);
    }
}

</code></pre></div><p>.\ex39\string_algos_tests.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;minunit.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/string_algos.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/bstrlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;time.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">struct</span> tagbstring IN_STR <span style="color:#f92672">=</span> bsStatic(
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">I have ALPHA beta ALPHA and oranges ALPHA</span><span style="color:#e6db74">&#34;</span>);
<span style="color:#66d9ef">struct</span> tagbstring ALPHA <span style="color:#f92672">=</span> bsStatic(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">ALPHA</span><span style="color:#e6db74">&#34;</span>);
<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> TEST_TIME <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_find_and_scan</span>()
{
    StringScanner <span style="color:#f92672">*</span>scan <span style="color:#f92672">=</span> StringScanner_create(<span style="color:#f92672">&amp;</span>IN_STR);
    mu_assert(scan <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to make the scanner.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">int</span> find_i <span style="color:#f92672">=</span> String_find(<span style="color:#f92672">&amp;</span>IN_STR, <span style="color:#f92672">&amp;</span>ALPHA);
    mu_assert(find_i <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to find &#39;ALPHA&#39; in test string.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">int</span> scan_i <span style="color:#f92672">=</span> StringScanner_scan(scan, <span style="color:#f92672">&amp;</span>ALPHA);
    mu_assert(scan_i <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to find &#39;ALPHA&#39; with scan.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(scan_i <span style="color:#f92672">=</span><span style="color:#f92672">=</span> find_i, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">find and scan don&#39;t match</span><span style="color:#e6db74">&#34;</span>);

    scan_i <span style="color:#f92672">=</span> StringScanner_scan(scan, <span style="color:#f92672">&amp;</span>ALPHA);
    mu_assert(scan_i <span style="color:#f92672">&gt;</span> find_i,
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">should find another ALPHA after the first</span><span style="color:#e6db74">&#34;</span>);

    scan_i <span style="color:#f92672">=</span> StringScanner_scan(scan, <span style="color:#f92672">&amp;</span>ALPHA);
    mu_assert(scan_i <span style="color:#f92672">&gt;</span> find_i,
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">should find another ALPHA after the first</span><span style="color:#e6db74">&#34;</span>);

    mu_assert(StringScanner_scan(scan, <span style="color:#f92672">&amp;</span>ALPHA) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,
            <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">shouldn&#39;t find it</span><span style="color:#e6db74">&#34;</span>);

    StringScanner_destroy(scan);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_binstr_performance</span>()
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> found_at <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> find_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    time_t elapsed <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    time_t start <span style="color:#f92672">=</span> time(NULL);

    <span style="color:#66d9ef">do</span> {
        <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1000</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
            found_at <span style="color:#f92672">=</span> binstr(<span style="color:#f92672">&amp;</span>IN_STR, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">&amp;</span>ALPHA);
            mu_assert(found_at <span style="color:#f92672">!</span><span style="color:#f92672">=</span> BSTR_ERR, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to find!</span><span style="color:#e6db74">&#34;</span>);
            find_count<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
        }

        elapsed <span style="color:#f92672">=</span> time(NULL) <span style="color:#f92672">-</span> start;
    } <span style="color:#66d9ef">while</span> (elapsed <span style="color:#f92672">&lt;</span><span style="color:#f92672">=</span> TEST_TIME);

    debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">BINSTR COUNT: %lu, END TIME: %d, OPS: %f</span><span style="color:#e6db74">&#34;</span>,
            find_count, (<span style="color:#66d9ef">int</span>)elapsed, (<span style="color:#66d9ef">double</span>)find_count <span style="color:#f92672">/</span> elapsed);
    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_find_performance</span>()
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> found_at <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> find_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    time_t elapsed <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    time_t start <span style="color:#f92672">=</span> time(NULL);

    <span style="color:#66d9ef">do</span> {
        <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1000</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
            found_at <span style="color:#f92672">=</span> String_find(<span style="color:#f92672">&amp;</span>IN_STR, <span style="color:#f92672">&amp;</span>ALPHA);
            find_count<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
        }

        elapsed <span style="color:#f92672">=</span> time(NULL) <span style="color:#f92672">-</span> start;
    } <span style="color:#66d9ef">while</span> (elapsed <span style="color:#f92672">&lt;</span><span style="color:#f92672">=</span> TEST_TIME);

    debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">FIND COUNT: %lu, END TIME: %d, OPS: %f</span><span style="color:#e6db74">&#34;</span>,
            find_count, (<span style="color:#66d9ef">int</span>)elapsed, (<span style="color:#66d9ef">double</span>)find_count <span style="color:#f92672">/</span> elapsed);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_scan_performance</span>()
{
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> found_at <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> find_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    time_t elapsed <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    StringScanner <span style="color:#f92672">*</span>scan <span style="color:#f92672">=</span> StringScanner_create(<span style="color:#f92672">&amp;</span>IN_STR);

    time_t start <span style="color:#f92672">=</span> time(NULL);

    <span style="color:#66d9ef">do</span> {
        <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1000</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
            found_at <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

            <span style="color:#66d9ef">do</span> {
                found_at <span style="color:#f92672">=</span> StringScanner_scan(scan, <span style="color:#f92672">&amp;</span>ALPHA);
                find_count<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
            } <span style="color:#66d9ef">while</span> (found_at <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
        }

        elapsed <span style="color:#f92672">=</span> time(NULL) <span style="color:#f92672">-</span> start;
    } <span style="color:#66d9ef">while</span> (elapsed <span style="color:#f92672">&lt;</span><span style="color:#f92672">=</span> TEST_TIME);

    debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">SCAN COUNT: %lu, END TIME: %d, OPS: %f</span><span style="color:#e6db74">&#34;</span>,
            find_count, (<span style="color:#66d9ef">int</span>)elapsed, (<span style="color:#66d9ef">double</span>)find_count <span style="color:#f92672">/</span> elapsed);

    StringScanner_destroy(scan);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">all_tests</span>()
{
    mu_suite_start();

    mu_run_test(test_find_and_scan);

    <span style="color:#75715e">// this is an idiom for commenting out sections of code
</span><span style="color:#75715e"></span><span style="color:#75715e">#if 0</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">    mu_run_test(test_scan_performance);
</span><span style="color:#75715e"></span><span style="color:#75715e">    mu_run_test(test_find_performance);
</span><span style="color:#75715e"></span><span style="color:#75715e">    mu_run_test(test_binstr_performance);
</span><span style="color:#75715e"></span><span style="color:#75715e">#endif
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">return</span> NULL;
}

RUN_TESTS(all_tests);

</code></pre></div><p>The code is easy to implement so should be no problem for you
at this point.  Focus on getting the unit test right.</p>
<p>Code Review Process</p>
<ol>
<li>Start at the entry point for a piece of code that has changed.</li>
<li>For each function, confirm that its calling parameters are correct.</li>
<li>Enter that function, and confirm each line's correctness.</li>
<li>When you encounter a function, repeat up to #2 until you go no further.</li>
<li>As you exit functions, confirm the return values and their usage.</li>
<li>Continue until you are back where you started at the entry point.</li>
<li>Do a diff on your changes, and confirm any missed calls to changed functions.</li>
</ol>
<p>Code Review Key Points</p>
<ol>
<li>Check your pointer dereferences and defend against NULL.</li>
<li>Check if-statements and while loops for exiting.</li>
<li>Check return values are going to be valid.</li>
<li>Check that memory allocated is freed and other resources freed.</li>
<li>Confirm all system call parameters are correct with man pages.</li>
</ol>
<p>Record Your Code Review</p>
<p>I want <em>you</em> to try to record yourself coding and reviewing your
code.  What do you learn from this experience?</p>
<p>What if you kept track of the number of mistakes you found in
your code reviews and analyzed the data?</p>
<p>Extra Credit</p>
<ul>
<li>See if you can make the <code>Scan_find</code> faster.  Why is my implementation
here slow?</li>
<li>Try some different scan times and see if you get different numbers.
What impact does the length of time that you run the test have on
the <code>scan</code> times?  What can you say about that result?</li>
<li>Alter the unit test so that it runs each function for a short burst
in the beginning to clear out any warm up period, and then start the
timing portion.  Does that change the dependence on the length of time
the test runs?  Does it change how many operations per second are possible?</li>
</ul>
<p>Extra Credit</p>
<ul>
<li>Make the unit test randomize the strings to find and then measure
the performance you get.  One way to do this is to use the <code>bsplit</code>
function from <code>bstrlib.h</code> to split the <code>IN_STR</code> on
spaces.  Then, you can use the <code>bstrList</code> struct that you get to access each
string it returns.  This will also teach you how to use <code>bstrList</code>
operations for string processing.</li>
<li>Try some runs with the tests in different orders to see if you get different
results.</li>
</ul>
<h3 id="exercise-40-binary-search-trees">Exercise 40 Binary Search Trees</h3>
<p>The Plan</p>
<p>Implement a Binary Search Tree, a competitor to the Hashmap.</p>
<p>Binary Search Trees Visually</p>
<p>The Code</p>
<p>.\ex40\bstree.h</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">ifndef _lcthw_BSTree_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define _lcthw_BSTree_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">int</span> (<span style="color:#f92672">*</span>BSTree_compare) (<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>b);

<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> BSTreeNode {
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key;
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data;

    <span style="color:#66d9ef">struct</span> BSTreeNode <span style="color:#f92672">*</span>left;
    <span style="color:#66d9ef">struct</span> BSTreeNode <span style="color:#f92672">*</span>right;
    <span style="color:#66d9ef">struct</span> BSTreeNode <span style="color:#f92672">*</span>parent;
} BSTreeNode;

<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> BSTree {
    <span style="color:#66d9ef">int</span> count;
    BSTree_compare compare;
    BSTreeNode <span style="color:#f92672">*</span>root;
} BSTree;

<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">int</span> (<span style="color:#f92672">*</span>BSTree_traverse_cb) (BSTreeNode <span style="color:#f92672">*</span> node);

BSTree <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_create</span>(BSTree_compare compare);
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">BSTree_destroy</span>(BSTree <span style="color:#f92672">*</span> map);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BSTree_set</span>(BSTree <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data);
<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_get</span>(BSTree <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BSTree_traverse</span>(BSTree <span style="color:#f92672">*</span> map, BSTree_traverse_cb traverse_cb);

<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_delete</span>(BSTree <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key);

<span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
</code></pre></div><p>.\ex40\bstree.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/dbg.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/bstree.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/bstrlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">default_compare</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>b)
{
    <span style="color:#66d9ef">return</span> bstrcmp((bstring) a, (bstring) b);
}

BSTree <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_create</span>(BSTree_compare compare)
{
    BSTree <span style="color:#f92672">*</span>map <span style="color:#f92672">=</span> calloc(<span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">sizeof</span>(BSTree));
    check_mem(map);

    map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>compare <span style="color:#f92672">=</span> compare <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL <span style="color:#f92672">?</span> default_compare : compare;

    <span style="color:#66d9ef">return</span> map;

error:
    <span style="color:#66d9ef">if</span> (map) {
        BSTree_destroy(map);
    }
    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BSTree_destroy_cb</span>(BSTreeNode <span style="color:#f92672">*</span> node)
{
    free(node);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">BSTree_destroy</span>(BSTree <span style="color:#f92672">*</span> map)
{
    <span style="color:#66d9ef">if</span> (map) {
        BSTree_traverse(map, BSTree_destroy_cb);
        free(map);
    }
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> BSTreeNode <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTreeNode_create</span>(BSTreeNode <span style="color:#f92672">*</span> parent,
        <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data)
{
    BSTreeNode <span style="color:#f92672">*</span>node <span style="color:#f92672">=</span> calloc(<span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">sizeof</span>(BSTreeNode));
    check_mem(node);

    node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key <span style="color:#f92672">=</span> key;
    node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data <span style="color:#f92672">=</span> data;
    node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>parent <span style="color:#f92672">=</span> parent;
    <span style="color:#66d9ef">return</span> node;

error:
    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">BSTree_setnode</span>(BSTree <span style="color:#f92672">*</span> map, BSTreeNode <span style="color:#f92672">*</span> node,
        <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data)
{
    <span style="color:#66d9ef">int</span> cmp <span style="color:#f92672">=</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>compare(node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key, key);

    <span style="color:#66d9ef">if</span> (cmp <span style="color:#f92672">&lt;</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left) {
            BSTree_setnode(map, node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left, key, data);
        } <span style="color:#66d9ef">else</span> {
            node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left <span style="color:#f92672">=</span> BSTreeNode_create(node, key, data);
        }
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right) {
            BSTree_setnode(map, node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right, key, data);
        } <span style="color:#66d9ef">else</span> {
            node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right <span style="color:#f92672">=</span> BSTreeNode_create(node, key, data);
        }
    }
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BSTree_set</span>(BSTree <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data)
{
    <span style="color:#66d9ef">if</span> (map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL) {
        <span style="color:#75715e">// first so just make it and get out
</span><span style="color:#75715e"></span>        map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root <span style="color:#f92672">=</span> BSTreeNode_create(NULL, key, data);
        check_mem(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root);
    } <span style="color:#66d9ef">else</span> {
        BSTree_setnode(map, map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root, key, data);
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
error:
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> BSTreeNode <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_getnode</span>(BSTree <span style="color:#f92672">*</span> map,
        BSTreeNode <span style="color:#f92672">*</span> node, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key)
{
    <span style="color:#66d9ef">int</span> cmp <span style="color:#f92672">=</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>compare(node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key, key);

    <span style="color:#66d9ef">if</span> (cmp <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">return</span> node;
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (cmp <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left) {
            <span style="color:#66d9ef">return</span> BSTree_getnode(map, node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left, key);
        } <span style="color:#66d9ef">else</span> {
            <span style="color:#66d9ef">return</span> NULL;
        }
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right) {
            <span style="color:#66d9ef">return</span> BSTree_getnode(map, node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right, key);
        } <span style="color:#66d9ef">else</span> {
            <span style="color:#66d9ef">return</span> NULL;
        }
    }
}

<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_get</span>(BSTree <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key)
{
    <span style="color:#66d9ef">if</span> (map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL) {
        <span style="color:#66d9ef">return</span> NULL;
    } <span style="color:#66d9ef">else</span> {
        BSTreeNode <span style="color:#f92672">*</span>node <span style="color:#f92672">=</span> BSTree_getnode(map, map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root, key);
        <span style="color:#66d9ef">return</span> node <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL <span style="color:#f92672">?</span> NULL <span style="color:#f92672">:</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data;
    }
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BSTree_traverse_nodes</span>(BSTreeNode <span style="color:#f92672">*</span> node,
        BSTree_traverse_cb traverse_cb)
{
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left) {
        rc <span style="color:#f92672">=</span> BSTree_traverse_nodes(node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left, traverse_cb);
        <span style="color:#66d9ef">if</span> (rc <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
            <span style="color:#66d9ef">return</span> rc;
    }

    <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right) {
        rc <span style="color:#f92672">=</span> BSTree_traverse_nodes(node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right, traverse_cb);
        <span style="color:#66d9ef">if</span> (rc <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
            <span style="color:#66d9ef">return</span> rc;
    }

    <span style="color:#66d9ef">return</span> traverse_cb(node);
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BSTree_traverse</span>(BSTree <span style="color:#f92672">*</span> map, BSTree_traverse_cb traverse_cb)
{
    <span style="color:#66d9ef">if</span> (map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root) {
        <span style="color:#66d9ef">return</span> BSTree_traverse_nodes(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root, traverse_cb);
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> BSTreeNode <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_find_min</span>(BSTreeNode <span style="color:#f92672">*</span> node)
{
    <span style="color:#66d9ef">while</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left) {
        node <span style="color:#f92672">=</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left;
    }

    <span style="color:#66d9ef">return</span> node;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">BSTree_replace_node_in_parent</span>(BSTree <span style="color:#f92672">*</span> map,
        BSTreeNode <span style="color:#f92672">*</span> node,
        BSTreeNode <span style="color:#f92672">*</span> new_value)
{
    <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>parent) {
        <span style="color:#66d9ef">if</span> (node <span style="color:#f92672">=</span><span style="color:#f92672">=</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>parent<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left) {
            node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>parent<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left <span style="color:#f92672">=</span> new_value;
        } <span style="color:#66d9ef">else</span> {
            node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>parent<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right <span style="color:#f92672">=</span> new_value;
        }
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#75715e">// this is the root so gotta change it
</span><span style="color:#75715e"></span>        map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root <span style="color:#f92672">=</span> new_value;
    }

    <span style="color:#66d9ef">if</span> (new_value) {
        new_value<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>parent <span style="color:#f92672">=</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>parent;
    }
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">BSTree_swap</span>(BSTreeNode <span style="color:#f92672">*</span> a, BSTreeNode <span style="color:#f92672">*</span> b)
{
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>temp <span style="color:#f92672">=</span> NULL;
    temp <span style="color:#f92672">=</span> b<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key;
    b<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key <span style="color:#f92672">=</span> a<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key;
    a<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key <span style="color:#f92672">=</span> temp;
    temp <span style="color:#f92672">=</span> b<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data;
    b<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data <span style="color:#f92672">=</span> a<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data;
    a<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data <span style="color:#f92672">=</span> temp;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> BSTreeNode <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_node_delete</span>(BSTree <span style="color:#f92672">*</span> map,
        BSTreeNode <span style="color:#f92672">*</span> node,
        <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key)
{
    <span style="color:#66d9ef">int</span> cmp <span style="color:#f92672">=</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>compare(node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key, key);

    <span style="color:#66d9ef">if</span> (cmp <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left) {
            <span style="color:#66d9ef">return</span> BSTree_node_delete(map, node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left, key);
        } <span style="color:#66d9ef">else</span> {
            <span style="color:#75715e">// not found
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> NULL;
        }
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (cmp <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right) {
            <span style="color:#66d9ef">return</span> BSTree_node_delete(map, node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right, key);
        } <span style="color:#66d9ef">else</span> {
            <span style="color:#75715e">// not found
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> NULL;
        }
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right) {
            <span style="color:#75715e">// swap this node for the smallest node that is bigger than us
</span><span style="color:#75715e"></span>            BSTreeNode <span style="color:#f92672">*</span>successor <span style="color:#f92672">=</span> BSTree_find_min(node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right);
            BSTree_swap(successor, node);

            <span style="color:#75715e">// this leaves the old successor with possibly a right child
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// so replace it with that right child
</span><span style="color:#75715e"></span>            BSTree_replace_node_in_parent(map, successor,
                    successor<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right);

            <span style="color:#75715e">// finally it&#39;s swapped, so return successor instead of node
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> successor;
        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left) {
            BSTree_replace_node_in_parent(map, node, node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left);
        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right) {
            BSTree_replace_node_in_parent(map, node, node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right);
        } <span style="color:#66d9ef">else</span> {
            BSTree_replace_node_in_parent(map, node, NULL);
        }

        <span style="color:#66d9ef">return</span> node;
    }
}

<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_delete</span>(BSTree <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key)
{
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data <span style="color:#f92672">=</span> NULL;

    <span style="color:#66d9ef">if</span> (map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root) {
        BSTreeNode <span style="color:#f92672">*</span>node <span style="color:#f92672">=</span> BSTree_node_delete(map, map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root, key);

        <span style="color:#66d9ef">if</span> (node) {
            data <span style="color:#f92672">=</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data;
            free(node);
        }
    }

    <span style="color:#66d9ef">return</span> data;
}

</code></pre></div><p>.\ex40\bstree_tests.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;minunit.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/bstree.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;assert.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/bstrlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;time.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
BSTree <span style="color:#f92672">*</span>map <span style="color:#f92672">=</span> NULL;
<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> traverse_called <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
<span style="color:#66d9ef">struct</span> tagbstring test1 <span style="color:#f92672">=</span> bsStatic(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">test data 1</span><span style="color:#e6db74">&#34;</span>);
<span style="color:#66d9ef">struct</span> tagbstring test2 <span style="color:#f92672">=</span> bsStatic(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">test data 2</span><span style="color:#e6db74">&#34;</span>);
<span style="color:#66d9ef">struct</span> tagbstring test3 <span style="color:#f92672">=</span> bsStatic(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">xest data 3</span><span style="color:#e6db74">&#34;</span>);
<span style="color:#66d9ef">struct</span> tagbstring expect1 <span style="color:#f92672">=</span> bsStatic(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">THE VALUE 1</span><span style="color:#e6db74">&#34;</span>);
<span style="color:#66d9ef">struct</span> tagbstring expect2 <span style="color:#f92672">=</span> bsStatic(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">THE VALUE 2</span><span style="color:#e6db74">&#34;</span>);
<span style="color:#66d9ef">struct</span> tagbstring expect3 <span style="color:#f92672">=</span> bsStatic(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">THE VALUE 3</span><span style="color:#e6db74">&#34;</span>);

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">traverse_good_cb</span>(BSTreeNode <span style="color:#f92672">*</span> node)
{
    debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">KEY: %s</span><span style="color:#e6db74">&#34;</span>, bdata((bstring) node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key));
    traverse_called<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">traverse_fail_cb</span>(BSTreeNode <span style="color:#f92672">*</span> node)
{
    debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">KEY: %s</span><span style="color:#e6db74">&#34;</span>, bdata((bstring) node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key));
    traverse_called<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;

    <span style="color:#66d9ef">if</span> (traverse_called <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>) {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
    }
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_create</span>()
{
    map <span style="color:#f92672">=</span> BSTree_create(NULL);
    mu_assert(map <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to create map.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_destroy</span>()
{
    BSTree_destroy(map);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_get_set</span>()
{
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> BSTree_set(map, <span style="color:#f92672">&amp;</span>test1, <span style="color:#f92672">&amp;</span>expect1);
    mu_assert(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to set &amp;test1</span><span style="color:#e6db74">&#34;</span>);
    bstring result <span style="color:#f92672">=</span> BSTree_get(map, <span style="color:#f92672">&amp;</span>test1);
    mu_assert(result <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>expect1, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong value for test1.</span><span style="color:#e6db74">&#34;</span>);

    rc <span style="color:#f92672">=</span> BSTree_set(map, <span style="color:#f92672">&amp;</span>test2, <span style="color:#f92672">&amp;</span>expect2);
    mu_assert(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to set test2</span><span style="color:#e6db74">&#34;</span>);
    result <span style="color:#f92672">=</span> BSTree_get(map, <span style="color:#f92672">&amp;</span>test2);
    mu_assert(result <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>expect2, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong value for test2.</span><span style="color:#e6db74">&#34;</span>);

    rc <span style="color:#f92672">=</span> BSTree_set(map, <span style="color:#f92672">&amp;</span>test3, <span style="color:#f92672">&amp;</span>expect3);
    mu_assert(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to set test3</span><span style="color:#e6db74">&#34;</span>);
    result <span style="color:#f92672">=</span> BSTree_get(map, <span style="color:#f92672">&amp;</span>test3);
    mu_assert(result <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>expect3, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong value for test3.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_traverse</span>()
{
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> BSTree_traverse(map, traverse_good_cb);
    mu_assert(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to traverse.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(traverse_called <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong count traverse.</span><span style="color:#e6db74">&#34;</span>);

    traverse_called <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    rc <span style="color:#f92672">=</span> BSTree_traverse(map, traverse_fail_cb);
    mu_assert(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to traverse.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(traverse_called <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong count traverse for fail.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_delete</span>()
{
    bstring deleted <span style="color:#f92672">=</span> (bstring) BSTree_delete(map, <span style="color:#f92672">&amp;</span>test1);
    mu_assert(deleted <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Got NULL on delete.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(deleted <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>expect1, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should get test1</span><span style="color:#e6db74">&#34;</span>);
    bstring result <span style="color:#f92672">=</span> BSTree_get(map, <span style="color:#f92672">&amp;</span>test1);
    mu_assert(result <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should delete.</span><span style="color:#e6db74">&#34;</span>);

    deleted <span style="color:#f92672">=</span> (bstring) BSTree_delete(map, <span style="color:#f92672">&amp;</span>test1);
    mu_assert(deleted <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should get NULL on delete</span><span style="color:#e6db74">&#34;</span>);

    deleted <span style="color:#f92672">=</span> (bstring) BSTree_delete(map, <span style="color:#f92672">&amp;</span>test2);
    mu_assert(deleted <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Got NULL on delete.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(deleted <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>expect2, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should get test2</span><span style="color:#e6db74">&#34;</span>);
    result <span style="color:#f92672">=</span> BSTree_get(map, <span style="color:#f92672">&amp;</span>test2);
    mu_assert(result <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should delete.</span><span style="color:#e6db74">&#34;</span>);

    deleted <span style="color:#f92672">=</span> (bstring) BSTree_delete(map, <span style="color:#f92672">&amp;</span>test3);
    mu_assert(deleted <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Got NULL on delete.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(deleted <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>expect3, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should get test3</span><span style="color:#e6db74">&#34;</span>);
    result <span style="color:#f92672">=</span> BSTree_get(map, <span style="color:#f92672">&amp;</span>test3);
    mu_assert(result <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should delete.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#75715e">// test deleting non-existent stuff
</span><span style="color:#75715e"></span>    deleted <span style="color:#f92672">=</span> (bstring) BSTree_delete(map, <span style="color:#f92672">&amp;</span>test3);
    mu_assert(deleted <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should get NULL</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_fuzzing</span>()
{
    BSTree <span style="color:#f92672">*</span>store <span style="color:#f92672">=</span> BSTree_create(NULL);
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    bstring numbers[<span style="color:#ae81ff">100</span>] <span style="color:#f92672">=</span> { NULL };
    bstring data[<span style="color:#ae81ff">100</span>] <span style="color:#f92672">=</span> { NULL };
    srand((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)time(NULL));

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">100</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        <span style="color:#66d9ef">int</span> num <span style="color:#f92672">=</span> rand();
        numbers[i] <span style="color:#f92672">=</span> bformat(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>, num);
        data[i] <span style="color:#f92672">=</span> bformat(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">data %d</span><span style="color:#e6db74">&#34;</span>, num);
        BSTree_set(store, numbers[i], data[i]);
    }

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">100</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        bstring value <span style="color:#f92672">=</span> BSTree_delete(store, numbers[i]);
        mu_assert(value <span style="color:#f92672">=</span><span style="color:#f92672">=</span> data[i],
                <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to delete the right number.</span><span style="color:#e6db74">&#34;</span>);

        mu_assert(BSTree_delete(store, numbers[i]) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL,
                <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should get nothing.</span><span style="color:#e6db74">&#34;</span>);

        <span style="color:#66d9ef">for</span> (j <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; j <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">99</span> <span style="color:#f92672">-</span> i; j<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
            bstring value <span style="color:#f92672">=</span> BSTree_get(store, numbers[j]);
            mu_assert(value <span style="color:#f92672">=</span><span style="color:#f92672">=</span> data[j],
                    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to get the right number.</span><span style="color:#e6db74">&#34;</span>);
        }

        bdestroy(value);
        bdestroy(numbers[i]);
    }

    BSTree_destroy(store);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">all_tests</span>()
{
    mu_suite_start();

    mu_run_test(test_create);
    mu_run_test(test_get_set);
    mu_run_test(test_traverse);
    mu_run_test(test_delete);
    mu_run_test(test_destroy);
    mu_run_test(test_fuzzing);

    <span style="color:#66d9ef">return</span> NULL;
}

RUN_TESTS(all_tests);

</code></pre></div><p>There's nothing new in the code, but make sure you read the book carefully.</p>
<p>Code Review</p>
<p>.\ex40\bstree.h</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">ifndef _lcthw_BSTree_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define _lcthw_BSTree_h</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">int</span> (<span style="color:#f92672">*</span>BSTree_compare) (<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>b);

<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> BSTreeNode {
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key;
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data;

    <span style="color:#66d9ef">struct</span> BSTreeNode <span style="color:#f92672">*</span>left;
    <span style="color:#66d9ef">struct</span> BSTreeNode <span style="color:#f92672">*</span>right;
    <span style="color:#66d9ef">struct</span> BSTreeNode <span style="color:#f92672">*</span>parent;
} BSTreeNode;

<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> BSTree {
    <span style="color:#66d9ef">int</span> count;
    BSTree_compare compare;
    BSTreeNode <span style="color:#f92672">*</span>root;
} BSTree;

<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">int</span> (<span style="color:#f92672">*</span>BSTree_traverse_cb) (BSTreeNode <span style="color:#f92672">*</span> node);

BSTree <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_create</span>(BSTree_compare compare);
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">BSTree_destroy</span>(BSTree <span style="color:#f92672">*</span> map);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BSTree_set</span>(BSTree <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data);
<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_get</span>(BSTree <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key);

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BSTree_traverse</span>(BSTree <span style="color:#f92672">*</span> map, BSTree_traverse_cb traverse_cb);

<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_delete</span>(BSTree <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key);

<span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
</code></pre></div><p>.\ex40\bstree.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/dbg.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/bstree.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/bstrlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">default_compare</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>b)
{
    <span style="color:#66d9ef">return</span> bstrcmp((bstring) a, (bstring) b);
}

BSTree <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_create</span>(BSTree_compare compare)
{
    BSTree <span style="color:#f92672">*</span>map <span style="color:#f92672">=</span> calloc(<span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">sizeof</span>(BSTree));
    check_mem(map);

    map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>compare <span style="color:#f92672">=</span> compare <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL <span style="color:#f92672">?</span> default_compare : compare;

    <span style="color:#66d9ef">return</span> map;

error:
    <span style="color:#66d9ef">if</span> (map) {
        BSTree_destroy(map);
    }
    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BSTree_destroy_cb</span>(BSTreeNode <span style="color:#f92672">*</span> node)
{
    free(node);
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">BSTree_destroy</span>(BSTree <span style="color:#f92672">*</span> map)
{
    <span style="color:#66d9ef">if</span> (map) {
        BSTree_traverse(map, BSTree_destroy_cb);
        free(map);
    }
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> BSTreeNode <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTreeNode_create</span>(BSTreeNode <span style="color:#f92672">*</span> parent,
        <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data)
{
    BSTreeNode <span style="color:#f92672">*</span>node <span style="color:#f92672">=</span> calloc(<span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">sizeof</span>(BSTreeNode));
    check_mem(node);

    node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key <span style="color:#f92672">=</span> key;
    node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data <span style="color:#f92672">=</span> data;
    node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>parent <span style="color:#f92672">=</span> parent;
    <span style="color:#66d9ef">return</span> node;

error:
    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">BSTree_setnode</span>(BSTree <span style="color:#f92672">*</span> map, BSTreeNode <span style="color:#f92672">*</span> node,
        <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data)
{
    <span style="color:#66d9ef">int</span> cmp <span style="color:#f92672">=</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>compare(node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key, key);

    <span style="color:#66d9ef">if</span> (cmp <span style="color:#f92672">&lt;</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left) {
            BSTree_setnode(map, node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left, key, data);
        } <span style="color:#66d9ef">else</span> {
            node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left <span style="color:#f92672">=</span> BSTreeNode_create(node, key, data);
        }
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right) {
            BSTree_setnode(map, node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right, key, data);
        } <span style="color:#66d9ef">else</span> {
            node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right <span style="color:#f92672">=</span> BSTreeNode_create(node, key, data);
        }
    }
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BSTree_set</span>(BSTree <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data)
{
    <span style="color:#66d9ef">if</span> (map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL) {
        <span style="color:#75715e">// first so just make it and get out
</span><span style="color:#75715e"></span>        map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root <span style="color:#f92672">=</span> BSTreeNode_create(NULL, key, data);
        check_mem(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root);
    } <span style="color:#66d9ef">else</span> {
        BSTree_setnode(map, map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root, key, data);
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
error:
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> BSTreeNode <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_getnode</span>(BSTree <span style="color:#f92672">*</span> map,
        BSTreeNode <span style="color:#f92672">*</span> node, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key)
{
    <span style="color:#66d9ef">int</span> cmp <span style="color:#f92672">=</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>compare(node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key, key);

    <span style="color:#66d9ef">if</span> (cmp <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">return</span> node;
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (cmp <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left) {
            <span style="color:#66d9ef">return</span> BSTree_getnode(map, node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left, key);
        } <span style="color:#66d9ef">else</span> {
            <span style="color:#66d9ef">return</span> NULL;
        }
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right) {
            <span style="color:#66d9ef">return</span> BSTree_getnode(map, node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right, key);
        } <span style="color:#66d9ef">else</span> {
            <span style="color:#66d9ef">return</span> NULL;
        }
    }
}

<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_get</span>(BSTree <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key)
{
    <span style="color:#66d9ef">if</span> (map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL) {
        <span style="color:#66d9ef">return</span> NULL;
    } <span style="color:#66d9ef">else</span> {
        BSTreeNode <span style="color:#f92672">*</span>node <span style="color:#f92672">=</span> BSTree_getnode(map, map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root, key);
        <span style="color:#66d9ef">return</span> node <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL <span style="color:#f92672">?</span> NULL <span style="color:#f92672">:</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data;
    }
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BSTree_traverse_nodes</span>(BSTreeNode <span style="color:#f92672">*</span> node,
        BSTree_traverse_cb traverse_cb)
{
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left) {
        rc <span style="color:#f92672">=</span> BSTree_traverse_nodes(node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left, traverse_cb);
        <span style="color:#66d9ef">if</span> (rc <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
            <span style="color:#66d9ef">return</span> rc;
    }

    <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right) {
        rc <span style="color:#f92672">=</span> BSTree_traverse_nodes(node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right, traverse_cb);
        <span style="color:#66d9ef">if</span> (rc <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
            <span style="color:#66d9ef">return</span> rc;
    }

    <span style="color:#66d9ef">return</span> traverse_cb(node);
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">BSTree_traverse</span>(BSTree <span style="color:#f92672">*</span> map, BSTree_traverse_cb traverse_cb)
{
    <span style="color:#66d9ef">if</span> (map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root) {
        <span style="color:#66d9ef">return</span> BSTree_traverse_nodes(map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root, traverse_cb);
    }

    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> BSTreeNode <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_find_min</span>(BSTreeNode <span style="color:#f92672">*</span> node)
{
    <span style="color:#66d9ef">while</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left) {
        node <span style="color:#f92672">=</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left;
    }

    <span style="color:#66d9ef">return</span> node;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">BSTree_replace_node_in_parent</span>(BSTree <span style="color:#f92672">*</span> map,
        BSTreeNode <span style="color:#f92672">*</span> node,
        BSTreeNode <span style="color:#f92672">*</span> new_value)
{
    <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>parent) {
        <span style="color:#66d9ef">if</span> (node <span style="color:#f92672">=</span><span style="color:#f92672">=</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>parent<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left) {
            node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>parent<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left <span style="color:#f92672">=</span> new_value;
        } <span style="color:#66d9ef">else</span> {
            node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>parent<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right <span style="color:#f92672">=</span> new_value;
        }
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#75715e">// this is the root so gotta change it
</span><span style="color:#75715e"></span>        map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root <span style="color:#f92672">=</span> new_value;
    }

    <span style="color:#66d9ef">if</span> (new_value) {
        new_value<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>parent <span style="color:#f92672">=</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>parent;
    }
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">BSTree_swap</span>(BSTreeNode <span style="color:#f92672">*</span> a, BSTreeNode <span style="color:#f92672">*</span> b)
{
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>temp <span style="color:#f92672">=</span> NULL;
    temp <span style="color:#f92672">=</span> b<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key;
    b<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key <span style="color:#f92672">=</span> a<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key;
    a<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key <span style="color:#f92672">=</span> temp;
    temp <span style="color:#f92672">=</span> b<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data;
    b<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data <span style="color:#f92672">=</span> a<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data;
    a<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data <span style="color:#f92672">=</span> temp;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> BSTreeNode <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_node_delete</span>(BSTree <span style="color:#f92672">*</span> map,
        BSTreeNode <span style="color:#f92672">*</span> node,
        <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key)
{
    <span style="color:#66d9ef">int</span> cmp <span style="color:#f92672">=</span> map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>compare(node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key, key);

    <span style="color:#66d9ef">if</span> (cmp <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left) {
            <span style="color:#66d9ef">return</span> BSTree_node_delete(map, node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left, key);
        } <span style="color:#66d9ef">else</span> {
            <span style="color:#75715e">// not found
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> NULL;
        }
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (cmp <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right) {
            <span style="color:#66d9ef">return</span> BSTree_node_delete(map, node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right, key);
        } <span style="color:#66d9ef">else</span> {
            <span style="color:#75715e">// not found
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> NULL;
        }
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right) {
            <span style="color:#75715e">// swap this node for the smallest node that is bigger than us
</span><span style="color:#75715e"></span>            BSTreeNode <span style="color:#f92672">*</span>successor <span style="color:#f92672">=</span> BSTree_find_min(node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right);
            BSTree_swap(successor, node);

            <span style="color:#75715e">// this leaves the old successor with possibly a right child
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// so replace it with that right child
</span><span style="color:#75715e"></span>            BSTree_replace_node_in_parent(map, successor,
                    successor<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right);

            <span style="color:#75715e">// finally it&#39;s swapped, so return successor instead of node
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> successor;
        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left) {
            BSTree_replace_node_in_parent(map, node, node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>left);
        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right) {
            BSTree_replace_node_in_parent(map, node, node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>right);
        } <span style="color:#66d9ef">else</span> {
            BSTree_replace_node_in_parent(map, node, NULL);
        }

        <span style="color:#66d9ef">return</span> node;
    }
}

<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BSTree_delete</span>(BSTree <span style="color:#f92672">*</span> map, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>key)
{
    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>data <span style="color:#f92672">=</span> NULL;

    <span style="color:#66d9ef">if</span> (map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root) {
        BSTreeNode <span style="color:#f92672">*</span>node <span style="color:#f92672">=</span> BSTree_node_delete(map, map<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>root, key);

        <span style="color:#66d9ef">if</span> (node) {
            data <span style="color:#f92672">=</span> node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>data;
            free(node);
        }
    }

    <span style="color:#66d9ef">return</span> data;
}

</code></pre></div><p>.\ex40\bstree_tests.c</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;minunit.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/bstree.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;assert.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;lcthw/bstrlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;time.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
BSTree <span style="color:#f92672">*</span>map <span style="color:#f92672">=</span> NULL;
<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> traverse_called <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
<span style="color:#66d9ef">struct</span> tagbstring test1 <span style="color:#f92672">=</span> bsStatic(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">test data 1</span><span style="color:#e6db74">&#34;</span>);
<span style="color:#66d9ef">struct</span> tagbstring test2 <span style="color:#f92672">=</span> bsStatic(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">test data 2</span><span style="color:#e6db74">&#34;</span>);
<span style="color:#66d9ef">struct</span> tagbstring test3 <span style="color:#f92672">=</span> bsStatic(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">xest data 3</span><span style="color:#e6db74">&#34;</span>);
<span style="color:#66d9ef">struct</span> tagbstring expect1 <span style="color:#f92672">=</span> bsStatic(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">THE VALUE 1</span><span style="color:#e6db74">&#34;</span>);
<span style="color:#66d9ef">struct</span> tagbstring expect2 <span style="color:#f92672">=</span> bsStatic(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">THE VALUE 2</span><span style="color:#e6db74">&#34;</span>);
<span style="color:#66d9ef">struct</span> tagbstring expect3 <span style="color:#f92672">=</span> bsStatic(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">THE VALUE 3</span><span style="color:#e6db74">&#34;</span>);

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">traverse_good_cb</span>(BSTreeNode <span style="color:#f92672">*</span> node)
{
    debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">KEY: %s</span><span style="color:#e6db74">&#34;</span>, bdata((bstring) node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key));
    traverse_called<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">traverse_fail_cb</span>(BSTreeNode <span style="color:#f92672">*</span> node)
{
    debug(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">KEY: %s</span><span style="color:#e6db74">&#34;</span>, bdata((bstring) node<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>key));
    traverse_called<span style="color:#f92672">+</span><span style="color:#f92672">+</span>;

    <span style="color:#66d9ef">if</span> (traverse_called <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>) {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
    }
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_create</span>()
{
    map <span style="color:#f92672">=</span> BSTree_create(NULL);
    mu_assert(map <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to create map.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_destroy</span>()
{
    BSTree_destroy(map);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_get_set</span>()
{
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> BSTree_set(map, <span style="color:#f92672">&amp;</span>test1, <span style="color:#f92672">&amp;</span>expect1);
    mu_assert(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to set &amp;test1</span><span style="color:#e6db74">&#34;</span>);
    bstring result <span style="color:#f92672">=</span> BSTree_get(map, <span style="color:#f92672">&amp;</span>test1);
    mu_assert(result <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>expect1, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong value for test1.</span><span style="color:#e6db74">&#34;</span>);

    rc <span style="color:#f92672">=</span> BSTree_set(map, <span style="color:#f92672">&amp;</span>test2, <span style="color:#f92672">&amp;</span>expect2);
    mu_assert(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to set test2</span><span style="color:#e6db74">&#34;</span>);
    result <span style="color:#f92672">=</span> BSTree_get(map, <span style="color:#f92672">&amp;</span>test2);
    mu_assert(result <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>expect2, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong value for test2.</span><span style="color:#e6db74">&#34;</span>);

    rc <span style="color:#f92672">=</span> BSTree_set(map, <span style="color:#f92672">&amp;</span>test3, <span style="color:#f92672">&amp;</span>expect3);
    mu_assert(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to set test3</span><span style="color:#e6db74">&#34;</span>);
    result <span style="color:#f92672">=</span> BSTree_get(map, <span style="color:#f92672">&amp;</span>test3);
    mu_assert(result <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>expect3, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong value for test3.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_traverse</span>()
{
    <span style="color:#66d9ef">int</span> rc <span style="color:#f92672">=</span> BSTree_traverse(map, traverse_good_cb);
    mu_assert(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to traverse.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(traverse_called <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong count traverse.</span><span style="color:#e6db74">&#34;</span>);

    traverse_called <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    rc <span style="color:#f92672">=</span> BSTree_traverse(map, traverse_fail_cb);
    mu_assert(rc <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to traverse.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(traverse_called <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong count traverse for fail.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_delete</span>()
{
    bstring deleted <span style="color:#f92672">=</span> (bstring) BSTree_delete(map, <span style="color:#f92672">&amp;</span>test1);
    mu_assert(deleted <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Got NULL on delete.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(deleted <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>expect1, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should get test1</span><span style="color:#e6db74">&#34;</span>);
    bstring result <span style="color:#f92672">=</span> BSTree_get(map, <span style="color:#f92672">&amp;</span>test1);
    mu_assert(result <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should delete.</span><span style="color:#e6db74">&#34;</span>);

    deleted <span style="color:#f92672">=</span> (bstring) BSTree_delete(map, <span style="color:#f92672">&amp;</span>test1);
    mu_assert(deleted <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should get NULL on delete</span><span style="color:#e6db74">&#34;</span>);

    deleted <span style="color:#f92672">=</span> (bstring) BSTree_delete(map, <span style="color:#f92672">&amp;</span>test2);
    mu_assert(deleted <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Got NULL on delete.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(deleted <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>expect2, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should get test2</span><span style="color:#e6db74">&#34;</span>);
    result <span style="color:#f92672">=</span> BSTree_get(map, <span style="color:#f92672">&amp;</span>test2);
    mu_assert(result <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should delete.</span><span style="color:#e6db74">&#34;</span>);

    deleted <span style="color:#f92672">=</span> (bstring) BSTree_delete(map, <span style="color:#f92672">&amp;</span>test3);
    mu_assert(deleted <span style="color:#f92672">!</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Got NULL on delete.</span><span style="color:#e6db74">&#34;</span>);
    mu_assert(deleted <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>expect3, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should get test3</span><span style="color:#e6db74">&#34;</span>);
    result <span style="color:#f92672">=</span> BSTree_get(map, <span style="color:#f92672">&amp;</span>test3);
    mu_assert(result <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should delete.</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#75715e">// test deleting non-existent stuff
</span><span style="color:#75715e"></span>    deleted <span style="color:#f92672">=</span> (bstring) BSTree_delete(map, <span style="color:#f92672">&amp;</span>test3);
    mu_assert(deleted <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should get NULL</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">test_fuzzing</span>()
{
    BSTree <span style="color:#f92672">*</span>store <span style="color:#f92672">=</span> BSTree_create(NULL);
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    bstring numbers[<span style="color:#ae81ff">100</span>] <span style="color:#f92672">=</span> { NULL };
    bstring data[<span style="color:#ae81ff">100</span>] <span style="color:#f92672">=</span> { NULL };
    srand((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)time(NULL));

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">100</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        <span style="color:#66d9ef">int</span> num <span style="color:#f92672">=</span> rand();
        numbers[i] <span style="color:#f92672">=</span> bformat(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>, num);
        data[i] <span style="color:#f92672">=</span> bformat(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">data %d</span><span style="color:#e6db74">&#34;</span>, num);
        BSTree_set(store, numbers[i], data[i]);
    }

    <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">100</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        bstring value <span style="color:#f92672">=</span> BSTree_delete(store, numbers[i]);
        mu_assert(value <span style="color:#f92672">=</span><span style="color:#f92672">=</span> data[i],
                <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to delete the right number.</span><span style="color:#e6db74">&#34;</span>);

        mu_assert(BSTree_delete(store, numbers[i]) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL,
                <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Should get nothing.</span><span style="color:#e6db74">&#34;</span>);

        <span style="color:#66d9ef">for</span> (j <span style="color:#f92672">=</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; j <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">99</span> <span style="color:#f92672">-</span> i; j<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
            bstring value <span style="color:#f92672">=</span> BSTree_get(store, numbers[j]);
            mu_assert(value <span style="color:#f92672">=</span><span style="color:#f92672">=</span> data[j],
                    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Failed to get the right number.</span><span style="color:#e6db74">&#34;</span>);
        }

        bdestroy(value);
        bdestroy(numbers[i]);
    }

    BSTree_destroy(store);

    <span style="color:#66d9ef">return</span> NULL;
}

<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">all_tests</span>()
{
    mu_suite_start();

    mu_run_test(test_create);
    mu_run_test(test_get_set);
    mu_run_test(test_traverse);
    mu_run_test(test_delete);
    mu_run_test(test_destroy);
    mu_run_test(test_fuzzing);

    <span style="color:#66d9ef">return</span> NULL;
}

RUN_TESTS(all_tests);

</code></pre></div><p>I'll walk through the implementation and compare it to Hashmaps for features.</p>
<p>Improving It</p>
<ul>
<li>As usual, you should go through all of the defensive programming checks and add
<em>assert</em>s for conditions that shouldn't happen.  For example, you shouldn't be getting <em>NULL</em> values for the recursion functions, so assert that.</li>
<li>The traverse function walks through the tree in order by traversing left, then right,
and then the current node.  You can create traverse functions for the reverse order, as well.</li>
</ul>
<p>Improving It</p>
<ul>
<li>It does a full string compare on every node, but I could use the <em>Hashmap</em>
hashing functions to speed this up.  I could hash the keys, and then keep the hash in
the <em>BSTreeNode</em>.  Then, in each of the set up functions, I can hash the
key ahead of time, and pass it down to the recursive function.  Using this hash, I can
then compare each node much quicker in a way that's similar to what I do in <em>Hashmap</em>.</li>
</ul>
<p>Breaking It</p>
<p>A big flaw in this is the use of recursion.  An attacker could choose data to cause a stack overflow.</p>
<p>Extra Credit</p>
<ul>
<li>There's an alternative way to do this data structure without using recursion.  The Wikipedia
page shows alternatives that don't use recursion but do the same thing.  Why would this
be better or worse?</li>
<li>Read up on all of the different but similar trees you can find. There are AVL trees (named after Georgy Adelson-Velsky and E.M. Landis), red-black trees,
and some non-tree structures like skip lists.</li>
</ul>

    </div>

    <div class="toc toc-fixed" >
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#exercise-32-double-linked-lists">Exercise 32 Double Linked Lists</a></li>
        <li><a href="#exercise-33-linked-list-algorithms">Exercise 33 Linked List Algorithms</a></li>
        <li><a href="#exercise-34-dynamic-array">Exercise 34 Dynamic Array</a></li>
        <li><a href="#exercise-35-sorting-and-searching">Exercise 35 Sorting and Searching</a></li>
        <li><a href="#exercise-36-safer-strings">Exercise 36 Safer Strings</a></li>
        <li><a href="#exercise-37-hashmaps">Exercise 37 Hashmaps</a></li>
        <li><a href="#exercise-38-hashmap-algorithms">Exercise 38 Hashmap Algorithms</a></li>
        <li><a href="#exercise-39-string-algorithms">Exercise 39 String Algorithms</a></li>
        <li><a href="#exercise-40-binary-search-trees">Exercise 40 Binary Search Trees</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

</div>

    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="/coding/c/lcthw-lectures.1/" title="C Lecture - 1"> <i class="fa fa-chevron-left"></i><label>C Lecture - 1</label></a>
    <a class="nav nav-next" href="/coding/c/lcthw-lectures.3/" title="C Lecture - 3" style="margin-right: 0px;"><label>C Lecture - 3</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

    

    
  </div>


	<div>


  
    
  



	</div>
</footer>

<script src="/js/clipboard.min.js"></script>

<link href="/css/featherlight.min.css" rel="stylesheet">
<script src="/js/featherlight.min.js"></script>


<link href="/css/github.css" rel="stylesheet">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script src="/theme-flex/script.js"></script>


    

    
    

    
  </body>
</html>
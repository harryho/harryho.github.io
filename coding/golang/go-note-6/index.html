<!DOCTYPE html>
<html>
  <head>
    <title>Hello World</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="revised" content="2019-09-25T21:52:06 AEST">
<title>Golang Note - 6 :: Hello World</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/theme-flex/style.css" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "\/";
</script>
<meta name="description" content="Goroutine &amp; Channels">



    
  </head>
  <body data-url="/coding/golang/go-note-6/">
    
      <header>
  <div class="logo">
    
	
  
    <a class="baselink" href="/">Hello World</a>
  


  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
  <nav class="shortcuts">
    <div>
      <div class="searchbox">
        <input data-search-input id="search-by" type="text" placeholder="Search...">
      </div>
      <script type="text/javascript" src="/js/lunr.min.js"></script>
      <script type="text/javascript" src="/js/auto-complete.js"></script>
      <link href="/css/auto-complete.css" rel="stylesheet">
      <script type="text/javascript">
        
            var baseurl = "\/";
        
      </script>
      <script type="text/javascript" src="/js/search.js"></script>
    </div>
  </nav>
</header>
<article>
  <aside>
    <ul class="menu">
          <li data-nav-id="/" class="dd-item">
          <a href="/">
            <i class="fa fa-fw fa-home"></i>
          </a>
          </li>
    <li data-nav-id="/blogs/" class="dd-item haschildren
        ">
      <div>
      <a href="/blogs/">Blogs</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/blogs/vue-ng-react/" class="dd-item">
        <div>
          <a href="/blogs/vue-ng-react/">
            Angular vs React vs Vue
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/azure-notes/" class="dd-item">
        <div>
          <a href="/blogs/azure-notes/">
            Azure Practices
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/build-mobile-app/" class="dd-item">
        <div>
          <a href="/blogs/build-mobile-app/">
            Build mobile app with web tech
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/create-a-blog-on-github/" class="dd-item">
        <div>
          <a href="/blogs/create-a-blog-on-github/">
            Create a blog site on GitHub Pages
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/git-notes/" class="dd-item">
        <div>
          <a href="/blogs/git-notes/">
            Git Practices
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/javascript-oop/" class="dd-item">
        <div>
          <a href="/blogs/javascript-oop/">
            JavaScript and OOP
          </a>
        </div>
    </li>
      <li data-nav-id="/blogs/k8s-notes/" class="dd-item">
        <div>
          <a href="/blogs/k8s-notes/">
            Kubernetes Practices
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/coding/">Coding</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/coding/c/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/c/">C / C&#43;&#43;</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/c/lcthw-lectures.1/" class="dd-item">
        <div>
          <a href="/coding/c/lcthw-lectures.1/">
            C Lecture - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c/lcthw-lectures.2/" class="dd-item">
        <div>
          <a href="/coding/c/lcthw-lectures.2/">
            C Lecture - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c/lcthw-lectures.3/" class="dd-item">
        <div>
          <a href="/coding/c/lcthw-lectures.3/">
            C Lecture - 3
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c/lcthw-lectures.4/" class="dd-item">
        <div>
          <a href="/coding/c/lcthw-lectures.4/">
            C Lecture - 4
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/c-sharp/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/c-sharp/">C#</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/c-sharp/csharp-note-1/" class="dd-item">
        <div>
          <a href="/coding/c-sharp/csharp-note-1/">
            C# Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c-sharp/csharp-note-2/" class="dd-item">
        <div>
          <a href="/coding/c-sharp/csharp-note-2/">
            C# Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/c-sharp/csharp-note-3/" class="dd-item">
        <div>
          <a href="/coding/c-sharp/csharp-note-3/">
            C# Note - 3
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/golang/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/coding/golang/">Golang</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/golang/go-note-1/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-1/">
            Golang Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-2/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-2/">
            Golang Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-3/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-3/">
            Golang Note - 3
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-4/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-4/">
            Golang Note - 4
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-5/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-5/">
            Golang Note - 5
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-6/" class="dd-item active">
        <div>
          <a href="/coding/golang/go-note-6/">
            Golang Note - 6
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/golang/go-note-99/" class="dd-item">
        <div>
          <a href="/coding/golang/go-note-99/">
            Golang snippets
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/java/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/java/">Java</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/java/java-note-1/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-1/">
            Java Note - 1: Enum
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/java/java-note-2/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-2/">
            Java Note - 2: Concurrency
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/java/java-note-3/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-3/">
            Java Note - 3: Path and Files
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/java/java-note-4/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-4/">
            Java Note - 4: Date Time 
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/java/java-note-5/" class="dd-item">
        <div>
          <a href="/coding/java/java-note-5/">
            Java Note - 5: Lambda 
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/javascript/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/javascript/">JavaScript</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/javascript/js-note-99/" class="dd-item">
        <div>
          <a href="/coding/javascript/js-note-99/">
            JavaScript, ECMAScript snippet
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/javascript/js-note-1/" class="dd-item">
        <div>
          <a href="/coding/javascript/js-note-1/">
            JS &amp; ES Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/javascript/js-note-2/" class="dd-item">
        <div>
          <a href="/coding/javascript/js-note-2/">
            JS &amp; ES Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/javascript/js-note-3/" class="dd-item">
        <div>
          <a href="/coding/javascript/js-note-3/">
            JS &amp; ES Note - 3
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/python/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/python/">Python</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/python/python-note-1/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-1/">
            Python Note 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-2/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-2/">
            Python Note 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-3/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-3/">
            Python Note 3
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-4/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-4/">
            Python Note 4
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-5/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-5/">
            Python Note 5
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-6/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-6/">
            Python Note 6
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-7/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-7/">
            Python Note 7
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-8/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-8/">
            Python Note 8
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/python/python-note-9/" class="dd-item">
        <div>
          <a href="/coding/python/python-note-9/">
            Python Note 9
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/rustlang/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/rustlang/">Rustlang</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/rustlang/rust-note-1/" class="dd-item">
        <div>
          <a href="/coding/rustlang/rust-note-1/">
            Rustlang Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/rustlang/rust-note-2/" class="dd-item">
        <div>
          <a href="/coding/rustlang/rust-note-2/">
            Rustlang Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/rustlang/rust-note-3/" class="dd-item">
        <div>
          <a href="/coding/rustlang/rust-note-3/">
            Rustlang Note - 3
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/rustlang/rust-note-4/" class="dd-item">
        <div>
          <a href="/coding/rustlang/rust-note-4/">
            Rustlang Note - 4
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/shell/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/shell/">Shell</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/shell/cron-note-1/" class="dd-item">
        <div>
          <a href="/coding/shell/cron-note-1/">
            Cron Job Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/shell/cron-note-2/" class="dd-item">
        <div>
          <a href="/coding/shell/cron-note-2/">
            Cron Job Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/shell/ps-note-1/" class="dd-item">
        <div>
          <a href="/coding/shell/ps-note-1/">
            Powershell Note - 1
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/coding/sql/" class="dd-item haschildren
        ">
      <div>
      <a href="/coding/sql/">SQL</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/coding/sql/mysql-note-1/" class="dd-item">
        <div>
          <a href="/coding/sql/mysql-note-1/">
            MySql Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/sql/mysql-note-2/" class="dd-item">
        <div>
          <a href="/coding/sql/mysql-note-2/">
            MySql Note - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/coding/sql/mysql-note-3/" class="dd-item">
        <div>
          <a href="/coding/sql/mysql-note-3/">
            MySql Note - 3
          </a>
        </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/frameworks/" class="dd-item haschildren
        ">
      <div>
      <a href="/frameworks/">Frameworks</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/frameworks/cntk-notes-1/" class="dd-item">
        <div>
          <a href="/frameworks/cntk-notes-1/">
            CNTK Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/frameworks/php-web/" class="dd-item">
        <div>
          <a href="/frameworks/php-web/">
            PHP Web Framework
          </a>
        </div>
    </li>
      <li data-nav-id="/frameworks/python-django/" class="dd-item">
        <div>
          <a href="/frameworks/python-django/">
            Python Web Framework
          </a>
        </div>
    </li>
      <li data-nav-id="/frameworks/tensorflow-notes-1/" class="dd-item">
        <div>
          <a href="/frameworks/tensorflow-notes-1/">
            Tensorflow Note - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/frameworks/tensorflow-notes-2/" class="dd-item">
        <div>
          <a href="/frameworks/tensorflow-notes-2/">
            Tensorflow Note - 2
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/hacks/" class="dd-item haschildren
        ">
      <div>
      <a href="/hacks/">Hacks</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/hacks/cass-note/" class="dd-item">
        <div>
          <a href="/hacks/cass-note/">
            Cassandra Practices
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/php-debug/" class="dd-item">
        <div>
          <a href="/hacks/php-debug/">
            Debug PHP with Free IDE
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/qemu-notes/" class="dd-item">
        <div>
          <a href="/hacks/qemu-notes/">
            Qemu &amp; Virtual Machine
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/windows-command-1/" class="dd-item">
        <div>
          <a href="/hacks/windows-command-1/">
            Windows cmd &amp; hotkey - 1
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/windows-command-2/" class="dd-item">
        <div>
          <a href="/hacks/windows-command-2/">
            Windows cmd &amp; hotkey - 2
          </a>
        </div>
    </li>
      <li data-nav-id="/hacks/windows-command-3/" class="dd-item">
        <div>
          <a href="/hacks/windows-command-3/">
            Windows cmd &amp; hotkey - 3
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/os/" class="dd-item haschildren
        ">
      <div>
      <a href="/os/">OS</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/os/centos-fedora-desktop/" class="dd-item">
        <div>
          <a href="/os/centos-fedora-desktop/">
            CentOS 6/7 Multi-Boot Setup
          </a>
        </div>
    </li>
      <li data-nav-id="/os/centos-server-7/" class="dd-item">
        <div>
          <a href="/os/centos-server-7/">
            CentOS 7 Server note
          </a>
        </div>
    </li>
      <li data-nav-id="/os/dual-boot-win10-ubuntu18/" class="dd-item">
        <div>
          <a href="/os/dual-boot-win10-ubuntu18/">
            Dual Boot Windows 10 &amp; Ubuntu 18
          </a>
        </div>
    </li>
      <li data-nav-id="/os/grub-trouble-shooting/" class="dd-item">
        <div>
          <a href="/os/grub-trouble-shooting/">
            Grub Trouble Shooting
          </a>
        </div>
    </li>
      <li data-nav-id="/os/lubuntu16-desktop/" class="dd-item">
        <div>
          <a href="/os/lubuntu16-desktop/">
            Lubuntu 16 desktop
          </a>
        </div>
    </li>
      <li data-nav-id="/os/raspberrypi-notes/" class="dd-item">
        <div>
          <a href="/os/raspberrypi-notes/">
            Raspberry Pi setup
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-desktop-14/" class="dd-item">
        <div>
          <a href="/os/ubuntu-desktop-14/">
            Ubuntu 14 -- desktop setup &amp; dual boot 
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-desktop-14-extra-tools/" class="dd-item">
        <div>
          <a href="/os/ubuntu-desktop-14-extra-tools/">
            Ubuntu 14 -- desktop, extra tools
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-server-14/" class="dd-item">
        <div>
          <a href="/os/ubuntu-server-14/">
            Ubuntu 14 -- server setup
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-server-16/" class="dd-item">
        <div>
          <a href="/os/ubuntu-server-16/">
            Ubuntu 16 server note
          </a>
        </div>
    </li>
      <li data-nav-id="/os/ubuntu-desktop-18/" class="dd-item">
        <div>
          <a href="/os/ubuntu-desktop-18/">
            Ubuntu Desktop 18 LTS note
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/projects/" class="dd-item haschildren
        ">
      <div>
      <a href="/projects/">Projects</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/projects/angular4-crm/" class="dd-item">
        <div>
          <a href="/projects/angular4-crm/">
            Angular 4 CRM Project
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/angularjs-webpack-es6-starter/" class="dd-item">
        <div>
          <a href="/projects/angularjs-webpack-es6-starter/">
            Angularjs Webpack ES6 Starter
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/python-flat-api/" class="dd-item">
        <div>
          <a href="/projects/python-flat-api/">
            FlatApi - Restful API for python dev
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/kube-cluster/" class="dd-item">
        <div>
          <a href="/projects/kube-cluster/">
            Kubernetes Cluster in 5min
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/laravel-mvc-starter/" class="dd-item">
        <div>
          <a href="/projects/laravel-mvc-starter/">
            Laravel MVC Starter
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/react-crm/" class="dd-item">
        <div>
          <a href="/projects/react-crm/">
            React Redux CRM Project
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/vue2-admin/" class="dd-item">
        <div>
          <a href="/projects/vue2-admin/">
            Vue 2 Admin Project
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/vue2-crm/" class="dd-item">
        <div>
          <a href="/projects/vue2-crm/">
            Vue 2 CRM Project
          </a>
        </div>
    </li>
      <li data-nav-id="/projects/zf2-mvc-starter/" class="dd-item">
        <div>
          <a href="/projects/zf2-mvc-starter/">
            Zend Framework 2 MVC Starter
          </a>
        </div>
    </li>
        </ul>
    </li>




    </ul>
    <section>
    </section>
  </aside>
  <section class="page">
    
    <div class="nav-select">
      <center>Navigation : 
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/blogs/" >
   Blogs</option>
    <option value="/coding/" >
   Coding</option> 
  
    <option value="/frameworks/" >
   Frameworks</option>
    <option value="/hacks/" >
   Hacks</option>
    <option value="/os/" >
   OS</option>
    <option value="/projects/" >
   Projects</option>



        </select>
      </center>
    </div>


    


    
    
    
<div class="main-page">
    <div class="flex-item main-content">
            <h1>Golang Note - 6</h1>
        

<h3 id="goroutine">Goroutine</h3>

<ul>
<li><p>A goroutine is implemented as a function or method (this can also be an anonymous or lambda function) and called (invoked) with the keyword go. This starts the function running in parallel with the current computation but in the same address space and with its own stack.</p></li>

<li><p>Go’s concurrency primitives provide the basis for a good concurrency program design: expressing program structure so as to represent independently executing actions; so Go’s emphasis is not in the 1 st place on parallelism: concurrent programs may or may not be parallel. Parallelism is the ability to make things run quickly by using multiple processors. But it turns out most often that a well designed concurrent program also has excellent performing parallel capabilities.</p></li>
</ul>

<h4 id="basic-goroutine">Basic Goroutine</h4>

<ul>
<li><p>Sample 1: The code below will not print out anything, because the main exits before the &ldquo;hello&rdquo; goroutine kicks off. Actually the main is another goroutine which always runs first.</p>

<pre><code class="language-go">func main() {
	go func() {
		println(&quot;Hello&quot;)
	}()
}
</code></pre></li>

<li><p>Sample 2: Add timer to set main goroutine sleep a while, and let the &ldquo;hello&rdquo;
goroutine to start.</p>

<pre><code class="language-go">func main() {
	go func() {
		println(&quot;Hello&quot;) // Hello
}()
time.Sleep(3000)
}
</code></pre></li>

<li><p>Sample 3: The code below will print &ldquo;hello&rdquo; 10 times and then print &ldquo;world&rdquo; 10 times.</p>

<pre><code class="language-go">func main() {
	go func() {
		for i := 0; i &lt; 10; i++ {
        println(&quot;Hello&quot;)
        time.Sleep(2000)
		}
	}()
	go func() {
		for i := 0; i &lt; 10; i++ {
			println(&quot;World&quot;)
		}
	}()
	time.Sleep(9999)
}
</code></pre></li>

<li><p>Sample 4: The code below will print &ldquo;hello&rdquo; and &ldquo;world&rdquo; in different order.</p>

<pre><code class="language-go">func main() {
	runtime.GOMAXPROCS(4)
	go func() {
		for i := 0; i &lt; 10; i++ {
			println(&quot;Hello&quot;)
			time.Sleep(500)
		}

	}()
	go func() {
		for i := 0; i &lt; 10; i++ {
			println(&quot;World&quot;)
			time.Sleep(500)
		}
	}()
	time.Sleep(999999)
}
</code></pre></li>

<li><p>Sample 5: File watcher</p>

<pre><code class="language-go">
const watchedPath = &quot;./source&quot;

func main() {
	for {
		d, _ := os.Open(watchedPath)
		files, _ := d.Readdir(-1)
		for _, fi := range files {
			filePath := watchedPath + &quot;/&quot; + fi.Name()
			f, _ := os.Open(filePath)
			data, _ := ioutil.ReadAll(f)
			f.Close()
			os.Remove(filePath)
			go func(data string) {
				reader := csv.NewReader(strings.NewReader(data))
				records, _ := reader.ReadAll()
				for _, r := range records {
					invoice := new(Invoice)
					invoice.Number = r[0]
					invoice.Amount, _ = strconv.ParseFloat(r[1], 64)
					invoice.PurchaseOrderNumber, _ = strconv.Atoi(r[2])
					unixTime, _ := strconv.ParseInt(r[3], 10, 64)
					invoice.InvoiceDate = time.Unix(unixTime, 0)
					
					fmt.Printf(&quot;Received Invoice '%v' for $%.2f and submitted for processing\n&quot;, invoice.Number, invoice.Amount)
				}
			}(string(data))
		}
		d.Close()
		time.Sleep(100 * time.Millisecond)
	}
}

type Invoice struct {
	Number string
	Amount float64
	PurchaseOrderNumber int
	InvoiceDate time.Time
}
</code></pre></li>
</ul>

<h4 id="using-gomaxprocs">Using GOMAXPROCS</h4>

<ul>
<li><p>When GOMAXPROCS is greater than 1, they run on a thread pool with that many threads.With the gccgo compiler GOMAXPROCS is effectively equal to the number of running goroutines.</p></li>

<li><p>Observations from experiments: on a 1 CPU laptop performance improved when GOMAXPROCS was increased to 9. On a 32 core machine, the best performance was reached with GOMAXPROCS=8, a higher number didn’t increase performance in that benchmark.</p></li>
</ul>

<h3 id="channels">Channels</h3>

<h4 id="channels-for-communication-between-goroutines">Channels for communication between goroutines</h4>

<ul>
<li><p>Go has a special type, the channel, which is a like a conduit (pipe) through which you can send typed values and which takes care of communication between goroutines, avoiding all the pitfalls of shared memory; the very act of communication through a channel guarantees synchronization.</p></li>

<li><p>Data are passed around on channels: only one goroutine has access to a data item at any given time: so data races cannot occur, by design. The ownership of the data (that is the ability to read and write it) is passed around.</p></li>

<li><p>A channel is in fact a typed message queue: data can be transmitted through it. It is a First In First Out (FIFO) structure and so they preserve the order of the items that are sent into them (for those who are familiar with it, a channel can be compared to a two-way pipe in Unix shells).</p></li>

<li><p>A channel is also a reference type, so we have to use the make() function to allocate memory for it.</p></li>
</ul>

<p><strong>NOTE: Don’t use print statements to indicate the order of sending to and receiving from a channel: this could be out of order with what actually happens due to the time lag between the print statement and the actual channel sending and receiving.</strong></p>

<h4 id="blocking-of-channels">Blocking of channels</h4>

<ul>
<li><p>A send operation on a channel (and the goroutine or function that contains it) blocks until a receiver is available for the same channel</p></li>

<li><p>A receive operation for a channel blocks (and the goroutine or function that contains it) until a sender is available for the same channel</p></li>
</ul>

<h5 id="goroutine-sync-through-one-or-more-channels">Goroutine sync through one or more channels</h5>

<ul>
<li><p>Blocking - deadlock</p></li>

<li><p>Sample 1 :  deadlock because of lack of sender</p>

<pre><code class="language-go">func main() {
	ch := make(chan string)
	fmt.Println(&lt;-ch)
}
//fatal error: all goroutines are asleep - deadlock!
</code></pre></li>

<li><p>Sample 2: deadlock because of lack of receiver</p>

<pre><code class="language-go">func main() {
	ch := make(chan string, 1)
	ch &lt;- &quot;Hello&quot;
	
}
</code></pre></li>

<li><p>Sample 3</p>

<pre><code class="language-go">func main() {
	ch := make(chan string, 1)
	ch &lt;- &quot;Hello&quot;
	fmt.Println(&lt;-ch) // Hello
}
</code></pre></li>
</ul>

<h5 id="async-channels-channel-with-buffer">Async channels - channel with buffer</h5>

<ul>
<li><p>Channel with buffer</p>

<pre><code class="language-go">buf := 100
ch1 := make(chan string, buf)
</code></pre></li>

<li><p>Sample 4: deadlock again because the 2nd sender can not send message</p>

<pre><code class="language-go">func main() {
	ch := make(chan string, 1)
	ch &lt;- &quot;Hello&quot;
	ch &lt;- &quot;Hello&quot;
	fmt.Println(&lt;-ch)
	fmt.Println(&lt;-ch)
}
</code></pre></li>

<li><p>Sample 5</p>

<pre><code class="language-go">func main() {
	ch := make(chan string, 2)
	ch &lt;- &quot;Hello&quot;
	ch &lt;- &quot;Hello&quot;
	fmt.Println(&lt;-ch) //Hello
	fmt.Println(&lt;-ch) // Hello
}
</code></pre></li>
</ul>

<h5 id="closing-channel">Closing channel</h5>

<ul>
<li><p>Sample 6: Closing channel will not impact the receiver to get the message</p>

<pre><code class="language-go">func main() {
	ch := make(chan string, 1)
	ch &lt;- &quot;Hello&quot;
	ch &lt;- &quot;Hello&quot;
	fmt.Println(&lt;-ch)
	fmt.Println(&lt;-ch)
}
</code></pre></li>

<li><p>Sample 7: Sender cannot send message to closing channel</p>

<pre><code class="language-go">func main() {
	ch := make(chan string, 2)
	ch &lt;- &quot;Hello&quot;
	ch &lt;- &quot;Hello&quot;
	fmt.Println(&lt;-ch) //Hello
fmt.Println(&lt;-ch) // Hello
ch &lt;- &quot;Hello&quot; // panic: send on closed channel
}
</code></pre></li>
</ul>

<h4 id="semaphore-pattern">Semaphore pattern</h4>

<ul>
<li><p>The goroutine compute signals its completion by putting a value on the channel ch, the main routine waits on &lt;-ch until this value gets through.</p>

<pre><code class="language-go">func compute(ch chan int) {
	ch &lt;- someComputation()
	// when it completes, signal on the channel.
}

func main() {
	ch := make(chan int) // allocate a channel.
	go compute(ch)       // start something in a goroutine
	doSomethingElseForAWhile()
	result := &lt;-ch
}
</code></pre></li>
</ul>

<h5 id="implement-a-semaphore-with-a-buffered-channel">Implement a semaphore with a buffered channel</h5>

<ul>
<li><p>There is no semaphore implementation in Go’s sync package, but they can be emulated easily using a buffered channel:</p>

<ul>
<li>the buffered channel is the number of resources we wish to synchronize</li>
<li>the length (number of elements currently stored) of the channel is the number of resources currently being used.</li>
<li>the capacity minus the length of the channel is the number of free resources (the integer value of traditional semaphores)</li>
</ul></li>

<li><p>Sample 8: semaphore pattern</p>

<pre><code class="language-go">type Empty interface {}
var empty Empty
//  do sth ...
data := make([]float64, N)
res := make([]float64, N)
sem := make(chan Empty, N) // semaphore
// do sth  ...
for i, xi := range data {
	go func (i int, xi float64) {
		res[i] = doSomething(i,xi)
		sem &lt;- empty
	} (i, xi)
}
// wait for goroutines to finish
for i := 0; i &lt; N; i++ { &lt;-sem }

</code></pre></li>

<li><p>Semaphore operations sample pattern</p>

<pre><code class="language-go">// acquire n resources
func (s semaphore) P(n int) {
	e := new(Empty)
	for i := 0; i &lt; n; i++ {
		s &lt;- e
	}
}
// release n resources
func (s semaphore) V(n int) {
	for i := 0; i &lt; n; i++ {
		&lt;-s
	}
}
</code></pre></li>

<li><p>Semaphore for a mutex:</p>

<pre><code class="language-go">/* mutexes */
func (s semaphore) Lock() {
	s.P(1)
}
func (s semaphore) Unlock() {
	s.V(1)
}
/* signal-wait */
func (s semaphore) Wait(n int) {
	s.P(n)
}
func (s semaphore) Signal() {
	s.V(1)
}
</code></pre></li>
</ul>

<h4 id="channel-factory-pattern">Channel Factory pattern</h4>

<ul>
<li><p>Another pattern common in this style of programming goes as follows: instead of passing a channel as a parameter to a goroutine, let the function make the channel and return it (so it plays the role of a factory); inside the function a lambda function is called as a goroutine.</p>

<pre><code class="language-go">func main() {
	stream := pump()
	go suck(stream)
	// the above 2 lines can be shortened to: go suck( pump() )
	time.Sleep(1e9)
}
func pump() chan int {
	ch := make(chan int)
	go func() {
		for i := 0; ; i++ {
			ch &lt;- i
		}
	}()
	return ch
}
func suck(ch chan int) {
	for {
		fmt.Println(&lt;-ch)
	}
}
</code></pre></li>
</ul>

<h5 id="for-range-applied-to-channels">For—range applied to channels</h5>

<ul>
<li><p>The range clause on for loops accepts a channel ch as an operand, in which case the for loops over the values received from the channel.</p></li>

<li><p>Obviously another goroutine must be writing to ch (otherwise the execution blocks in the for-loop) and must close ch when it is done writing.</p>

<pre><code class="language-go">
func main() {
	suck(pump())
	time.Sleep(1e9)
}
func pump() chan int {
	ch := make(chan int)
	go func() {
		for i := 0; ; i++ {
			ch &lt;- i
		}
	}()
	return ch
}
func suck(ch chan int) {
	go func() {
		for v := range ch {
			fmt.Println(v)
		}
	}()
}
</code></pre></li>

<li></li>
</ul>

<h5 id="iterator-pattern">Iterator pattern</h5>

<ul>
<li><p>Another common case where we have to populate a channel with the items of a container type which contains an 394The Way to Go index-addressable field items . For this we can define a method which returns a read-only channel.</p></li>

<li><p>Inside the goroutine, a for-loop iterates over the elements in the container c (for tree or graph algorithms, this simple for-loop could be replaced with a depth-first search)</p>

<pre><code class="language-go">func (c *container) Iter() &lt;-chan items {
	ch := make(chan item)
	go func() {
		for i := 0; i &lt; c.Len(); i++ {
			// or use a for-range loop
			ch &lt;- c.items[i]
		}
	}()
	return ch
}

// The code which calls this method can then iterate over the container
for x := range container.Iter() { ... }

</code></pre></li>
</ul>

<h4 id="producer-consumer-pattern">Producer Consumer pattern</h4>

<ul>
<li><p>A Produce() function which delivers the values needed by a Consume function. Both could be run as a separate goroutine, Produce putting the values on a channel which is read by Consume.</p>

<pre><code class="language-go">for {
	Consume(Produce())
}
</code></pre></li>
</ul>

<h5 id="channel-directionality">Channel directionality</h5>

<ul>
<li><p>A channel type may be annotated to specify that it may only send or only receive</p>

<pre><code>var send_only chan&lt;- int // channel can only receive data
var recv_only &lt;-chan int // channel can only send data
</code></pre></li>

<li><p>Receive-only channels ( &lt;-chan T ) cannot be closed, because closing a channel is intended as a way for a sender to signal that no more values will be sent to the channel, so it has no meaning for receive-only channels.</p></li>
</ul>

<h4 id="pipe-filter-pattern">Pipe &amp; Filter pattern</h4>

<ul>
<li><p>A goroutine channel process will processes what it receives from an input channel and sends this to an output channel</p>

<pre><code class="language-go">func main() {
	sendChan := make(chan int)
	receiveChan := make(chan string)
	go processChannel(sendChan, receiveChan)

}

func processChannel(in &lt;-chan int, out chan&lt;- string) {
	for inValue := range in {
		result := strconv.Itoa(inValue) // processing inValue
		// ...
		out &lt;- result
	}
}
</code></pre></li>

<li><p>Prime number generator sample</p>

<pre><code class="language-go">func generate() chan int {
	ch := make(chan int)
	go func() {
		for i := 2; ; i++ {
			ch &lt;- i
		}
	}()
	return ch
}

// Filter out input values divisible by prime, send rest to returned channel
func filter(in chan int, prime int) chan int {
	out := make(chan int)
	go func() {
		for {
			if i := &lt;-in; i%prime != 0 {
				out &lt;- i
			}
		}
	}()
	return out
}

func sieve() chan int {
	out := make(chan int)
	go func() {
		ch := generate()
		for {
			prime := &lt;-ch
			ch = filter(ch, prime)
			out &lt;- prime
		}
	}()
	return out
}

func main() {
	primes := sieve()
	for {
		fmt.Println(&lt;-primes)
	}
}
</code></pre></li>
</ul>

<h5 id="goroutine-with-select">Goroutine with select</h5>

<ul>
<li><p>The select chooses which of the multiple communications listed by its cases can proceed. The default clause is optional; fall through behavior, like in the normal switch, is not permitted.</p>

<ul>
<li>It all are blocked, it waits until one can proceed.</li>
<li>If multiple can proceed, it chooses one at random.</li>
<li>When none of the channel operations can proceed and the default clause is present, then this is executed: the default is always runnable (that is: ready to execute).</li>
</ul></li>

<li><p>Using a send operation in a select statement with a default case guarantees that the send will be non-blocking! If there are no cases, the select blocks execution forever.</p></li>

<li><p>Sample 9</p>

<pre><code class="language-go">func main() {
	runtime.GOMAXPROCS(2) // in goroutine_select2.go
	ch1 := make(chan int)
	ch2 := make(chan int)
	go pump1(ch1)
	go pump2(ch2)
	go suck(ch1, ch2)
	time.Sleep(1e9)
}
func pump1(ch chan int) {
	for i := 0; ; i++ {
		ch &lt;- i * 2
	}
}
func pump2(ch chan int) {
	for i := 0; ; i++ {
		ch &lt;- i + 5
	}
}
func suck(ch1 chan int, ch2 chan int) {
	for {
		select {
		case v := &lt;-ch1:

			fmt.Printf(&quot;Received on channel 1: %d\n&quot;, v)
		case v := &lt;-ch2:
			fmt.Printf(&quot;Received on channel 2: %d\n&quot;, v)
		}
	}
}
</code></pre></li>
</ul>

<h5 id="timeout-ticker">Timeout &amp; Ticker</h5>

<ul>
<li><p>Ticker: a struct time.Ticker which is an object that repeatedly sends a time value on a contained channel C at a specified time interval</p>

<pre><code class="language-go">type Ticker struct {
	C &lt;-chan Time // the channel on which the ticks are delivered.
				// contains filtered or unexported fields
	// ...
}
</code></pre></li>

<li><p>A ticker is stopped with Stop(), use this in a defer statement.</p>

<pre><code class="language-go">ticker := time.NewTicker(updateInterval)
defer ticker.Stop()
// ...
select {
	case u:= &lt;- ch1:
		// ...
	case v:= &lt;- ch2:
		// ...
	case &lt;- ticker.C:
		logState(status) // call some logging function logState
	default: // no value ready to be received
		// ...
}
</code></pre></li>

<li><p>Handy to use when you have to limit the rate of processing per unit time. The time.Tick() function with signature func Tick(d Duration) &lt;-chan Time is useful when you only need access to the return channel and don’t need to shutdown it.</p></li>

<li><p>Sample below is good use case for time.Tick function</p>

<pre><code class="language-go">rate_per_sec := 10
var dur Duration = 1e9 / rate_per_sec
chRate := time.Tick(dur) // a tick every 1/10th of a second
for req := range requests {
	&lt;- chRate // rate limit our Service.Method RPC calls
	go client.Call(&quot;Service.Method&quot;, req, ...) // client.Call is RPC call
}
</code></pre></li>

<li><p>A Timer type looks exactly the same as a Ticker type (it is constructed with NewTimer(d but it sends the time only once, after a Duration d.</p></li>

<li><p>After Duration d the current time is sent on the returned channel; so this is equivalent to NewTimer(d).C; it resembles Tick(), but After() sends the time only once.</p></li>

<li><p>Sample of timer</p>

<pre><code class="language-go">func main() {
	tick := time.Tick(1e8)
	boom := time.After(5e8)
	for {
		select {
			case &lt;-tick:
				fmt.Println(&quot;tick.&quot;)
			case &lt;-boom:
				fmt.Println(&quot;BOOM!&quot;)
				return
			default:
				fmt.Println(&quot; .&quot;)
				time.Sleep(5e7)
		}
	}
}
</code></pre></li>
</ul>

<h4 id="lazy-generator">Lazy generator</h4>

<ul>
<li><p>A generator is a function that returns the next value in a sequence each time the function is called.</p></li>

<li><p>It is a producer that only returns the next value, not the entire sequence; this is called lazy evaluation:only compute what you need at the moment, saving valuable resources (memory and CPU): it is a technology for the evaluation of expressions on demand.</p></li>
</ul>

<h5 id="basic-lazy-generator">Basic lazy generator</h5>

<pre><code class="language-go">var resume chan int

func integers() chan int {
	yield := make(chan int)
	count := 0
	go func() {
		for {
			yield &lt;- count
			count++
		}
	}()
	return yield
}
func generateInteger() int {
	return &lt;-resume
}
func main() {
	resume = integers()
	fmt.Println(generateInteger()) //=&gt; 0
	fmt.Println(generateInteger()) //=&gt; 1
	fmt.Println(generateInteger()) //=&gt; 2
}
</code></pre>

<h5 id="generic-lazy-generator">Generic Lazy Generator</h5>

<ul>
<li><p>By making clever use of the empty interface, closures and higher order functions we can implement a generic builder BuildLazyEvaluator for the lazy evaluation function (this should best placed inside a utility package). The builder takes a function that has to be evaluated and an initial state as arguments and returns a function without arguments returning the desired value. The passed evaluation function has to calculate the next return value as well as the next state based on the state argument. Inside the builder a channel and a goroutine with an endless loop are created. The return values are passed to the channel from which they are fetched by the returned function for later usage. Each time a value is fetched the next one will be calculated.</p>

<pre><code class="language-go">type Any interface{}
type EvalFunc func(Any) (Any, Any)

func main() {
	evenFunc := func(state Any) (Any, Any) {
		oldSate := state.(int)
		newState := oldSate + 2
		return oldSate, newState
	}
	even := BuildLazyIntEvaluator(evenFunc, 0)
	for i := 0; i &lt; 10; i++ {
		fmt.Printf(&quot;%vth even: %v\n&quot;, i, even())
	}
}

func BuildLazyEvaluator(evalFunc EvalFunc, initState Any) func() Any {
	retValChan := make(chan Any)
	loopFunc := func() {
		var actState Any = initState
		var retVal Any
		for {
			retVal, actState = evalFunc(actState)
			retValChan &lt;- retVal
		}
	}
	retFunc := func() Any {
		return &lt;-retValChan
	}
	go loopFunc()
	return retFunc
}

func BuildLazyIntEvaluator(evalFunc EvalFunc, initState Any) func() int {
	evalFn := BuildLazyEvaluator(evalFunc, initState)
	return func() int {
		return evalFn().(int)
	}
}
</code></pre></li>
</ul>

<h4 id="multiplexing">Multiplexing</h4>

<ul>
<li><p>Client-server applications are the kind of applications where goroutines and channels shine.</p></li>

<li><p>Server side simulator sample</p>

<pre><code class="language-go">type Request struct {
	a, b      int
	replyChan chan int // reply channel inside the Request
}

type binOp func(a, b int) int

func run(op binOp, req *Request) {
	req.replyChan &lt;- op(req.a, req.b)
}

func server(op binOp, service chan *Request, quitChan chan bool) {
	for {
		select {
		case req := &lt;-service:
			go run(op, req)
		case &lt;-quitChan:
			return
		}
	}
}
func startServer(op binOp) (service chan *Request, quitChan chan bool) {
	service = make(chan *Request)
	quitChan = make(chan bool)
	go server(op, service, quitChan)
	return service, quitChan
}

func main() {
	adder, quitChan := startServer(func(a, b int) int { return a + b })
	const N = 100
	var reqs [N]Request
	for i := 0; i &lt; N; i++ {
		req := &amp;reqs[i]
		req.a = i
		req.b = i + N
		req.replyChan = make(chan int)
		adder &lt;- req
	}
	// checks:
	for i := N - 1; i &gt;= 0; i-- { // doesn’t matter what order
		if &lt;-reqs[i].replyChan != N+2*i {
			fmt.Println(&quot;fail at&quot;, i)
		} else {

			fmt.Println(&quot;Request &quot;, i, &quot;is ok!&quot;)
		}
	}
	quitChan &lt;- true
	fmt.Println(&quot;done&quot;)
}
</code></pre></li>
</ul>

    </div>

    <div class="toc" >
        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#goroutine">Goroutine</a>
<ul>
<li><a href="#basic-goroutine">Basic Goroutine</a></li>
<li><a href="#using-gomaxprocs">Using GOMAXPROCS</a></li>
</ul></li>
<li><a href="#channels">Channels</a>
<ul>
<li><a href="#channels-for-communication-between-goroutines">Channels for communication between goroutines</a></li>
<li><a href="#blocking-of-channels">Blocking of channels</a>
<ul>
<li><a href="#goroutine-sync-through-one-or-more-channels">Goroutine sync through one or more channels</a></li>
<li><a href="#async-channels-channel-with-buffer">Async channels - channel with buffer</a></li>
<li><a href="#closing-channel">Closing channel</a></li>
</ul></li>
<li><a href="#semaphore-pattern">Semaphore pattern</a>
<ul>
<li><a href="#implement-a-semaphore-with-a-buffered-channel">Implement a semaphore with a buffered channel</a></li>
</ul></li>
<li><a href="#channel-factory-pattern">Channel Factory pattern</a>
<ul>
<li><a href="#for-range-applied-to-channels">For—range applied to channels</a></li>
<li><a href="#iterator-pattern">Iterator pattern</a></li>
</ul></li>
<li><a href="#producer-consumer-pattern">Producer Consumer pattern</a>
<ul>
<li><a href="#channel-directionality">Channel directionality</a></li>
</ul></li>
<li><a href="#pipe-filter-pattern">Pipe &amp; Filter pattern</a>
<ul>
<li><a href="#goroutine-with-select">Goroutine with select</a></li>
<li><a href="#timeout-ticker">Timeout &amp; Ticker</a></li>
</ul></li>
<li><a href="#lazy-generator">Lazy generator</a>
<ul>
<li><a href="#basic-lazy-generator">Basic lazy generator</a></li>
<li><a href="#generic-lazy-generator">Generic Lazy Generator</a></li>
</ul></li>
<li><a href="#multiplexing">Multiplexing</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>

</div>

    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="/coding/golang/go-note-5/" title="Golang Note - 5"> <i class="fa fa-chevron-left"></i><label>Golang Note - 5</label></a>
    <a class="nav nav-next" href="/coding/golang/go-note-99/" title="Golang snippets" style="margin-right: 0px;"><label>Golang snippets</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

    

    
  </div>


	<div>


  
    
  



	</div>
</footer>

<script src="/js/clipboard.min.js"></script>

<link href="/css/featherlight.min.css" rel="stylesheet">
<script src="/js/featherlight.min.js"></script>


<link href="/css/github.css" rel="stylesheet">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script src="/theme-flex/script.js"></script>


    

    
    

    
  </body>
</html>